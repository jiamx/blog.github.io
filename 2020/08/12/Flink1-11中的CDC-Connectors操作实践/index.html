<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="记录朴实无华且枯燥的生活"><title>Flink1.11中的CDC Connectors操作实践 | Jmx's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '912b6cfc43243cd27aeb428f7dbf7823';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="/js/toc.js?v=0.0.0"></script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Flink1.11中的CDC Connectors操作实践</h1><a id="logo" href="/.">Jmx's Blog</a><p class="description">Keep it Simple and Stupid!</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-pied-piper-alt"> 关于</i></a><a href="/tags"><i class="fa fa-tags"> 标签</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Flink1.11中的CDC Connectors操作实践</h1><div class="post-meta">Aug 12, 2020<span> | </span><span class="category"><a href="/categories/Flink/">Flink</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 2.1k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 10</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="post-content"><p>Flink1.11引入了CDC的connector，通过这种方式可以很方便地捕获变化的数据，大大简化了数据处理的流程。Flink1.11的CDC connector主要包括：<code>MySQL CDC</code>和<code>Postgres CDC</code>,同时对Kafka的<strong>Connector</strong>支持<code>canal-json</code>和<code>debezium-json</code>以及<code>changelog-json</code>的format。本文主要分享以下内容：</p>
<ul>
<li>CDC简介</li>
<li>Flink提供的 table format</li>
<li>使用过程中的注意点</li>
<li>mysql-cdc的操作实践</li>
<li>canal-json的操作实践</li>
<li>changelog-json的操作实践</li>
</ul>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Flink CDC Connector 是ApacheFlink的一组数据源连接器，使用<strong>变化数据捕获change data capture (CDC)）</strong>从不同的数据库中提取变更数据。Flink CDC连接器将Debezium集成为引擎来捕获数据变更。因此，它可以充分利用Debezium的功能。</p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li><p>支持读取数据库快照，并且能够持续读取数据库的变更日志，即使发生故障，也支持<strong>exactly-once</strong> 的处理语义</p>
</li>
<li><p>对于DataStream API的CDC connector，用户无需部署Debezium和Kafka，即可在单个作业中使用多个数据库和表上的变更数据。</p>
</li>
<li><p>对于Table/SQL API 的CDC connector，用户可以使用SQL DDL创建CDC数据源，来监视单个表上的数据变更。</p>
</li>
</ul>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ul>
<li>数据库之间的增量数据同步</li>
<li>审计日志</li>
<li>数据库之上的实时物化视图</li>
<li>基于CDC的维表join</li>
<li>…</li>
</ul>
<h2 id="Flink提供的-table-format"><a href="#Flink提供的-table-format" class="headerlink" title="Flink提供的 table format"></a>Flink提供的 table format</h2><p>Flink提供了一系列可以用于table connector的table format，具体如下：</p>
<table>
<thead>
<tr>
<th align="left">Formats</th>
<th align="left">Supported Connectors</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/formats/csv.html" target="_blank" rel="noopener">CSV</a></td>
<td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/kafka.html" target="_blank" rel="noopener">Apache Kafka</a>, <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/filesystem.html" target="_blank" rel="noopener">Filesystem</a></td>
</tr>
<tr>
<td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/formats/json.html" target="_blank" rel="noopener">JSON</a></td>
<td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/kafka.html" target="_blank" rel="noopener">Apache Kafka</a>, <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/filesystem.html" target="_blank" rel="noopener">Filesystem</a>, <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/elasticsearch.html" target="_blank" rel="noopener">Elasticsearch</a></td>
</tr>
<tr>
<td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/formats/avro.html" target="_blank" rel="noopener">Apache Avro</a></td>
<td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/kafka.html" target="_blank" rel="noopener">Apache Kafka</a>, <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/filesystem.html" target="_blank" rel="noopener">Filesystem</a></td>
</tr>
<tr>
<td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/formats/debezium.html" target="_blank" rel="noopener">Debezium CDC</a></td>
<td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/kafka.html" target="_blank" rel="noopener">Apache Kafka</a></td>
</tr>
<tr>
<td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/formats/canal.html" target="_blank" rel="noopener">Canal CDC</a></td>
<td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/kafka.html" target="_blank" rel="noopener">Apache Kafka</a></td>
</tr>
<tr>
<td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/formats/parquet.html" target="_blank" rel="noopener">Apache Parquet</a></td>
<td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/filesystem.html" target="_blank" rel="noopener">Filesystem</a></td>
</tr>
<tr>
<td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/formats/orc.html" target="_blank" rel="noopener">Apache ORC</a></td>
<td align="left"><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connectors/filesystem.html" target="_blank" rel="noopener">Filesystem</a></td>
</tr>
</tbody></table>
<h2 id="使用过程中的注意点"><a href="#使用过程中的注意点" class="headerlink" title="使用过程中的注意点"></a>使用过程中的注意点</h2><h3 id="使用MySQL-CDC的注意点"><a href="#使用MySQL-CDC的注意点" class="headerlink" title="使用MySQL CDC的注意点"></a>使用MySQL CDC的注意点</h3><p>如果要使用MySQL CDC connector，对于程序而言，需要添加如下依赖:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.ververica<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-connector-mysql-cdc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果要使用Flink SQL Client，需要添加如下jar包：<strong><a href="https://repo1.maven.org/maven2/com/alibaba/ververica/flink-sql-connector-mysql-cdc/1.0.0/flink-sql-connector-mysql-cdc-1.0.0.jar" target="_blank" rel="noopener">flink-sql-connector-mysql-cdc-1.0.0.jar</a></strong>，将该jar包放在Flink安装目录的lib文件夹下即可。</p>
<h3 id="使用canal-json的注意点"><a href="#使用canal-json的注意点" class="headerlink" title="使用canal-json的注意点"></a>使用canal-json的注意点</h3><p>如果要使用Kafka的canal-json，对于程序而言，需要添加如下依赖:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- universal --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-connector-kafka_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果要使用Flink SQL Client，需要添加如下jar包：<strong><a href="https://repo.maven.apache.org/maven2/org/apache/flink/flink-sql-connector-kafka_2.11/1.11.0/flink-sql-connector-kafka_2.11-1.11.0.jar" target="_blank" rel="noopener">flink-sql-connector-kafka_2.11-1.11.0.jar</a></strong>，将该jar包放在Flink安装目录的lib文件夹下即可。由于Flink1.11的安装包 的lib目录下并没有提供该jar包，所以必须要手动添加依赖包，否则会报如下错误：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[ERROR] Could not execute SQL statement. Reason:</span><br><span class="line">org.apache.flink.table.api.ValidationException: Could not find any factory <span class="keyword">for</span> identifier <span class="string">'kafka'</span> that implements <span class="string">'org.apache.flink.table.factories.DynamicTableSourceFactory'</span> <span class="keyword">in</span> the classpath.</span><br><span class="line"></span><br><span class="line">Available factory identifiers are:</span><br><span class="line"></span><br><span class="line">datagen</span><br><span class="line">mysql-cdc</span><br></pre></td></tr></table></figure>

<h3 id="使用changelog-json的注意点"><a href="#使用changelog-json的注意点" class="headerlink" title="使用changelog-json的注意点"></a>使用changelog-json的注意点</h3><p>如果要使用Kafka的changelog-json Format，对于程序而言，需要添加如下依赖:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.ververica<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-format-changelog-json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果要使用Flink SQL Client，需要添加如下jar包：<strong><a href="https://repo1.maven.org/maven2/com/alibaba/ververica/flink-format-changelog-json/1.0.0/flink-format-changelog-json-1.0.0.jar" target="_blank" rel="noopener">flink-format-changelog-json-1.0.0.jar</a></strong>，将该jar包放在Flink安装目录的lib文件夹下即可。</p>
<h2 id="mysql-cdc的操作实践"><a href="#mysql-cdc的操作实践" class="headerlink" title="mysql-cdc的操作实践"></a>mysql-cdc的操作实践</h2><h3 id="创建MySQL数据源表"><a href="#创建MySQL数据源表" class="headerlink" title="创建MySQL数据源表"></a>创建MySQL数据源表</h3><p>在创建MySQL CDC表之前，需要先创建MySQL的数据表，如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- MySQL</span></span><br><span class="line"><span class="comment">/*Table structure for table `order_info` */</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`order_info`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`order_info`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'编号'</span>,</span><br><span class="line">  <span class="string">`consignee`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'收货人'</span>,</span><br><span class="line">  <span class="string">`consignee_tel`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'收件人电话'</span>,</span><br><span class="line">  <span class="string">`total_amount`</span> <span class="built_in">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'总金额'</span>,</span><br><span class="line">  <span class="string">`order_status`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'订单状态,1表示下单，2表示支付'</span>,</span><br><span class="line">  <span class="string">`user_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户id'</span>,</span><br><span class="line">  <span class="string">`payment_way`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'付款方式'</span>,</span><br><span class="line">  <span class="string">`delivery_address`</span> <span class="built_in">varchar</span>(<span class="number">1000</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'送货地址'</span>,</span><br><span class="line">  <span class="string">`order_comment`</span> <span class="built_in">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'订单备注'</span>,</span><br><span class="line">  <span class="string">`out_trade_no`</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'订单交易编号（第三方支付用)'</span>,</span><br><span class="line">  <span class="string">`trade_body`</span> <span class="built_in">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'订单描述(第三方支付用)'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line">  <span class="string">`operate_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'操作时间'</span>,</span><br><span class="line">  <span class="string">`expire_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'失效时间'</span>,</span><br><span class="line">  <span class="string">`tracking_no`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'物流单编号'</span>,</span><br><span class="line">  <span class="string">`parent_order_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'父订单编号'</span>,</span><br><span class="line">  <span class="string">`img_url`</span> <span class="built_in">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'图片路径'</span>,</span><br><span class="line">  <span class="string">`province_id`</span> <span class="built_in">int</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'地区'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'订单表'</span>;</span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of order_info</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`order_info`</span> </span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">476</span>, <span class="string">'lAXjcL'</span>, <span class="string">'13408115089'</span>, <span class="number">433.00</span>, <span class="string">'2'</span>, <span class="number">10</span>, <span class="string">'2'</span>, <span class="string">'OYyAdSdLxedceqovndCD'</span>, <span class="string">'ihjAYsSjrgJMQVdFQnSy'</span>, <span class="string">'8728720206'</span>, <span class="string">''</span>, <span class="string">'2020-06-18 02:21:38'</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="number">9</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`order_info`</span></span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">477</span>, <span class="string">'QLiFDb'</span>, <span class="string">'13415139984'</span>, <span class="number">772.00</span>, <span class="string">'1'</span>, <span class="number">90</span>, <span class="string">'2'</span>, <span class="string">'OizYrQbKuWvrvdfpkeSZ'</span>, <span class="string">'wiBhhqhMndCCgXwmWVQq'</span>, <span class="string">'1679381473'</span>, <span class="string">''</span>, <span class="string">'2020-06-18 09:12:25'</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`order_info`</span></span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">478</span>, <span class="string">'iwKjQD'</span>, <span class="string">'13320383859'</span>, <span class="number">88.00</span>, <span class="string">'1'</span>, <span class="number">107</span>, <span class="string">'1'</span>, <span class="string">'cbXLKtNHWOcWzJVBWdAs'</span>, <span class="string">'njjsnknHxsxhuCCeNDDi'</span>, <span class="string">'0937074290'</span>, <span class="string">''</span>, <span class="string">'2020-06-18 15:56:34'</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="number">7</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*Table structure for table `order_detail` */</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`order_detail`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'编号'</span>,</span><br><span class="line">  <span class="string">`order_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'订单编号'</span>,</span><br><span class="line">  <span class="string">`sku_id`</span> <span class="built_in">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'sku_id'</span>,</span><br><span class="line">  <span class="string">`sku_name`</span> <span class="built_in">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'sku名称（冗余)'</span>,</span><br><span class="line">  <span class="string">`img_url`</span> <span class="built_in">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'图片名称（冗余)'</span>,</span><br><span class="line">  <span class="string">`order_price`</span> <span class="built_in">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'购买价格(下单时sku价格）'</span>,</span><br><span class="line">  <span class="string">`sku_num`</span> <span class="built_in">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'购买个数'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> datetime <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'订单明细表'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of order_detail</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`order_detail`</span> </span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1329</span>, <span class="number">476</span>, <span class="number">8</span>, <span class="string">'Apple iPhone XS Max (A2104) 256GB 深空灰色 移动联通电信4G手机 双卡双待'</span>, <span class="string">'http://XLMByOyZDTJQYxphQHNTgYAFzJJCKTmCbzvEJIpz'</span>, <span class="number">8900.00</span>, <span class="string">'3'</span>, <span class="string">'2020-06-18 02:21:38'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`order_detail`</span> </span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1330</span>, <span class="number">477</span>, <span class="number">9</span>, <span class="string">'荣耀10 GT游戏加速 AIS手持夜景 6GB+64GB 幻影蓝全网通 移动联通电信'</span>, <span class="string">'http://ixOCtlYmlxEEgUfPLiLdjMftzrleOEIBKSjrhMne'</span>, <span class="number">2452.00</span>, <span class="string">'4'</span>, <span class="string">'2020-06-18 09:12:25'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`order_detail`</span></span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1331</span>, <span class="number">478</span>, <span class="number">4</span>, <span class="string">'小米Play 流光渐变AI双摄 4GB+64GB 梦幻蓝 全网通4G 双卡双待 小水滴全面屏拍照游戏智能手机'</span>, <span class="string">'http://RqfEFnAOqnqRnNZLFRvBuwXxwNBtptYJCILDKQYv'</span>, <span class="number">1442.00</span>, <span class="string">'1'</span>, <span class="string">'2020-06-18 15:56:34'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`order_detail`</span> </span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1332</span>, <span class="number">478</span>, <span class="number">8</span>, <span class="string">'Apple iPhone XS Max (A2104) 256GB 深空灰色 移动联通电信4G手机 双卡双待'</span>, <span class="string">'http://IwhuCDlsiLenfKjPzbJrIoxswdfofKhJLMzlJAKV'</span>, <span class="number">8900.00</span>, <span class="string">'3'</span>, <span class="string">'2020-06-18 15:56:34'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`order_detail`</span> </span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1333</span>, <span class="number">478</span>, <span class="number">8</span>, <span class="string">'Apple iPhone XS Max (A2104) 256GB 深空灰色 移动联通电信4G手机 双卡双待'</span>, <span class="string">'http://bbfwTbAzTWapywODzOtDJMJUEqNTeRTUQuCDkqXP'</span>, <span class="number">8900.00</span>, <span class="string">'1'</span>, <span class="string">'2020-06-18 15:56:34'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Flink-SQL-Cli创建CDC数据源"><a href="#Flink-SQL-Cli创建CDC数据源" class="headerlink" title="Flink SQL Cli创建CDC数据源"></a>Flink SQL Cli创建CDC数据源</h3><p>启动 Flink 集群，再启动 SQL CLI,执行下面命令：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建订单信息表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> order_info(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">BIGINT</span>,</span><br><span class="line">    user_id <span class="built_in">BIGINT</span>,</span><br><span class="line">    create_time <span class="built_in">TIMESTAMP</span>(<span class="number">0</span>),</span><br><span class="line">    operate_time <span class="built_in">TIMESTAMP</span>(<span class="number">0</span>),</span><br><span class="line">    province_id <span class="built_in">INT</span>,</span><br><span class="line">    order_status <span class="keyword">STRING</span>,</span><br><span class="line">    total_amount <span class="built_in">DECIMAL</span>(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line">  ) <span class="keyword">WITH</span> (</span><br><span class="line">    <span class="string">'connector'</span> = <span class="string">'mysql-cdc'</span>,</span><br><span class="line">    <span class="string">'hostname'</span> = <span class="string">'kms-1'</span>,</span><br><span class="line">    <span class="string">'port'</span> = <span class="string">'3306'</span>,</span><br><span class="line">    <span class="string">'username'</span> = <span class="string">'root'</span>,</span><br><span class="line">    <span class="string">'password'</span> = <span class="string">'123qwe'</span>,</span><br><span class="line">    <span class="string">'database-name'</span> = <span class="string">'mydw'</span>,</span><br><span class="line">    <span class="string">'table-name'</span> = <span class="string">'order_info'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>在Flink SQL Cli中查询该表的数据：result-mode: tableau，+表示数据的insert</p>
<p><img src="//jiamaoxiang.top/2020/08/12/Flink1-11中的CDC-Connectors操作实践/%E5%9B%BE1.png" alt></p>
<p>在SQL CLI中创建订单详情表：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> order_detail(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">BIGINT</span>,</span><br><span class="line">    order_id <span class="built_in">BIGINT</span>,</span><br><span class="line">    sku_id <span class="built_in">BIGINT</span>,</span><br><span class="line">    sku_name <span class="keyword">STRING</span>,</span><br><span class="line">    sku_num <span class="built_in">BIGINT</span>,</span><br><span class="line">    order_price <span class="built_in">DECIMAL</span>(<span class="number">10</span>, <span class="number">5</span>),</span><br><span class="line">	create_time <span class="built_in">TIMESTAMP</span>(<span class="number">0</span>)</span><br><span class="line"> ) <span class="keyword">WITH</span> (</span><br><span class="line">    <span class="string">'connector'</span> = <span class="string">'mysql-cdc'</span>,</span><br><span class="line">    <span class="string">'hostname'</span> = <span class="string">'kms-1'</span>,</span><br><span class="line">    <span class="string">'port'</span> = <span class="string">'3306'</span>,</span><br><span class="line">    <span class="string">'username'</span> = <span class="string">'root'</span>,</span><br><span class="line">    <span class="string">'password'</span> = <span class="string">'123qwe'</span>,</span><br><span class="line">    <span class="string">'database-name'</span> = <span class="string">'mydw'</span>,</span><br><span class="line">    <span class="string">'table-name'</span> = <span class="string">'order_detail'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>查询结果如下：</p>
<p><img src="//jiamaoxiang.top/2020/08/12/Flink1-11中的CDC-Connectors操作实践/%E5%9B%BE2.png" alt></p>
<p>执行JOIN操作：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    od.id,</span><br><span class="line">    oi.id order_id,</span><br><span class="line">    oi.user_id,</span><br><span class="line">    oi.province_id,</span><br><span class="line">    od.sku_id,</span><br><span class="line">    od.sku_name,</span><br><span class="line">    od.sku_num,</span><br><span class="line">    od.order_price,</span><br><span class="line">    oi.create_time,</span><br><span class="line">    oi.operate_time</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">   (</span><br><span class="line">    <span class="keyword">SELECT</span> * </span><br><span class="line">    <span class="keyword">FROM</span> order_info</span><br><span class="line">    <span class="keyword">WHERE</span> </span><br><span class="line">	     order_status = <span class="string">'2'</span><span class="comment">-- 已支付</span></span><br><span class="line">   ) oi</span><br><span class="line">   <span class="keyword">JOIN</span></span><br><span class="line">  (</span><br><span class="line">    <span class="keyword">SELECT</span> *</span><br><span class="line">    <span class="keyword">FROM</span> order_detail</span><br><span class="line">  ) od </span><br><span class="line">  <span class="keyword">ON</span> oi.id = od.order_id;</span><br></pre></td></tr></table></figure>

<h2 id="canal-json的操作实践"><a href="#canal-json的操作实践" class="headerlink" title="canal-json的操作实践"></a>canal-json的操作实践</h2><p>关于cannal的使用方式，可以参考我的另一篇文章：<a href="https://mp.weixin.qq.com/s/ooPAScXAw2soqlgEoSbRAw" target="_blank" rel="noopener">基于Canal与Flink实现数据实时增量同步(一)</a>。我已经将下面的表通过canal同步到了kafka，具体格式为：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"data"</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"id"</span>:<span class="string">"1"</span>,</span><br><span class="line">            <span class="string">"region_name"</span>:<span class="string">"华北"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"id"</span>:<span class="string">"2"</span>,</span><br><span class="line">            <span class="string">"region_name"</span>:<span class="string">"华东"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"id"</span>:<span class="string">"3"</span>,</span><br><span class="line">            <span class="string">"region_name"</span>:<span class="string">"东北"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"id"</span>:<span class="string">"4"</span>,</span><br><span class="line">            <span class="string">"region_name"</span>:<span class="string">"华中"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"id"</span>:<span class="string">"5"</span>,</span><br><span class="line">            <span class="string">"region_name"</span>:<span class="string">"华南"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"id"</span>:<span class="string">"6"</span>,</span><br><span class="line">            <span class="string">"region_name"</span>:<span class="string">"西南"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"id"</span>:<span class="string">"7"</span>,</span><br><span class="line">            <span class="string">"region_name"</span>:<span class="string">"西北"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"database"</span>:<span class="string">"mydw"</span>,</span><br><span class="line">    <span class="string">"es"</span>:1597128441000,</span><br><span class="line">    <span class="string">"id"</span>:102,</span><br><span class="line">    <span class="string">"isDdl"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="string">"mysqlType"</span>:&#123;</span><br><span class="line">        <span class="string">"id"</span>:<span class="string">"varchar(20)"</span>,</span><br><span class="line">        <span class="string">"region_name"</span>:<span class="string">"varchar(20)"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"old"</span>:null,</span><br><span class="line">    <span class="string">"pkNames"</span>:null,</span><br><span class="line">    <span class="string">"sql"</span>:<span class="string">""</span>,</span><br><span class="line">    <span class="string">"sqlType"</span>:&#123;</span><br><span class="line">        <span class="string">"id"</span>:12,</span><br><span class="line">        <span class="string">"region_name"</span>:12</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"table"</span>:<span class="string">"base_region"</span>,</span><br><span class="line">    <span class="string">"ts"</span>:1597128441424,</span><br><span class="line">    <span class="string">"type"</span>:<span class="string">"INSERT"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 在SQL CLI中创建该canal-json格式的表：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> region (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">BIGINT</span>,</span><br><span class="line">  region_name <span class="keyword">STRING</span></span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line"> <span class="string">'connector'</span> = <span class="string">'kafka'</span>,</span><br><span class="line"> <span class="string">'topic'</span> = <span class="string">'mydw.base_region'</span>,</span><br><span class="line"> <span class="string">'properties.bootstrap.servers'</span> = <span class="string">'kms-3:9092'</span>,</span><br><span class="line"> <span class="string">'properties.group.id'</span> = <span class="string">'testGroup'</span>,</span><br><span class="line"> <span class="string">'format'</span> = <span class="string">'canal-json'</span> ,</span><br><span class="line"> <span class="string">'scan.startup.mode'</span> = <span class="string">'earliest-offset'</span> </span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>查询结果如下：</p>
<p><img src="//jiamaoxiang.top/2020/08/12/Flink1-11中的CDC-Connectors操作实践/%E5%9B%BE3.png" alt></p>
<h2 id="changelog-json的操作实践"><a href="#changelog-json的操作实践" class="headerlink" title="changelog-json的操作实践"></a>changelog-json的操作实践</h2><h3 id="创建MySQL数据源"><a href="#创建MySQL数据源" class="headerlink" title="创建MySQL数据源"></a>创建MySQL数据源</h3><p>参见上面的<strong>order_info</strong></p>
<h3 id="Flink-SQL-Cli创建changelog-json表"><a href="#Flink-SQL-Cli创建changelog-json表" class="headerlink" title="Flink SQL Cli创建changelog-json表"></a>Flink SQL Cli创建changelog-json表</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> order_gmv2kafka (</span><br><span class="line">  day_str <span class="keyword">STRING</span>,</span><br><span class="line">  gmv <span class="built_in">DECIMAL</span>(<span class="number">10</span>, <span class="number">5</span>)</span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">    <span class="string">'connector'</span> = <span class="string">'kafka'</span>,</span><br><span class="line">    <span class="string">'topic'</span> = <span class="string">'order_gmv_kafka'</span>,</span><br><span class="line">    <span class="string">'scan.startup.mode'</span> = <span class="string">'earliest-offset'</span>,</span><br><span class="line">    <span class="string">'properties.bootstrap.servers'</span> = <span class="string">'kms-3:9092'</span>,</span><br><span class="line">    <span class="string">'format'</span> = <span class="string">'changelog-json'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> order_gmv2kafka</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATE_FORMAT</span>(create_time, <span class="string">'yyyy-MM-dd'</span>) <span class="keyword">as</span> day_str, <span class="keyword">SUM</span>(total_amount) <span class="keyword">as</span> gmv</span><br><span class="line"><span class="keyword">FROM</span> order_info</span><br><span class="line"><span class="keyword">WHERE</span> order_status = <span class="string">'2'</span> <span class="comment">-- 订单已支付</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">DATE_FORMAT</span>(create_time, <span class="string">'yyyy-MM-dd'</span>);</span><br></pre></td></tr></table></figure>

<p>查询表看一下结果：</p>
<p><img src="//jiamaoxiang.top/2020/08/12/Flink1-11中的CDC-Connectors操作实践/%E5%9B%BE4.png" alt></p>
<p>再查一下kafka的数据：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">"data"</span>:&#123;<span class="string">"day_str"</span>:<span class="string">"2020-06-18"</span>,<span class="string">"gmv"</span>:433&#125;,<span class="string">"op"</span>:<span class="string">"+I"</span>&#125;</span><br></pre></td></tr></table></figure>

<p>当将另外两个订单的状态order_status更新为2时，<code>总金额=443+772+88=1293</code>再观察数据：</p>
<p><img src="//jiamaoxiang.top/2020/08/12/Flink1-11中的CDC-Connectors操作实践/%E5%9B%BE5.png" alt></p>
<p>再看kafka中的数据：</p>
<p><img src="//jiamaoxiang.top/2020/08/12/Flink1-11中的CDC-Connectors操作实践/%E5%9B%BE6.png" alt></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文基于Flink1.11的SQL，对新添加的CDC connector的使用方式进行了阐述。主要包括MySQL CDC connector、canal-json及changelog-json的format，并指出了使用过程中的注意点。另外本文给出了完整的使用示例，如果你有现成的环境，那么可以直接进行测试使用。</p>
<blockquote>
<p>公众号『大数据技术与数仓』，回复『资料』领取大数据资料包</p>
</blockquote>
</div><div class="recommended_posts"><h3>相关推荐 ☟</h3><li><a href="https://jiamaoxiang.top/2020/08/18/两阶段提交-Flink端到端的EXACTLY-ONCE实现细节/" target="_blank">两阶段提交|Flink端到端的EXACTLY ONCE实现细节</a></li><li><a href="https://jiamaoxiang.top/2020/08/12/实时数仓-基于Flink1-11的SQL构建实时数仓探索实践/" target="_blank">实时数仓|基于Flink1.11的SQL构建实时数仓探索实践</a></li><li><a href="https://jiamaoxiang.top/2020/08/07/一文搞懂HBase的基本原理/" target="_blank">内含面试|一文搞懂HBase的基本原理</a></li><li><a href="https://jiamaoxiang.top/2020/08/06/数仓面试-四个在工作后才知道的SQL密技/" target="_blank">数仓面试|四个在工作后才知道的SQL密技</a></li></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Jia MaoXiang</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2020/08/12/Flink1-11中的CDC-Connectors操作实践/">https://jiamaoxiang.top/2020/08/12/Flink1-11中的CDC-Connectors操作实践/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本文为博主原创文章，遵循CC BY-SA 4.0版权协议，转载请附上原文出处链接和本声明</li></ul></div><br><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="https://jiamaoxiang.top/2020/08/12/Flink1-11中的CDC-Connectors操作实践/" data-id="ckh21lh7t00224s7qtnqdi0og" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACrklEQVR42u3aUW5iMQwFUPa/6c4CKuBeOxm9SidfqAVeTj5iY/v1itfPr/Xu7+/W729LXr/77+GFh4eHt956zmi3knwq//7kKPHw8PDu8ZKt5O9JXucHN9sPHh4e3pN5Seo8S5oTNh4eHt5f4bVpd/LEnISHh4f3BN4mtZ0VFNoAc73WgoeHhxfz8i7Sc15f6e/h4eHhrbvq+8s6f8rn4PEzWnh4eHg3ePmFmySs+RG035mny3h4eHj/h/f5wftrPT+ItulVtMfw8PDwLvDyltipzbWf3TTV8PDw8E7x8nQ2udCTIsUsSOSjCcVvBTw8PLyjvLyIcKpo20azKIHGw8PDu8DLBwWK67gcscpLt8dGr/Dw8PDWvM8BIA8GmxZacmSzsTA8PDy8s7z99b3ZYn6ss+IyHh4e3j3e5zDQlgA26XX+2ShE4eHh4V3jzVLnzZWdh5C2/fYlpcbDw8Nb8/JLdl9EaFtfSQgpunx4eHh413ib9Ho2gNU22+rDxcPDw7vGmzWfZlvJJxrypPzt+/Hw8PCu8dpyQDuuOivO7gsleHh4eGd5eemhbURtku+88FFEPDw8PLxDvLZ5nz+gXZuC8pe94eHh4R3lJY/Jj2CfUueXfj10hYeHh3eIl1y17QBBmxC35Ya6XYeHh4d3jbdpg20GpJKjyQvKRZUCDw8P7yivTbVnoSIZXMiT+GP5OB4eHl7M2wxdJdtqC8T7sISHh4d3gzdrU822mx/K/jjw8PDw7vH2xYW26NCGgfYghuEEDw8Pr+TNNrppd+2bW0UKjoeHh3eN15Zi2/CQ/H0Wtb5Q8fDw8B7Dmw0f5OGnbYC9PSA8PDy8h/GSaz3Z9GaYtR4dwMPDwzvE26fFM3wSZton4uHh4d3mHfjBX7as8mJEm1K/ZgsPDw8v5f0D+rsr8NlxX+UAAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/Flink/">Flink</a></div><div class="post-nav"><a class="pre" href="/2020/08/12/实时数仓-基于Flink1-11的SQL构建实时数仓探索实践/">实时数仓|基于Flink1.11的SQL构建实时数仓探索实践</a><a class="next" href="/2020/08/07/一文搞懂HBase的基本原理/">内含面试|一文搞懂HBase的基本原理</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar-toc"><div class="stoc-article" id="sidebar-stoc"><strong class="stoc-title"><i class="fa fa-list-ul"> 目录</i></strong><div class="toc-nav" id="stoc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特点"><span class="toc-number">1.1.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用场景"><span class="toc-number">1.2.</span> <span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flink提供的-table-format"><span class="toc-number">2.</span> <span class="toc-text">Flink提供的 table format</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用过程中的注意点"><span class="toc-number">3.</span> <span class="toc-text">使用过程中的注意点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用MySQL-CDC的注意点"><span class="toc-number">3.1.</span> <span class="toc-text">使用MySQL CDC的注意点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用canal-json的注意点"><span class="toc-number">3.2.</span> <span class="toc-text">使用canal-json的注意点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用changelog-json的注意点"><span class="toc-number">3.3.</span> <span class="toc-text">使用changelog-json的注意点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql-cdc的操作实践"><span class="toc-number">4.</span> <span class="toc-text">mysql-cdc的操作实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建MySQL数据源表"><span class="toc-number">4.1.</span> <span class="toc-text">创建MySQL数据源表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flink-SQL-Cli创建CDC数据源"><span class="toc-number">4.2.</span> <span class="toc-text">Flink SQL Cli创建CDC数据源</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#canal-json的操作实践"><span class="toc-number">5.</span> <span class="toc-text">canal-json的操作实践</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#changelog-json的操作实践"><span class="toc-number">6.</span> <span class="toc-text">changelog-json的操作实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建MySQL数据源"><span class="toc-number">6.1.</span> <span class="toc-text">创建MySQL数据源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flink-SQL-Cli创建changelog-json表"><span class="toc-number">6.2.</span> <span class="toc-text">Flink SQL Cli创建changelog-json表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">7.</span> <span class="toc-text">总结</span></a></li></ol></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 - 2020 <a href="/." rel="nofollow">Jmx's Blog.</a>All rights reserved.<br>Thoughts on technology, life and everything else.</div></div></div><script type="text/javascript" src="/js/toc.js?v=0.0.0"></script><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="100,99,98" opacity="0.5" zindex="0.7" count="150" src="//lib.baomitu.com/canvas-nest.js/2.0.4/canvas-nest.umd.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>