<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="记录朴实无华且枯燥的生活"><title>元数据管理|Hive Hooks和Metastore监听器介绍 | Jmx's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '912b6cfc43243cd27aeb428f7dbf7823';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="/js/toc.js?v=0.0.0"></script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">元数据管理|Hive Hooks和Metastore监听器介绍</h1><a id="logo" href="/.">Jmx's Blog</a><p class="description">Keep it Simple and Stupid!</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-pied-piper-alt"> 关于</i></a><a href="/tags"><i class="fa fa-tags"> 标签</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">元数据管理|Hive Hooks和Metastore监听器介绍</h1><div class="post-meta">Aug 20, 2020<span> | </span><span class="category"><a href="/categories/Hive/">Hive</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 5.4k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 25</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="post-content"><p>元数据管理是数据仓库的核心，它不仅定义了数据仓库有什么，还指明了数据仓库中数据的内容和位置，刻画了数据的提取和转换规则，存储了与数据仓库主题有关的各种商业信息。本文主要介绍Hive Hook和MetaStore Listener，使用这些功能可以进行自动的元数据管理。通过本文你可以了解到：</p>
<ul>
<li>元数据管理</li>
<li><strong>Hive Hooks 和 Metastore Listeners</strong></li>
<li><strong>Hive Hooks</strong>基本使用</li>
<li><strong>Metastore Listeners</strong>基本使用</li>
</ul>
<h2 id="元数据管理"><a href="#元数据管理" class="headerlink" title="元数据管理"></a>元数据管理</h2><h3 id="元数据定义"><a href="#元数据定义" class="headerlink" title="元数据定义"></a>元数据定义</h3><p>按照传统的定义，元数据（ Metadata ）是关于数据的数据。元数据打通了源数据、数据仓库、数据应用，记录了数据从产生到消费的全过程。元数据主要记录数据仓库中模型的定义、各层级间的映射关系、监控数据仓库的数据状态及ETL 的任务运行状态。在数据仓库系统中，元数据可以帮助数据仓库管理员和开发人员非常方便地找到他们所关心的数据，用于指导其进行数据管理和开发工作，提高工作效率。将元数据按用途的不同分为两类：技术元数据（ Technical Metadata)和业务元数据（ Business Metadata ）。技术元数据是存储关于数据仓库系统技术细节的数据，是用于开发和管理数据仓库使用的数据。</p>
<h3 id="元数据分类"><a href="#元数据分类" class="headerlink" title="元数据分类"></a>元数据分类</h3><h4 id="技术元数据"><a href="#技术元数据" class="headerlink" title="技术元数据"></a>技术元数据</h4><ul>
<li>分布式计算系统存储元数据</li>
</ul>
<p>如Hive表、列、分区等信息。记录了表的表名。分区信息、责任人信息、文件大小、表类型，以及列的字段名、字段类型、字段备注、是否是分区字段等信息。</p>
<ul>
<li><p>分布式计算系统运行元数据</p>
<p>类似于Hive 的Job 日志，包括作业类型、实例名称、输入输出、SQL 、运行参数、执行时间等。</p>
</li>
<li><p>任务调度元数据</p>
<p>任务的依赖类型、依赖关系等，以及不同类型调度任务的运行日志等。</p>
</li>
</ul>
<h4 id="业务元数据"><a href="#业务元数据" class="headerlink" title="业务元数据"></a>业务元数据</h4><p>业务元数据从业务角度描述了数据仓库中的数据，它提供了介于使用者和实际系统之间的语义层，使得不懂计算机技术的业务人员也能够“ 读懂”数据仓库中的数据。常见的业务元数据有：如维度及属性、业务过程、指标等的规范化定义，用于更好地管理和使用数据；数据应用元数据，如数据报表、数据产品等的配置和运行元数据。</p>
<h3 id="元数据应用"><a href="#元数据应用" class="headerlink" title="元数据应用"></a>元数据应用</h3><p>数据的真正价值在于数据驱动决策，通过数据指导运营。通过数据驱动的方法，我们能够判断趋势，从而展开有效行动，帮助自己发现问题，推动创新或解决方案的产生。这就是数据化运营。同样，对于元数据，可以用于指导数据相关人员进行日常工作，实现数据化“运营”。比如对于数据使用者，可以通过元数据让其快速找到所需要的数据；对于ETL 工程师，可以通过元数据指导其进行模型设计、任务优化和任务下线等各种日常ETL 工作；对于运维工程师，可以通过元数据指导其进行整个集群的存储、计算和系统优化等运维工作。</p>
<h2 id="Hive-Hooks-和-Metastore-Listeners"><a href="#Hive-Hooks-和-Metastore-Listeners" class="headerlink" title="Hive Hooks 和 Metastore Listeners"></a><strong>Hive Hooks 和 Metastore Listeners</strong></h2><h3 id="Hive-Hooks"><a href="#Hive-Hooks" class="headerlink" title="Hive Hooks"></a><strong>Hive Hooks</strong></h3><p>关于数据治理和元数据管理框架，业界有许多开源的系统，比如<strong>Apache Atlas</strong>，这些开源的软件可以在复杂的场景下满足元数据管理的需求。其实<strong>Apache Atlas</strong>对于Hive的元数据管理，使用的是Hive的Hooks。需要进行如下配置：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.exec.post.hooks<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.atlas.hive.hook.HiveHook<span class="tag">&lt;<span class="name">value</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过Hook监听Hive的各种事件，比如创建表，修改表等，然后按照特定的格式把收集的数据推送到Kafka，最后消费元数据并存储。</p>
<h4 id="Hive-Hooks分类"><a href="#Hive-Hooks分类" class="headerlink" title="Hive Hooks分类"></a>Hive Hooks分类</h4><p><strong>那么，究竟什么是Hooks呢？</strong></p>
<p>Hooks 是一种事件和消息机制， 可以将事件绑定在内部 Hive 的执行流程中，而无需重新编译 Hive。Hook 提供了扩展和继承外部组件的方式。根据不同的 Hook 类型，可以在不同的阶段运行。关于Hooks的类型，主要分为以下几种：</p>
<ul>
<li><strong>hive.exec.pre.hooks</strong></li>
</ul>
<p>从名称可以看出，在执行引擎执行查询之前被调用。这个需要在 Hive 对查询计划进行过优化之后才可以使用。使用该Hooks需要实现接口：<strong>org.apache.hadoop.hive.ql.hooks.ExecuteWithHookContext</strong>，具体在<strong>hive-site.xml</strong>中的配置如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.exec.pre.hooks<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>实现类的全限定名<span class="tag">&lt;<span class="name">value</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>hive.exec.post.hooks</strong></li>
</ul>
<p>在执行计划执行结束结果返回给用户之前被调用。使用时需要实现接口：<strong>org.apache.hadoop.hive.ql.hooks.ExecuteWithHookContext</strong>，具体在<strong>hive-site.xml</strong>中的配置如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.exec.post.hooks<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>实现类的全限定名<span class="tag">&lt;<span class="name">value</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>hive.exec.failure.hooks</strong></li>
</ul>
<p>在执行计划失败之后被调用。使用时需要实现接口：<strong>org.apache.hadoop.hive.ql.hooks.ExecuteWithHookContext</strong>,具体在<strong>hive-site.xml</strong>中的配置如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.exec.failure.hooks<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>实现类的全限定名<span class="tag">&lt;<span class="name">value</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>hive.metastore.init.hooks</strong></li>
</ul>
<p>HMSHandler初始化是被调用。使用时需要实现接口：<strong>org.apache.hadoop.hive.metastore.MetaStoreInitListener</strong>，具体在<strong>hive-site.xml</strong>中的配置如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.init.hooks<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>实现类的全限定名<span class="tag">&lt;<span class="name">value</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>hive.exec.driver.run.hooks</strong></li>
</ul>
<p>在Driver.run开始或结束时运行，使用时需要实现接口：<strong>org.apache.hadoop.hive.ql.HiveDriverRunHook</strong>，具体在<strong>hive-site.xml</strong>中的配置如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.exec.driver.run.hooks<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>实现类的全限定名<span class="tag">&lt;<span class="name">value</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>hive.semantic.analyzer.hook</strong></li>
</ul>
<p>Hive 对查询语句进行语义分析的时候调用。使用时需要集成抽象类：<strong>org.apache.hadoop.hive.ql.parse.AbstractSemanticAnalyzerHook</strong>，具体在<strong>hive-site.xml</strong>中的配置如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.semantic.analyzer.hook<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>实现类的全限定名<span class="tag">&lt;<span class="name">value</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Hive-Hooks的优缺点"><a href="#Hive-Hooks的优缺点" class="headerlink" title="Hive Hooks的优缺点"></a>Hive Hooks的优缺点</h4><ul>
<li>优点<ul>
<li>可以很方便地在各种查询阶段嵌入或者运行自定义的代码</li>
<li>可以被用作更新元数据</li>
</ul>
</li>
<li>缺点<ul>
<li>当使用Hooks时，获取到的元数据通常需要进一步解析，否则很难理解</li>
<li>会影响查询的过程</li>
</ul>
</li>
</ul>
<blockquote>
<p>对于Hive Hooks，本文将给出<strong>hive.exec.post.hook</strong>的使用案例，该Hooks会在查询执行之后，返回结果之前运行。</p>
</blockquote>
<h3 id="Metastore-Listeners"><a href="#Metastore-Listeners" class="headerlink" title="Metastore Listeners"></a>Metastore Listeners</h3><p>所谓Metastore Listeners，指的是对Hive metastore的监听。用户可以自定义一些代码，用来使用对元数据的监听。</p>
<p>当我们看<strong>HiveMetaStore</strong>这个类的源码时，会发现：<strong>在创建HiveMetaStore的init()方法中，同时创建了三种Listener,分别为MetaStorePreEventListener，MetaStoreEventListener和MetaStoreEndFunctionListener，这些Listener用于对每一步事件的监听。</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HiveMetaStore</span> <span class="keyword">extends</span> <span class="title">ThriftHiveMetastore</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...省略代码</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HMSHandler</span> <span class="keyword">extends</span> <span class="title">FacebookBase</span> <span class="keyword">implements</span></span></span><br><span class="line"><span class="class">            <span class="title">IHMSHandler</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...省略代码</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> MetaException </span>&#123;</span><br><span class="line">            <span class="comment">// ...省略代码</span></span><br><span class="line">            <span class="comment">// 获取MetaStorePreEventListener</span></span><br><span class="line">            preListeners = MetaStoreUtils.getMetaStoreListeners(MetaStorePreEventListener.class,</span><br><span class="line">                    hiveConf,</span><br><span class="line">                    hiveConf.getVar(HiveConf.ConfVars.METASTORE_PRE_EVENT_LISTENERS));</span><br><span class="line">            <span class="comment">// 获取MetaStoreEventListener</span></span><br><span class="line">            listeners = MetaStoreUtils.getMetaStoreListeners(MetaStoreEventListener.class,</span><br><span class="line">                    hiveConf,</span><br><span class="line">                    hiveConf.getVar(HiveConf.ConfVars.METASTORE_EVENT_LISTENERS));</span><br><span class="line">            listeners.add(<span class="keyword">new</span> SessionPropertiesListener(hiveConf));</span><br><span class="line">            <span class="comment">// 获取MetaStoreEndFunctionListener</span></span><br><span class="line">            endFunctionListeners = MetaStoreUtils.getMetaStoreListeners(</span><br><span class="line">                    MetaStoreEndFunctionListener.class, </span><br><span class="line">                    hiveConf,</span><br><span class="line">                    hiveConf.getVar(HiveConf.ConfVars.METASTORE_END_FUNCTION_LISTENERS));</span><br><span class="line">            <span class="comment">// ...省略代码</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Metastore-Listeners分类"><a href="#Metastore-Listeners分类" class="headerlink" title="Metastore Listeners分类"></a>Metastore Listeners分类</h4><ul>
<li><strong>hive.metastore.pre.event.listeners</strong></li>
</ul>
<p>需要扩展此抽象类，以提供在metastore上发生特定事件之前需要执行的操作实现。在metastore上发生事件之前，将调用这些方法。</p>
<p>使用时需要继承抽象类：<strong>org.apache.hadoop.hive.metastore.MetaStorePreEventListener</strong>，在<strong>Hive-site.xml</strong>中的配置为：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.pre.event.listeners<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">value</span>&gt;</span>实现类的全限定名<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>hive.metastore.event.listeners</strong></li>
</ul>
<p>需要扩展此抽象类，以提供在metastore上发生特定事件时需要执行的操作实现。每当Metastore上发生事件时，就会调用这些方法。</p>
<p>使用时需要继承抽象类：<strong>org.apache.hadoop.hive.metastore.MetaStoreEventListener</strong>，在<strong>Hive-site.xml</strong>中的配置为：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.event.listeners<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>实现类的全限定名<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>hive.metastore.end.function.listeners</strong></li>
</ul>
<p>每当函数结束时，将调用这些方法。</p>
<p>使用时需要继承抽象类：<strong>org.apache.hadoop.hive.metastore.MetaStoreEndFunctionListener **，在</strong>Hive-site.xml**中的配置为：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.end.function.listeners<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>实现类的全限定名<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Metastore-Listeners优缺点"><a href="#Metastore-Listeners优缺点" class="headerlink" title="Metastore Listeners优缺点"></a>Metastore Listeners优缺点</h4><ul>
<li>优点<ul>
<li>元数据已经被解析好了，很容易理解</li>
<li>不影响查询的过程，是只读的</li>
</ul>
</li>
<li>缺点<ul>
<li>不灵活，仅仅能够访问属于当前事件的对象</li>
</ul>
</li>
</ul>
<blockquote>
<p>对于metastore listener，本文会给出<strong>MetaStoreEventListener</strong>的使用案例，具体会实现两个方法：onCreateTable和onAlterTable</p>
</blockquote>
<h2 id="Hive-Hooks基本使用"><a href="#Hive-Hooks基本使用" class="headerlink" title="Hive Hooks基本使用"></a><strong>Hive Hooks</strong>基本使用</h2><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>具体实现代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomPostHook</span> <span class="keyword">implements</span> <span class="title">ExecuteWithHookContext</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(CustomPostHook.class);</span><br><span class="line">    <span class="comment">// 存储Hive的SQL操作类型</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> HashSet&lt;String&gt; OPERATION_NAMES = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// HiveOperation是一个枚举类，封装了Hive的SQL操作类型</span></span><br><span class="line">    <span class="comment">// 监控SQL操作类型</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">// 建表</span></span><br><span class="line">        OPERATION_NAMES.add(HiveOperation.CREATETABLE.getOperationName());</span><br><span class="line">        <span class="comment">// 修改数据库属性</span></span><br><span class="line">        OPERATION_NAMES.add(HiveOperation.ALTERDATABASE.getOperationName());</span><br><span class="line">        <span class="comment">// 修改数据库属主</span></span><br><span class="line">        OPERATION_NAMES.add(HiveOperation.ALTERDATABASE_OWNER.getOperationName());</span><br><span class="line">        <span class="comment">// 修改表属性,添加列</span></span><br><span class="line">        OPERATION_NAMES.add(HiveOperation.ALTERTABLE_ADDCOLS.getOperationName());</span><br><span class="line">        <span class="comment">// 修改表属性,表存储路径</span></span><br><span class="line">        OPERATION_NAMES.add(HiveOperation.ALTERTABLE_LOCATION.getOperationName());</span><br><span class="line">        <span class="comment">// 修改表属性</span></span><br><span class="line">        OPERATION_NAMES.add(HiveOperation.ALTERTABLE_PROPERTIES.getOperationName());</span><br><span class="line">        <span class="comment">// 表重命名</span></span><br><span class="line">        OPERATION_NAMES.add(HiveOperation.ALTERTABLE_RENAME.getOperationName());</span><br><span class="line">        <span class="comment">// 列重命名</span></span><br><span class="line">        OPERATION_NAMES.add(HiveOperation.ALTERTABLE_RENAMECOL.getOperationName());</span><br><span class="line">        <span class="comment">// 更新列,先删除当前的列,然后加入新的列</span></span><br><span class="line">        OPERATION_NAMES.add(HiveOperation.ALTERTABLE_REPLACECOLS.getOperationName());</span><br><span class="line">        <span class="comment">// 创建数据库</span></span><br><span class="line">        OPERATION_NAMES.add(HiveOperation.CREATEDATABASE.getOperationName());</span><br><span class="line">        <span class="comment">// 删除数据库</span></span><br><span class="line">        OPERATION_NAMES.add(HiveOperation.DROPDATABASE.getOperationName());</span><br><span class="line">        <span class="comment">// 删除表</span></span><br><span class="line">        OPERATION_NAMES.add(HiveOperation.DROPTABLE.getOperationName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(HookContext hookContext)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">assert</span> (hookContext.getHookType() == HookType.POST_EXEC_HOOK);</span><br><span class="line">        <span class="comment">// 执行计划</span></span><br><span class="line">        QueryPlan plan = hookContext.getQueryPlan();</span><br><span class="line">        <span class="comment">// 操作名称</span></span><br><span class="line">        String operationName = plan.getOperationName();</span><br><span class="line">        logWithHeader(<span class="string">"执行的SQL语句: "</span> + plan.getQueryString());</span><br><span class="line">        logWithHeader(<span class="string">"操作名称: "</span> + operationName);</span><br><span class="line">        <span class="keyword">if</span> (OPERATION_NAMES.contains(operationName) &amp;&amp; !plan.isExplain()) &#123;</span><br><span class="line">            logWithHeader(<span class="string">"监控SQL操作"</span>);</span><br><span class="line"></span><br><span class="line">            Set&lt;ReadEntity&gt; inputs = hookContext.getInputs();</span><br><span class="line">            Set&lt;WriteEntity&gt; outputs = hookContext.getOutputs();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (Entity entity : inputs) &#123;</span><br><span class="line">                logWithHeader(<span class="string">"Hook metadata输入值: "</span> + toJson(entity));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (Entity entity : outputs) &#123;</span><br><span class="line">                logWithHeader(<span class="string">"Hook metadata输出值: "</span> + toJson(entity));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logWithHeader(<span class="string">"不在监控范围，忽略该hook!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">toJson</span><span class="params">(Entity entity)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        <span class="comment">//  entity的类型</span></span><br><span class="line">        <span class="comment">// 主要包括：</span></span><br><span class="line">        <span class="comment">// DATABASE, TABLE, PARTITION, DUMMYPARTITION, DFS_DIR, LOCAL_DIR, FUNCTION</span></span><br><span class="line">        <span class="keyword">switch</span> (entity.getType()) &#123;</span><br><span class="line">            <span class="keyword">case</span> DATABASE:</span><br><span class="line">                Database db = entity.getDatabase();</span><br><span class="line">                <span class="keyword">return</span> mapper.writeValueAsString(db);</span><br><span class="line">            <span class="keyword">case</span> TABLE:</span><br><span class="line">                <span class="keyword">return</span> mapper.writeValueAsString(entity.getTable().getTTable());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 日志格式</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">logWithHeader</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        LOGGER.info(<span class="string">"[CustomPostHook][Thread: "</span> + Thread.currentThread().getName() + <span class="string">"] | "</span> + obj);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用过程解释"><a href="#使用过程解释" class="headerlink" title="使用过程解释"></a>使用过程解释</h3><p>首先将上述代码编译成jar包，放在$HIVE_HOME/lib目录下，或者使用在Hive的客户端中执行添加jar包的命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">0: jdbc:hive2://localhost:10000&gt; add jar /opt/softwares/com.jmx.hive-1.0-SNAPSHOT.jar;</span><br></pre></td></tr></table></figure>

<p>接着配置Hive-site.xml文件，为了方便，我们直接使用客户端命令进行配置：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">0: jdbc:hive2://localhost:10000&gt; set hive.exec.post.hooks=com.jmx.hooks.CustomPostHook;</span><br></pre></td></tr></table></figure>

<h4 id="查看表操作"><a href="#查看表操作" class="headerlink" title="查看表操作"></a>查看表操作</h4><p>上面的代码中我们对一些操作进行了监控，当监控到这些操作时会触发一些自定义的代码(比如输出日志)。当我们在Hive的beeline客户端中输入下面命令时：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">0: jdbc:hive2://localhost:10000&gt; show tables;</span><br></pre></td></tr></table></figure>

<p>在$HIVE_HOME/logs/hive.log文件可以看到：</p>
<p><img src="//jiamaoxiang.top/2020/08/20/元数据管理-Hive-Hooks和Metastore监听器介绍/%E5%9B%BE1.png" alt></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[CustomPostHook][Thread: cab9a763-c63e-4f25-9f9a-affacb3cecdb main] | 执行的SQL语句: show tables</span><br><span class="line">[CustomPostHook][Thread: cab9a763-c63e-4f25-9f9a-affacb3cecdb main] | 操作名称: SHOWTABLES</span><br><span class="line">[CustomPostHook][Thread: cab9a763-c63e-4f25-9f9a-affacb3cecdb main] |不在监控范围，忽略该hook!</span><br></pre></td></tr></table></figure>

<p>上面的查看表操作，不在监控范围，所以没有相对应的元数据日志。</p>
<h4 id="建表操作"><a href="#建表操作" class="headerlink" title="建表操作"></a>建表操作</h4><p>当我们在Hive的beeline客户端中创建一张表时，如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> testposthook(</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">int</span> <span class="keyword">COMMENT</span> <span class="string">"id"</span>,</span><br><span class="line">  <span class="keyword">name</span> <span class="keyword">string</span> <span class="keyword">COMMENT</span> <span class="string">"姓名"</span></span><br><span class="line">)<span class="keyword">COMMENT</span> <span class="string">"建表_测试Hive Hooks"</span></span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'\t'</span></span><br><span class="line">LOCATION <span class="string">'/user/hive/warehouse/'</span>;</span><br></pre></td></tr></table></figure>

<p>观察hive.log日志：</p>
<p><img src="//jiamaoxiang.top/2020/08/20/元数据管理-Hive-Hooks和Metastore监听器介绍/%E5%9B%BE2.png" alt></p>
<p>上面的Hook metastore输出值有两个：<strong>第一个是数据库的元数据信息</strong>，<strong>第二个是表的元数据信息</strong></p>
<ul>
<li>数据库元数据</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"name"</span>:<span class="string">"default"</span>,</span><br><span class="line">    <span class="attr">"description"</span>:<span class="string">"Default Hive database"</span>,</span><br><span class="line">    <span class="attr">"locationUri"</span>:<span class="string">"hdfs://kms-1.apache.com:8020/user/hive/warehouse"</span>,</span><br><span class="line">    <span class="attr">"parameters"</span>:&#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"privileges"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"ownerName"</span>:<span class="string">"public"</span>,</span><br><span class="line">    <span class="attr">"ownerType"</span>:<span class="string">"ROLE"</span>,</span><br><span class="line">    <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"parametersSize"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"setOwnerName"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setOwnerType"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setPrivileges"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setName"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setDescription"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setLocationUri"</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>表元数据</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"tableName"</span>:<span class="string">"testposthook"</span>,</span><br><span class="line">    <span class="attr">"dbName"</span>:<span class="string">"default"</span>,</span><br><span class="line">    <span class="attr">"owner"</span>:<span class="string">"anonymous"</span>,</span><br><span class="line">    <span class="attr">"createTime"</span>:<span class="number">1597985444</span>,</span><br><span class="line">    <span class="attr">"lastAccessTime"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"retention"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"sd"</span>:&#123;</span><br><span class="line">        <span class="attr">"cols"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"location"</span>:<span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"inputFormat"</span>:<span class="string">"org.apache.hadoop.mapred.SequenceFileInputFormat"</span>,</span><br><span class="line">        <span class="attr">"outputFormat"</span>:<span class="string">"org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat"</span>,</span><br><span class="line">        <span class="attr">"compressed"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"numBuckets"</span>:<span class="number">-1</span>,</span><br><span class="line">        <span class="attr">"serdeInfo"</span>:&#123;</span><br><span class="line">            <span class="attr">"name"</span>:<span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"serializationLib"</span>:<span class="string">"org.apache.hadoop.hive.serde2.MetadataTypedColumnsetSerDe"</span>,</span><br><span class="line">            <span class="attr">"parameters"</span>:&#123;</span><br><span class="line">                <span class="attr">"serialization.format"</span>:<span class="string">"1"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"setSerializationLib"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"parametersSize"</span>:<span class="number">1</span>,</span><br><span class="line">            <span class="attr">"setName"</span>:<span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"bucketCols"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"sortCols"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"parameters"</span>:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"skewedInfo"</span>:&#123;</span><br><span class="line">            <span class="attr">"skewedColNames"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValues"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValueLocationMaps"</span>:&#123;</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"skewedColNamesIterator"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValuesSize"</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="attr">"skewedColValuesIterator"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValueLocationMapsSize"</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="attr">"setSkewedColNames"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setSkewedColValues"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setSkewedColValueLocationMaps"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"skewedColNamesSize"</span>:<span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"storedAsSubDirectories"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"colsSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"parametersSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"setOutputFormat"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setSerdeInfo"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setBucketCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setSortCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setSkewedInfo"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"colsIterator"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"setCompressed"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"setNumBuckets"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"bucketColsSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"bucketColsIterator"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"sortColsSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"sortColsIterator"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"setStoredAsSubDirectories"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"setCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setLocation"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"setInputFormat"</span>:<span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"partitionKeys"</span>:[</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"parameters"</span>:&#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"viewOriginalText"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"viewExpandedText"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"tableType"</span>:<span class="string">"MANAGED_TABLE"</span>,</span><br><span class="line">    <span class="attr">"privileges"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"temporary"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"rewriteEnabled"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"partitionKeysSize"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"setDbName"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setSd"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setCreateTime"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setLastAccessTime"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"parametersSize"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"setTableName"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setPrivileges"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setOwner"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setPartitionKeys"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setViewOriginalText"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setViewExpandedText"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setTableType"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setRetention"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"partitionKeysIterator"</span>:[</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"setTemporary"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setRewriteEnabled"</span>:<span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们发现上面的表元数据信息中，<strong>cols[]</strong>列没有数据，即没有建表时的字段<code>id</code>和字段<code>name</code>的信息。如果要获取这些信息，可以执行下面的命令：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> testposthook</span><br><span class="line"> <span class="keyword">ADD</span> <span class="keyword">COLUMNS</span> (age <span class="built_in">int</span> <span class="keyword">COMMENT</span> <span class="string">'年龄'</span>);</span><br></pre></td></tr></table></figure>

<p>再次观察日志信息：</p>
<p><img src="//jiamaoxiang.top/2020/08/20/元数据管理-Hive-Hooks和Metastore监听器介绍/%E5%9B%BE3.png" alt></p>
<p>上面的日志中，Hook metastore只有一个输入和一个输出：都表示table的元数据信息。</p>
<ul>
<li>输入</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"tableName"</span>:<span class="string">"testposthook"</span>,</span><br><span class="line">    <span class="attr">"dbName"</span>:<span class="string">"default"</span>,</span><br><span class="line">    <span class="attr">"owner"</span>:<span class="string">"anonymous"</span>,</span><br><span class="line">    <span class="attr">"createTime"</span>:<span class="number">1597985445</span>,</span><br><span class="line">    <span class="attr">"lastAccessTime"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"retention"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"sd"</span>:&#123;</span><br><span class="line">        <span class="attr">"cols"</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"int"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"name"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"string"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"姓名"</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"location"</span>:<span class="string">"hdfs://kms-1.apache.com:8020/user/hive/warehouse"</span>,</span><br><span class="line">        <span class="attr">"inputFormat"</span>:<span class="string">"org.apache.hadoop.mapred.TextInputFormat"</span>,</span><br><span class="line">        <span class="attr">"outputFormat"</span>:<span class="string">"org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat"</span>,</span><br><span class="line">        <span class="attr">"compressed"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"numBuckets"</span>:<span class="number">-1</span>,</span><br><span class="line">        <span class="attr">"serdeInfo"</span>:&#123;</span><br><span class="line">            <span class="attr">"name"</span>:<span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"serializationLib"</span>:<span class="string">"org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe"</span>,</span><br><span class="line">            <span class="attr">"parameters"</span>:&#123;</span><br><span class="line">                <span class="attr">"serialization.format"</span>:<span class="string">"	"</span>,</span><br><span class="line">                <span class="attr">"field.delim"</span>:<span class="string">"	"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"setSerializationLib"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"parametersSize"</span>:<span class="number">2</span>,</span><br><span class="line">            <span class="attr">"setName"</span>:<span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"bucketCols"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"sortCols"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"parameters"</span>:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"skewedInfo"</span>:&#123;</span><br><span class="line">            <span class="attr">"skewedColNames"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValues"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValueLocationMaps"</span>:&#123;</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"skewedColNamesIterator"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValuesSize"</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="attr">"skewedColValuesIterator"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValueLocationMapsSize"</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="attr">"setSkewedColNames"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setSkewedColValues"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setSkewedColValueLocationMaps"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"skewedColNamesSize"</span>:<span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"storedAsSubDirectories"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"colsSize"</span>:<span class="number">2</span>,</span><br><span class="line">        <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"parametersSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"setOutputFormat"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setSerdeInfo"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setBucketCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setSortCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setSkewedInfo"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"colsIterator"</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"int"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"name"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"string"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"姓名"</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"setCompressed"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setNumBuckets"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"bucketColsSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"bucketColsIterator"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"sortColsSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"sortColsIterator"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"setStoredAsSubDirectories"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setLocation"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setInputFormat"</span>:<span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"partitionKeys"</span>:[</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"parameters"</span>:&#123;</span><br><span class="line">        <span class="attr">"transient_lastDdlTime"</span>:<span class="string">"1597985445"</span>,</span><br><span class="line">        <span class="attr">"comment"</span>:<span class="string">"建表_测试Hive Hooks"</span>,</span><br><span class="line">        <span class="attr">"totalSize"</span>:<span class="string">"0"</span>,</span><br><span class="line">        <span class="attr">"numFiles"</span>:<span class="string">"0"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"viewOriginalText"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"viewExpandedText"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"tableType"</span>:<span class="string">"MANAGED_TABLE"</span>,</span><br><span class="line">    <span class="attr">"privileges"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"temporary"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"rewriteEnabled"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"partitionKeysSize"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"setDbName"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setSd"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setCreateTime"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setLastAccessTime"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"parametersSize"</span>:<span class="number">4</span>,</span><br><span class="line">    <span class="attr">"setTableName"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setPrivileges"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setOwner"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setPartitionKeys"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setViewOriginalText"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setViewExpandedText"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setTableType"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setRetention"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"partitionKeysIterator"</span>:[</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"setTemporary"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setRewriteEnabled"</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从上面的json中可以看出<strong>“cols”</strong>列的字段元数据信息，我们再来看一下输出json：</p>
<ul>
<li>输出</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"tableName"</span>:<span class="string">"testposthook"</span>,</span><br><span class="line">    <span class="attr">"dbName"</span>:<span class="string">"default"</span>,</span><br><span class="line">    <span class="attr">"owner"</span>:<span class="string">"anonymous"</span>,</span><br><span class="line">    <span class="attr">"createTime"</span>:<span class="number">1597985445</span>,</span><br><span class="line">    <span class="attr">"lastAccessTime"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"retention"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"sd"</span>:&#123;</span><br><span class="line">        <span class="attr">"cols"</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"int"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"name"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"string"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"姓名"</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"location"</span>:<span class="string">"hdfs://kms-1.apache.com:8020/user/hive/warehouse"</span>,</span><br><span class="line">        <span class="attr">"inputFormat"</span>:<span class="string">"org.apache.hadoop.mapred.TextInputFormat"</span>,</span><br><span class="line">        <span class="attr">"outputFormat"</span>:<span class="string">"org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat"</span>,</span><br><span class="line">        <span class="attr">"compressed"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"numBuckets"</span>:<span class="number">-1</span>,</span><br><span class="line">        <span class="attr">"serdeInfo"</span>:&#123;</span><br><span class="line">            <span class="attr">"name"</span>:<span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"serializationLib"</span>:<span class="string">"org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe"</span>,</span><br><span class="line">            <span class="attr">"parameters"</span>:&#123;</span><br><span class="line">                <span class="attr">"serialization.format"</span>:<span class="string">"	"</span>,</span><br><span class="line">                <span class="attr">"field.delim"</span>:<span class="string">"	"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"setSerializationLib"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"parametersSize"</span>:<span class="number">2</span>,</span><br><span class="line">            <span class="attr">"setName"</span>:<span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"bucketCols"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"sortCols"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"parameters"</span>:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"skewedInfo"</span>:&#123;</span><br><span class="line">            <span class="attr">"skewedColNames"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValues"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValueLocationMaps"</span>:&#123;</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"skewedColNamesIterator"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValuesSize"</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="attr">"skewedColValuesIterator"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValueLocationMapsSize"</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="attr">"setSkewedColNames"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setSkewedColValues"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setSkewedColValueLocationMaps"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"skewedColNamesSize"</span>:<span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"storedAsSubDirectories"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"colsSize"</span>:<span class="number">2</span>,</span><br><span class="line">        <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"parametersSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"setOutputFormat"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setSerdeInfo"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setBucketCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setSortCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setSkewedInfo"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"colsIterator"</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"int"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"name"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"string"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"姓名"</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"setCompressed"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setNumBuckets"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"bucketColsSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"bucketColsIterator"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"sortColsSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"sortColsIterator"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"setStoredAsSubDirectories"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setLocation"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setInputFormat"</span>:<span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"partitionKeys"</span>:[</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"parameters"</span>:&#123;</span><br><span class="line">        <span class="attr">"transient_lastDdlTime"</span>:<span class="string">"1597985445"</span>,</span><br><span class="line">        <span class="attr">"comment"</span>:<span class="string">"建表_测试Hive Hooks"</span>,</span><br><span class="line">        <span class="attr">"totalSize"</span>:<span class="string">"0"</span>,</span><br><span class="line">        <span class="attr">"numFiles"</span>:<span class="string">"0"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"viewOriginalText"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"viewExpandedText"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"tableType"</span>:<span class="string">"MANAGED_TABLE"</span>,</span><br><span class="line">    <span class="attr">"privileges"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"temporary"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"rewriteEnabled"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"partitionKeysSize"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"setDbName"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setSd"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setCreateTime"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setLastAccessTime"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"parametersSize"</span>:<span class="number">4</span>,</span><br><span class="line">    <span class="attr">"setTableName"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setPrivileges"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setOwner"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setPartitionKeys"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setViewOriginalText"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setViewExpandedText"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setTableType"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setRetention"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"partitionKeysIterator"</span>:[</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"setTemporary"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setRewriteEnabled"</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该<code>output</code>对象不包含新列<code>age</code>，它表示修改表之前的元数据信息</p>
</blockquote>
<h2 id="Metastore-Listeners基本使用"><a href="#Metastore-Listeners基本使用" class="headerlink" title="Metastore Listeners基本使用"></a><strong>Metastore Listeners</strong>基本使用</h2><h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><p>具体实现代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomListener</span> <span class="keyword">extends</span> <span class="title">MetaStoreEventListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(CustomListener.class);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectMapper objMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomListener</span><span class="params">(Configuration config)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(config);</span><br><span class="line">        logWithHeader(<span class="string">" created "</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 监听建表操作</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreateTable</span><span class="params">(CreateTableEvent event)</span> </span>&#123;</span><br><span class="line">        logWithHeader(event.getTable());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 监听修改表操作</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAlterTable</span><span class="params">(AlterTableEvent event)</span> </span>&#123;</span><br><span class="line">        logWithHeader(event.getOldTable());</span><br><span class="line">        logWithHeader(event.getNewTable());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">logWithHeader</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        LOGGER.info(<span class="string">"[CustomListener][Thread: "</span> + Thread.currentThread().getName() + <span class="string">"] | "</span> + objToStr(obj));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">objToStr</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> objMapper.writeValueAsString(obj);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            LOGGER.error(<span class="string">"Error on conversion"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用过程解释-1"><a href="#使用过程解释-1" class="headerlink" title="使用过程解释"></a>使用过程解释</h3><p>使用方式与Hooks有一点不同，Hive Hook是与Hiveserver进行交互的，而Listener是与Metastore交互的，即Listener运行在Metastore进程中的。具体使用方式如下：</p>
<p>首先将jar包放在$HIVE_HOME/lib目录下，然后配置hive-site.xml文件，配置内容为：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.event.listeners<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.jmx.hooks.CustomListener<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置完成之后，需要重新启动元数据服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bin/hive --service metastore &amp;</span><br></pre></td></tr></table></figure>

<h4 id="建表操作-1"><a href="#建表操作-1" class="headerlink" title="建表操作"></a>建表操作</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> testlistener(</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">int</span> <span class="keyword">COMMENT</span> <span class="string">"id"</span>,</span><br><span class="line">  <span class="keyword">name</span> <span class="keyword">string</span> <span class="keyword">COMMENT</span> <span class="string">"姓名"</span></span><br><span class="line">)<span class="keyword">COMMENT</span> <span class="string">"建表_测试Hive Listener"</span></span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'\t'</span></span><br><span class="line">LOCATION <span class="string">'/user/hive/warehouse/'</span>;</span><br></pre></td></tr></table></figure>

<p>观察hive.log日志：</p>
<p><img src="//jiamaoxiang.top/2020/08/20/元数据管理-Hive-Hooks和Metastore监听器介绍/%E5%9B%BE4.png" alt></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"tableName"</span>:<span class="string">"testlistener"</span>,</span><br><span class="line">    <span class="attr">"dbName"</span>:<span class="string">"default"</span>,</span><br><span class="line">    <span class="attr">"owner"</span>:<span class="string">"anonymous"</span>,</span><br><span class="line">    <span class="attr">"createTime"</span>:<span class="number">1597989316</span>,</span><br><span class="line">    <span class="attr">"lastAccessTime"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"retention"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"sd"</span>:&#123;</span><br><span class="line">        <span class="attr">"cols"</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"int"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"name"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"string"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"姓名"</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"location"</span>:<span class="string">"hdfs://kms-1.apache.com:8020/user/hive/warehouse"</span>,</span><br><span class="line">        <span class="attr">"inputFormat"</span>:<span class="string">"org.apache.hadoop.mapred.TextInputFormat"</span>,</span><br><span class="line">        <span class="attr">"outputFormat"</span>:<span class="string">"org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat"</span>,</span><br><span class="line">        <span class="attr">"compressed"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"numBuckets"</span>:<span class="number">-1</span>,</span><br><span class="line">        <span class="attr">"serdeInfo"</span>:&#123;</span><br><span class="line">            <span class="attr">"name"</span>:<span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"serializationLib"</span>:<span class="string">"org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe"</span>,</span><br><span class="line">            <span class="attr">"parameters"</span>:&#123;</span><br><span class="line">                <span class="attr">"serialization.format"</span>:<span class="string">"	"</span>,</span><br><span class="line">                <span class="attr">"field.delim"</span>:<span class="string">"	"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"setSerializationLib"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"parametersSize"</span>:<span class="number">2</span>,</span><br><span class="line">            <span class="attr">"setName"</span>:<span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"bucketCols"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"sortCols"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"parameters"</span>:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"skewedInfo"</span>:&#123;</span><br><span class="line">            <span class="attr">"skewedColNames"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValues"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValueLocationMaps"</span>:&#123;</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"setSkewedColNames"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setSkewedColValues"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setSkewedColValueLocationMaps"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"skewedColNamesSize"</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="attr">"skewedColNamesIterator"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValuesSize"</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="attr">"skewedColValuesIterator"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValueLocationMapsSize"</span>:<span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"storedAsSubDirectories"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"setCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setOutputFormat"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setSerdeInfo"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setBucketCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setSortCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"colsSize"</span>:<span class="number">2</span>,</span><br><span class="line">        <span class="attr">"colsIterator"</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"int"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"name"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"string"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"姓名"</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"setCompressed"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setNumBuckets"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"bucketColsSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"bucketColsIterator"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"sortColsSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"sortColsIterator"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"setStoredAsSubDirectories"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setLocation"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setInputFormat"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"parametersSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"setSkewedInfo"</span>:<span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"partitionKeys"</span>:[</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"parameters"</span>:&#123;</span><br><span class="line">        <span class="attr">"transient_lastDdlTime"</span>:<span class="string">"1597989316"</span>,</span><br><span class="line">        <span class="attr">"comment"</span>:<span class="string">"建表_测试Hive Listener"</span>,</span><br><span class="line">        <span class="attr">"totalSize"</span>:<span class="string">"0"</span>,</span><br><span class="line">        <span class="attr">"numFiles"</span>:<span class="string">"0"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"viewOriginalText"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"viewExpandedText"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"tableType"</span>:<span class="string">"MANAGED_TABLE"</span>,</span><br><span class="line">    <span class="attr">"privileges"</span>:&#123;</span><br><span class="line">        <span class="attr">"userPrivileges"</span>:&#123;</span><br><span class="line">            <span class="attr">"anonymous"</span>:[</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"privilege"</span>:<span class="string">"INSERT"</span>,</span><br><span class="line">                    <span class="attr">"createTime"</span>:<span class="number">-1</span>,</span><br><span class="line">                    <span class="attr">"grantor"</span>:<span class="string">"anonymous"</span>,</span><br><span class="line">                    <span class="attr">"grantorType"</span>:<span class="string">"USER"</span>,</span><br><span class="line">                    <span class="attr">"grantOption"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setGrantOption"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setCreateTime"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setGrantor"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setGrantorType"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setPrivilege"</span>:<span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"privilege"</span>:<span class="string">"SELECT"</span>,</span><br><span class="line">                    <span class="attr">"createTime"</span>:<span class="number">-1</span>,</span><br><span class="line">                    <span class="attr">"grantor"</span>:<span class="string">"anonymous"</span>,</span><br><span class="line">                    <span class="attr">"grantorType"</span>:<span class="string">"USER"</span>,</span><br><span class="line">                    <span class="attr">"grantOption"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setGrantOption"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setCreateTime"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setGrantor"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setGrantorType"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setPrivilege"</span>:<span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"privilege"</span>:<span class="string">"UPDATE"</span>,</span><br><span class="line">                    <span class="attr">"createTime"</span>:<span class="number">-1</span>,</span><br><span class="line">                    <span class="attr">"grantor"</span>:<span class="string">"anonymous"</span>,</span><br><span class="line">                    <span class="attr">"grantorType"</span>:<span class="string">"USER"</span>,</span><br><span class="line">                    <span class="attr">"grantOption"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setGrantOption"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setCreateTime"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setGrantor"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setGrantorType"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setPrivilege"</span>:<span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"privilege"</span>:<span class="string">"DELETE"</span>,</span><br><span class="line">                    <span class="attr">"createTime"</span>:<span class="number">-1</span>,</span><br><span class="line">                    <span class="attr">"grantor"</span>:<span class="string">"anonymous"</span>,</span><br><span class="line">                    <span class="attr">"grantorType"</span>:<span class="string">"USER"</span>,</span><br><span class="line">                    <span class="attr">"grantOption"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setGrantOption"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setCreateTime"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setGrantor"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setGrantorType"</span>:<span class="literal">true</span>,</span><br><span class="line">                    <span class="attr">"setPrivilege"</span>:<span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"groupPrivileges"</span>:<span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"rolePrivileges"</span>:<span class="literal">null</span>,</span><br><span class="line">        <span class="attr">"setUserPrivileges"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setGroupPrivileges"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"setRolePrivileges"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"userPrivilegesSize"</span>:<span class="number">1</span>,</span><br><span class="line">        <span class="attr">"groupPrivilegesSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"rolePrivilegesSize"</span>:<span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"temporary"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"rewriteEnabled"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setPartitionKeys"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"partitionKeysSize"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"setSd"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setLastAccessTime"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setRetention"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"partitionKeysIterator"</span>:[</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"parametersSize"</span>:<span class="number">4</span>,</span><br><span class="line">    <span class="attr">"setTemporary"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setRewriteEnabled"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setTableName"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setDbName"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setOwner"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setViewOriginalText"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setViewExpandedText"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setTableType"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setPrivileges"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setCreateTime"</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们再执行修改表操作时</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> testlistener</span><br><span class="line"> <span class="keyword">ADD</span> <span class="keyword">COLUMNS</span> (age <span class="built_in">int</span> <span class="keyword">COMMENT</span> <span class="string">'年龄'</span>);</span><br></pre></td></tr></table></figure>

<p>再次观察日志：</p>
<p><img src="//jiamaoxiang.top/2020/08/20/元数据管理-Hive-Hooks和Metastore监听器介绍/%E5%9B%BE5.png" alt></p>
<p>可以看出上面有两条记录，第一条记录是old table的信息，第二条是修改之后的表的信息。</p>
<ul>
<li>old table</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"tableName"</span>:<span class="string">"testlistener"</span>,</span><br><span class="line">    <span class="attr">"dbName"</span>:<span class="string">"default"</span>,</span><br><span class="line">    <span class="attr">"owner"</span>:<span class="string">"anonymous"</span>,</span><br><span class="line">    <span class="attr">"createTime"</span>:<span class="number">1597989316</span>,</span><br><span class="line">    <span class="attr">"lastAccessTime"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"retention"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"sd"</span>:&#123;</span><br><span class="line">        <span class="attr">"cols"</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"int"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"name"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"string"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"姓名"</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"location"</span>:<span class="string">"hdfs://kms-1.apache.com:8020/user/hive/warehouse"</span>,</span><br><span class="line">        <span class="attr">"inputFormat"</span>:<span class="string">"org.apache.hadoop.mapred.TextInputFormat"</span>,</span><br><span class="line">        <span class="attr">"outputFormat"</span>:<span class="string">"org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat"</span>,</span><br><span class="line">        <span class="attr">"compressed"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"numBuckets"</span>:<span class="number">-1</span>,</span><br><span class="line">        <span class="attr">"serdeInfo"</span>:&#123;</span><br><span class="line">            <span class="attr">"name"</span>:<span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"serializationLib"</span>:<span class="string">"org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe"</span>,</span><br><span class="line">            <span class="attr">"parameters"</span>:&#123;</span><br><span class="line">                <span class="attr">"serialization.format"</span>:<span class="string">"	"</span>,</span><br><span class="line">                <span class="attr">"field.delim"</span>:<span class="string">"	"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"setSerializationLib"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"parametersSize"</span>:<span class="number">2</span>,</span><br><span class="line">            <span class="attr">"setName"</span>:<span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"bucketCols"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"sortCols"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"parameters"</span>:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"skewedInfo"</span>:&#123;</span><br><span class="line">            <span class="attr">"skewedColNames"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValues"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValueLocationMaps"</span>:&#123;</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"setSkewedColNames"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setSkewedColValues"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setSkewedColValueLocationMaps"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"skewedColNamesSize"</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="attr">"skewedColNamesIterator"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValuesSize"</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="attr">"skewedColValuesIterator"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValueLocationMapsSize"</span>:<span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"storedAsSubDirectories"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"setCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setOutputFormat"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setSerdeInfo"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setBucketCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setSortCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"colsSize"</span>:<span class="number">2</span>,</span><br><span class="line">        <span class="attr">"colsIterator"</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"int"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"name"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"string"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"姓名"</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"setCompressed"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setNumBuckets"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"bucketColsSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"bucketColsIterator"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"sortColsSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"sortColsIterator"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"setStoredAsSubDirectories"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setLocation"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setInputFormat"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"parametersSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"setSkewedInfo"</span>:<span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"partitionKeys"</span>:[</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"parameters"</span>:&#123;</span><br><span class="line">        <span class="attr">"totalSize"</span>:<span class="string">"0"</span>,</span><br><span class="line">        <span class="attr">"numFiles"</span>:<span class="string">"0"</span>,</span><br><span class="line">        <span class="attr">"transient_lastDdlTime"</span>:<span class="string">"1597989316"</span>,</span><br><span class="line">        <span class="attr">"comment"</span>:<span class="string">"建表_测试Hive Listener"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"viewOriginalText"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"viewExpandedText"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"tableType"</span>:<span class="string">"MANAGED_TABLE"</span>,</span><br><span class="line">    <span class="attr">"privileges"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"temporary"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"rewriteEnabled"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setPartitionKeys"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"partitionKeysSize"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"setSd"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setLastAccessTime"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setRetention"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"partitionKeysIterator"</span>:[</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"parametersSize"</span>:<span class="number">4</span>,</span><br><span class="line">    <span class="attr">"setTemporary"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setRewriteEnabled"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setTableName"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setDbName"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setOwner"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setViewOriginalText"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setViewExpandedText"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setTableType"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setPrivileges"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setCreateTime"</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>new table</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"tableName"</span>:<span class="string">"testlistener"</span>,</span><br><span class="line">    <span class="attr">"dbName"</span>:<span class="string">"default"</span>,</span><br><span class="line">    <span class="attr">"owner"</span>:<span class="string">"anonymous"</span>,</span><br><span class="line">    <span class="attr">"createTime"</span>:<span class="number">1597989316</span>,</span><br><span class="line">    <span class="attr">"lastAccessTime"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"retention"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"sd"</span>:&#123;</span><br><span class="line">        <span class="attr">"cols"</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"int"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"name"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"string"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"姓名"</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"age"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"int"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"年龄"</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"location"</span>:<span class="string">"hdfs://kms-1.apache.com:8020/user/hive/warehouse"</span>,</span><br><span class="line">        <span class="attr">"inputFormat"</span>:<span class="string">"org.apache.hadoop.mapred.TextInputFormat"</span>,</span><br><span class="line">        <span class="attr">"outputFormat"</span>:<span class="string">"org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat"</span>,</span><br><span class="line">        <span class="attr">"compressed"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"numBuckets"</span>:<span class="number">-1</span>,</span><br><span class="line">        <span class="attr">"serdeInfo"</span>:&#123;</span><br><span class="line">            <span class="attr">"name"</span>:<span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"serializationLib"</span>:<span class="string">"org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe"</span>,</span><br><span class="line">            <span class="attr">"parameters"</span>:&#123;</span><br><span class="line">                <span class="attr">"serialization.format"</span>:<span class="string">"	"</span>,</span><br><span class="line">                <span class="attr">"field.delim"</span>:<span class="string">"	"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"setSerializationLib"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"parametersSize"</span>:<span class="number">2</span>,</span><br><span class="line">            <span class="attr">"setName"</span>:<span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"bucketCols"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"sortCols"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"parameters"</span>:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"skewedInfo"</span>:&#123;</span><br><span class="line">            <span class="attr">"skewedColNames"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValues"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValueLocationMaps"</span>:&#123;</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"setSkewedColNames"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setSkewedColValues"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"setSkewedColValueLocationMaps"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"skewedColNamesSize"</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="attr">"skewedColNamesIterator"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValuesSize"</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="attr">"skewedColValuesIterator"</span>:[</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"skewedColValueLocationMapsSize"</span>:<span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"storedAsSubDirectories"</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"setCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setOutputFormat"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setSerdeInfo"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setBucketCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setSortCols"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"colsSize"</span>:<span class="number">3</span>,</span><br><span class="line">        <span class="attr">"colsIterator"</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"int"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"id"</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"name"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"string"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"姓名"</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>:<span class="string">"age"</span>,</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"int"</span>,</span><br><span class="line">                <span class="attr">"comment"</span>:<span class="string">"年龄"</span>,</span><br><span class="line">                <span class="attr">"setComment"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setType"</span>:<span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"setName"</span>:<span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"setCompressed"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setNumBuckets"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"bucketColsSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"bucketColsIterator"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"sortColsSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"sortColsIterator"</span>:[</span><br><span class="line"></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"setStoredAsSubDirectories"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setLocation"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"setInputFormat"</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">"parametersSize"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">"setSkewedInfo"</span>:<span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"partitionKeys"</span>:[</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"parameters"</span>:&#123;</span><br><span class="line">        <span class="attr">"totalSize"</span>:<span class="string">"0"</span>,</span><br><span class="line">        <span class="attr">"last_modified_time"</span>:<span class="string">"1597989660"</span>,</span><br><span class="line">        <span class="attr">"numFiles"</span>:<span class="string">"0"</span>,</span><br><span class="line">        <span class="attr">"transient_lastDdlTime"</span>:<span class="string">"1597989660"</span>,</span><br><span class="line">        <span class="attr">"comment"</span>:<span class="string">"建表_测试Hive Listener"</span>,</span><br><span class="line">        <span class="attr">"last_modified_by"</span>:<span class="string">"anonymous"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"viewOriginalText"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"viewExpandedText"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"tableType"</span>:<span class="string">"MANAGED_TABLE"</span>,</span><br><span class="line">    <span class="attr">"privileges"</span>:<span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"temporary"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"rewriteEnabled"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setParameters"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setPartitionKeys"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"partitionKeysSize"</span>:<span class="number">0</span>,</span><br><span class="line">    <span class="attr">"setSd"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setLastAccessTime"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setRetention"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"partitionKeysIterator"</span>:[</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"parametersSize"</span>:<span class="number">6</span>,</span><br><span class="line">    <span class="attr">"setTemporary"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setRewriteEnabled"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setTableName"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setDbName"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setOwner"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setViewOriginalText"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setViewExpandedText"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setTableType"</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"setPrivileges"</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"setCreateTime"</span>:<span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看出：修改之后的表的元数据信息中，包含新添加的列<code>age</code>。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在本文中，我们介绍了如何在Hive中操作元数据，从而能够自动进行元数据管理。我们给出了Hive Hooks和Metastore Listener的基本使用方式，这些方式可以帮助我们实现操作元数据。当然也可以将这些元数据信息推送到Kafka中，以此构建自己的元数据管理系统。</p>
<blockquote>
<p>公众号『大数据技术与数仓』，回复『资料』领取大数据资料包</p>
</blockquote>
</div><div class="recommended_posts"><h3>相关推荐 ☟</h3><li><a href="https://jiamaoxiang.top/2020/09/07/使用Hive-SQL的窗口函数进行商务数据分析/" target="_blank">使用Hive SQL的窗口函数进行商务数据分析</a></li><li><a href="https://jiamaoxiang.top/2020/08/29/项目实践-基于Flink的用户行为日志分析系统/" target="_blank">项目实践|基于Flink的用户行为日志分析系统</a></li><li><a href="https://jiamaoxiang.top/2020/08/19/SQL查询的执行顺序分析/" target="_blank">SQL查询的执行顺序分析</a></li><li><a href="https://jiamaoxiang.top/2020/08/18/两阶段提交-Flink端到端的EXACTLY-ONCE实现细节/" target="_blank">两阶段提交|Flink端到端的EXACTLY ONCE实现细节</a></li></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Jia MaoXiang</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2020/08/20/元数据管理-Hive-Hooks和Metastore监听器介绍/">https://jiamaoxiang.top/2020/08/20/元数据管理-Hive-Hooks和Metastore监听器介绍/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本文为博主原创文章，遵循CC BY-SA 4.0版权协议，转载请附上原文出处链接和本声明</li></ul></div><br><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="https://jiamaoxiang.top/2020/08/20/元数据管理-Hive-Hooks和Metastore监听器介绍/" data-id="ckf14v8ec00695c7qjf4tkh1y" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAADMUlEQVR42u3awW4iQQwE0Pz/T7PSXpOdVLlHK8a8OaEEmn6DRGG7v77i6/X3+v74+jnfr+v1vz8zWed65aMLGxsb+yHs1+WVUGewGXX23x/2ho2Njb2O3YZW8pZtNM5WbsMVGxsb+5PZ+aLJpq8f54GKjY2Njd0GWNviScJsVuq0JRM2Njb2bvZdrZzzFtI1fjaWwMbGxt7NPhn0vtvj/zTfxsbGxn4b9uvgyouBPFTylY92jo2Njb2InfzQz7//80ZS3u6fHdOMgg0bGxt7BTtv3LcD2vP3SlbOhwc/5DY2Njb2CnZ7QGc2NrhhKHtArbtl2NjY2I9itwdl2ionH+i2w+N2z9jY2Nhb2e1XfxtUszDLRw55rP7yyWNjY2MvYs+aQUkBczJmaBtbhQIbGxt7BTtfIh8A5D2tfLX81kd7xsbGxl7BvusHfds8yl+bhF8+qPhhvo2NjY29iH1eTsyO+MwGD3lhE51UwsbGxl7Hbm9BfpvOD+KctLSwsbGxt7KLF8RR0cbMbJDQlj3FPcbGxsZ+CLsdEpwMYtsxQP6qo3E1NjY29gr27Njl7KjN7JDNbFBxVP1gY2NjP5A92/SsdMnrgvawTvHxYGNjY69g5yVHu9FZRM1GFPkesLGxsT+H3f5iP2n0t2OD/Dn1SAAbGxv74ey72k/5MZoobMpDOVE0YmNjYy9iXy/atpba4Gmb+21cRetjY2NjP5zdbuvkl/xJNJ6MjX/JbWxsbOwV7PaYzqxJNBvo5s2jokzCxsbGXsee/b1FnhQzs4M7/9wbNjY29iJ2+4JkW0fN+lvfN/o4sbGxsZey8xCaDYnbv+TFTz2WxsbGxl7KPi8M8iZRPovOW0u35TY2Njb2A9ltCN0VgTcPAOJbiY2Njf109qu8WmrCa8Gz242NjY29ld22hGbt+5zXBuoNpQg2Njb2CnbOyKPlvMV/1xggOqyDjY2NvYLdBkNSfpy3hE5Gy0XuYWNjY38Yuz342BYbs0OZbaxiY2Njfyb7rmFte3PbsLy5FMHGxsZ+CHsWCXnxkB/rzNtDs7YUNjY29j72XR2YvHiYBVsbojfgsbGxsd+d/QeAIhEkVbSm7AAAAABJRU5ErkJggg==">分享</a><div class="tags"><a href="/tags/Hive/">Hive</a></div><div class="post-nav"><a class="pre" href="/2020/08/29/项目实践-基于Flink的用户行为日志分析系统/">项目实践|基于Flink的用户行为日志分析系统</a><a class="next" href="/2020/08/19/SQL查询的执行顺序分析/">SQL查询的执行顺序分析</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar-toc"><div class="stoc-article" id="sidebar-stoc"><strong class="stoc-title"><i class="fa fa-list-ul"> 目录</i></strong><div class="toc-nav" id="stoc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#元数据管理"><span class="toc-number">1.</span> <span class="toc-text">元数据管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#元数据定义"><span class="toc-number">1.1.</span> <span class="toc-text">元数据定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#元数据分类"><span class="toc-number">1.2.</span> <span class="toc-text">元数据分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#技术元数据"><span class="toc-number">1.2.1.</span> <span class="toc-text">技术元数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#业务元数据"><span class="toc-number">1.2.2.</span> <span class="toc-text">业务元数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#元数据应用"><span class="toc-number">1.3.</span> <span class="toc-text">元数据应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive-Hooks-和-Metastore-Listeners"><span class="toc-number">2.</span> <span class="toc-text">Hive Hooks 和 Metastore Listeners</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Hive-Hooks"><span class="toc-number">2.1.</span> <span class="toc-text">Hive Hooks</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Hive-Hooks分类"><span class="toc-number">2.1.1.</span> <span class="toc-text">Hive Hooks分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hive-Hooks的优缺点"><span class="toc-number">2.1.2.</span> <span class="toc-text">Hive Hooks的优缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Metastore-Listeners"><span class="toc-number">2.2.</span> <span class="toc-text">Metastore Listeners</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Metastore-Listeners分类"><span class="toc-number">2.2.1.</span> <span class="toc-text">Metastore Listeners分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Metastore-Listeners优缺点"><span class="toc-number">2.2.2.</span> <span class="toc-text">Metastore Listeners优缺点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive-Hooks基本使用"><span class="toc-number">3.</span> <span class="toc-text">Hive Hooks基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#代码"><span class="toc-number">3.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用过程解释"><span class="toc-number">3.2.</span> <span class="toc-text">使用过程解释</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#查看表操作"><span class="toc-number">3.2.1.</span> <span class="toc-text">查看表操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#建表操作"><span class="toc-number">3.2.2.</span> <span class="toc-text">建表操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Metastore-Listeners基本使用"><span class="toc-number">4.</span> <span class="toc-text">Metastore Listeners基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#代码-1"><span class="toc-number">4.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用过程解释-1"><span class="toc-number">4.2.</span> <span class="toc-text">使用过程解释</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#建表操作-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">建表操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">5.</span> <span class="toc-text">总结</span></a></li></ol></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 - 2020 <a href="/." rel="nofollow">Jmx's Blog.</a>All rights reserved.<br>Thoughts on technology, life and everything else.</div></div></div><script type="text/javascript" src="/js/toc.js?v=0.0.0"></script><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="100,99,98" opacity="0.5" zindex="0.7" count="150" src="//lib.baomitu.com/canvas-nest.js/2.0.4/canvas-nest.umd.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>