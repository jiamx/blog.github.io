<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="记录朴实无华且枯燥的生活"><title>‘Hive on MR执行计划与执行日志解析 | Jmx's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '912b6cfc43243cd27aeb428f7dbf7823';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="/js/toc.js?v=0.0.0"></script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">‘Hive on MR执行计划与执行日志解析</h1><a id="logo" href="/.">Jmx's Blog</a><p class="description">Keep it Simple and Stupid!</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-pied-piper-alt"> 关于</i></a><a href="/tags"><i class="fa fa-tags"> 标签</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">‘Hive on MR执行计划与执行日志解析</h1><div class="post-meta">Jun 10, 2020<span> | </span><span class="category"><a href="/categories/Hive/">Hive</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 3.1k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 17</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="post-content"><p>MR是Hive的默认执行引擎，在该引擎下，HQL会被转换为MR作业。通过Hive的执行计划可以看出一个SQL语句的执行阶段，通过Hive的执行日志可以看出转换之后的MR作业信息。本文会通过一个具体HQL，解读一下Hive执行计划与执行日志。通过本文，你可以了解到：</p>
<ul>
<li>如何查看一个HQL会被转换为几个MR Job</li>
<li>执行计划的Stage与转换后的MR之间有什么关系</li>
<li>如何调优一个HQL查询</li>
</ul>
<h2 id="查询SQL"><a href="#查询SQL" class="headerlink" title="查询SQL"></a>查询SQL</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> dp.region_name,</span><br><span class="line">       <span class="keyword">count</span>(*) <span class="keyword">AS</span> cnt</span><br><span class="line"><span class="keyword">FROM</span> user_behavior_log ubl</span><br><span class="line"><span class="keyword">JOIN</span> dim_province dp <span class="keyword">ON</span> ubl.province = dp.province_name</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">action</span> = <span class="string">'buy'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dp.region_name</span><br></pre></td></tr></table></figure>

<h3 id="SQL介绍"><a href="#SQL介绍" class="headerlink" title="SQL介绍"></a>SQL介绍</h3><p>上面的SQL是统计每个区域购买行为的数量，其中user_behavior_log为用户的行为数据，大概有3G左右大小，dim_province是地区的维表，主要包括省份以及省份对应的区域。</p>
<h3 id="查询结果"><a href="#查询结果" class="headerlink" title="查询结果"></a>查询结果</h3><table>
<thead>
<tr>
<th align="left">dp.region_name</th>
<th align="left">cnt</th>
</tr>
</thead>
<tbody><tr>
<td align="left">东北</td>
<td align="left">290875</td>
</tr>
<tr>
<td align="left">华东</td>
<td align="left">870994</td>
</tr>
<tr>
<td align="left">华中</td>
<td align="left">291048</td>
</tr>
<tr>
<td align="left">华北</td>
<td align="left">484199</td>
</tr>
<tr>
<td align="left">华南</td>
<td align="left">484032</td>
</tr>
<tr>
<td align="left">西北</td>
<td align="left">483784</td>
</tr>
<tr>
<td align="left">西南</td>
<td align="left">483891</td>
</tr>
</tbody></table>
<h2 id="应用程序信息"><a href="#应用程序信息" class="headerlink" title="应用程序信息"></a>应用程序信息</h2><p><img src="//jiamaoxiang.top/2020/06/10/‘Hive-on-MR执行计划解析/job%E8%AF%A6%E7%BB%86%E6%8C%87%E6%A0%87%E4%BF%A1%E6%81%AF.png" alt></p>
<p>上图是该查询SQL转为MR的应用程序的执行信息，总共执行了4个MR Job。其中第一个Job包括1个Map任务，无Reduce任务。第二个Job包括11个Map任务，无reduce任务。第三个Job包括2个Map任务和2个Reduce任务。第四个Job包括1个Map任务和1个Reduce任务。</p>
<h2 id="执行计划分析"><a href="#执行计划分析" class="headerlink" title="执行计划分析"></a>执行计划分析</h2><h3 id="完整的执行计划"><a href="#完整的执行计划" class="headerlink" title="完整的执行计划"></a>完整的执行计划</h3><p>为了方便查看，下面给出完整的执行计划。可以先跳过该部分，直接看下面的详细解释：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">STAGE DEPENDENCIES:</span><br><span class="line">  Stage-13 is a root stage</span><br><span class="line">  Stage-10 depends on stages: Stage-13</span><br><span class="line">  Stage-9 depends on stages: Stage-10 , consists of Stage-11, Stage-12, Stage-2</span><br><span class="line">  Stage-11 has a <span class="keyword">backup</span> stage: Stage<span class="number">-2</span></span><br><span class="line">  Stage<span class="number">-7</span> depends <span class="keyword">on</span> stages: Stage<span class="number">-11</span></span><br><span class="line">  Stage<span class="number">-3</span> depends <span class="keyword">on</span> stages: Stage<span class="number">-2</span>, Stage<span class="number">-7</span>, Stage<span class="number">-8</span></span><br><span class="line">  Stage<span class="number">-4</span> depends <span class="keyword">on</span> stages: Stage<span class="number">-3</span></span><br><span class="line">  Stage<span class="number">-12</span> has a <span class="keyword">backup</span> stage: Stage<span class="number">-2</span></span><br><span class="line">  Stage<span class="number">-8</span> depends <span class="keyword">on</span> stages: Stage<span class="number">-12</span></span><br><span class="line">  Stage<span class="number">-2</span></span><br><span class="line">  Stage<span class="number">-0</span> depends <span class="keyword">on</span> stages: Stage<span class="number">-4</span></span><br><span class="line"></span><br><span class="line">STAGE PLANS:</span><br><span class="line">  Stage: Stage<span class="number">-13</span></span><br><span class="line">    <span class="keyword">Map</span> Reduce <span class="keyword">Local</span> <span class="keyword">Work</span></span><br><span class="line">      <span class="keyword">Alias</span> -&gt; <span class="keyword">Map</span> <span class="keyword">Local</span> <span class="keyword">Tables</span>:</span><br><span class="line">        dp:br </span><br><span class="line">          <span class="keyword">Fetch</span> <span class="keyword">Operator</span></span><br><span class="line">            <span class="keyword">limit</span>: <span class="number">-1</span></span><br><span class="line">      <span class="keyword">Alias</span> -&gt; <span class="keyword">Map</span> <span class="keyword">Local</span> <span class="keyword">Operator</span> Tree:</span><br><span class="line">        dp:br </span><br><span class="line">          TableScan</span><br><span class="line">            <span class="keyword">alias</span>: br</span><br><span class="line">            filterExpr: <span class="keyword">id</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span> (<span class="keyword">type</span>: <span class="built_in">boolean</span>)</span><br><span class="line">            <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">7</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">56</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">            Filter <span class="keyword">Operator</span></span><br><span class="line">              predicate: <span class="keyword">id</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span> (<span class="keyword">type</span>: <span class="built_in">boolean</span>)</span><br><span class="line">              <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">4</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">32</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">              HashTable Sink <span class="keyword">Operator</span></span><br><span class="line">                <span class="keyword">keys</span>:</span><br><span class="line">                  <span class="number">0</span> <span class="keyword">id</span> (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">                  <span class="number">1</span> region_id (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line">  Stage: Stage<span class="number">-10</span></span><br><span class="line">    <span class="keyword">Map</span> Reduce</span><br><span class="line">      <span class="keyword">Map</span> <span class="keyword">Operator</span> Tree:</span><br><span class="line">          TableScan</span><br><span class="line">            <span class="keyword">alias</span>: bp</span><br><span class="line">            filterExpr: (region_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">and</span> <span class="keyword">name</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>) (<span class="keyword">type</span>: <span class="built_in">boolean</span>)</span><br><span class="line">            <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">35</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">394</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">            Filter <span class="keyword">Operator</span></span><br><span class="line">              predicate: (region_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">and</span> <span class="keyword">name</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>) (<span class="keyword">type</span>: <span class="built_in">boolean</span>)</span><br><span class="line">              <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">9</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">101</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">              <span class="keyword">Map</span> <span class="keyword">Join</span> <span class="keyword">Operator</span></span><br><span class="line">                condition <span class="keyword">map</span>:</span><br><span class="line">                     <span class="keyword">Inner</span> <span class="keyword">Join</span> <span class="number">0</span> <span class="keyword">to</span> <span class="number">1</span></span><br><span class="line">                <span class="keyword">keys</span>:</span><br><span class="line">                  <span class="number">0</span> <span class="keyword">id</span> (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">                  <span class="number">1</span> region_id (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">                outputColumnNames: _col1, _col6</span><br><span class="line">                <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">9</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">111</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">                <span class="keyword">Select</span> <span class="keyword">Operator</span></span><br><span class="line">                  expressions: _col6 (<span class="keyword">type</span>: <span class="keyword">string</span>), _col1 (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">                  outputColumnNames: _col1, _col3</span><br><span class="line">                  <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">9</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">111</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">                  <span class="keyword">File</span> <span class="keyword">Output</span> <span class="keyword">Operator</span></span><br><span class="line">                    compressed: <span class="literal">false</span></span><br><span class="line">                    <span class="keyword">table</span>:</span><br><span class="line">                        <span class="keyword">input</span> <span class="keyword">format</span>: org.apache.hadoop.mapred.SequenceFileInputFormat</span><br><span class="line">                        <span class="keyword">output</span> <span class="keyword">format</span>: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat</span><br><span class="line">                        serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe</span><br><span class="line">      <span class="keyword">Local</span> <span class="keyword">Work</span>:</span><br><span class="line">        <span class="keyword">Map</span> Reduce <span class="keyword">Local</span> <span class="keyword">Work</span></span><br><span class="line"></span><br><span class="line">  Stage: Stage<span class="number">-9</span></span><br><span class="line">    Conditional <span class="keyword">Operator</span></span><br><span class="line"></span><br><span class="line">  Stage: Stage<span class="number">-11</span></span><br><span class="line">    <span class="keyword">Map</span> Reduce <span class="keyword">Local</span> <span class="keyword">Work</span></span><br><span class="line">      <span class="keyword">Alias</span> -&gt; <span class="keyword">Map</span> <span class="keyword">Local</span> <span class="keyword">Tables</span>:</span><br><span class="line">        $INTNAME </span><br><span class="line">          <span class="keyword">Fetch</span> <span class="keyword">Operator</span></span><br><span class="line">            <span class="keyword">limit</span>: <span class="number">-1</span></span><br><span class="line">      <span class="keyword">Alias</span> -&gt; <span class="keyword">Map</span> <span class="keyword">Local</span> <span class="keyword">Operator</span> Tree:</span><br><span class="line">        $INTNAME </span><br><span class="line">          TableScan</span><br><span class="line">            HashTable Sink <span class="keyword">Operator</span></span><br><span class="line">              <span class="keyword">keys</span>:</span><br><span class="line">                <span class="number">0</span> province (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">                <span class="number">1</span> _col1 (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line">  Stage: Stage<span class="number">-7</span></span><br><span class="line">    <span class="keyword">Map</span> Reduce</span><br><span class="line">      <span class="keyword">Map</span> <span class="keyword">Operator</span> Tree:</span><br><span class="line">          TableScan</span><br><span class="line">            <span class="keyword">alias</span>: ubl</span><br><span class="line">            filterExpr: (province <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">and</span> (<span class="keyword">action</span> = <span class="string">'buy'</span>)) (<span class="keyword">type</span>: <span class="built_in">boolean</span>)</span><br><span class="line">            <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">54925330</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">3300747847</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">            Filter <span class="keyword">Operator</span></span><br><span class="line">              predicate: (province <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">and</span> (<span class="keyword">action</span> = <span class="string">'buy'</span>)) (<span class="keyword">type</span>: <span class="built_in">boolean</span>)</span><br><span class="line">              <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">13731332</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">825186931</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">              <span class="keyword">Map</span> <span class="keyword">Join</span> <span class="keyword">Operator</span></span><br><span class="line">                condition <span class="keyword">map</span>:</span><br><span class="line">                     <span class="keyword">Inner</span> <span class="keyword">Join</span> <span class="number">0</span> <span class="keyword">to</span> <span class="number">1</span></span><br><span class="line">                <span class="keyword">keys</span>:</span><br><span class="line">                  <span class="number">0</span> province (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">                  <span class="number">1</span> _col1 (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">                outputColumnNames: _col18</span><br><span class="line">                <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">15104465</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">907705643</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">                <span class="keyword">File</span> <span class="keyword">Output</span> <span class="keyword">Operator</span></span><br><span class="line">                  compressed: <span class="literal">false</span></span><br><span class="line">                  <span class="keyword">table</span>:</span><br><span class="line">                      <span class="keyword">input</span> <span class="keyword">format</span>: org.apache.hadoop.mapred.SequenceFileInputFormat</span><br><span class="line">                      <span class="keyword">output</span> <span class="keyword">format</span>: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat</span><br><span class="line">                      serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe</span><br><span class="line">      <span class="keyword">Local</span> <span class="keyword">Work</span>:</span><br><span class="line">        <span class="keyword">Map</span> Reduce <span class="keyword">Local</span> <span class="keyword">Work</span></span><br><span class="line"></span><br><span class="line">  Stage: Stage<span class="number">-3</span></span><br><span class="line">    <span class="keyword">Map</span> Reduce</span><br><span class="line">      <span class="keyword">Map</span> <span class="keyword">Operator</span> Tree:</span><br><span class="line">          TableScan</span><br><span class="line">            Reduce <span class="keyword">Output</span> <span class="keyword">Operator</span></span><br><span class="line">              <span class="keyword">key</span> expressions: _col18 (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">              <span class="keyword">sort</span> <span class="keyword">order</span>: +</span><br><span class="line">              <span class="keyword">Map</span>-reduce <span class="keyword">partition</span> <span class="keyword">columns</span>: <span class="keyword">rand</span>() (<span class="keyword">type</span>: <span class="keyword">double</span>)</span><br><span class="line">              <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">15104465</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">907705643</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">      Reduce <span class="keyword">Operator</span> Tree:</span><br><span class="line">        <span class="keyword">Group</span> <span class="keyword">By</span> <span class="keyword">Operator</span></span><br><span class="line">          aggregations: <span class="keyword">count</span>()</span><br><span class="line">          <span class="keyword">keys</span>: KEY._col0 (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">          <span class="keyword">mode</span>: partial1</span><br><span class="line">          outputColumnNames: _col0, _col1</span><br><span class="line">          <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">15104465</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">907705643</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">          <span class="keyword">File</span> <span class="keyword">Output</span> <span class="keyword">Operator</span></span><br><span class="line">            compressed: <span class="literal">false</span></span><br><span class="line">            <span class="keyword">table</span>:</span><br><span class="line">                <span class="keyword">input</span> <span class="keyword">format</span>: org.apache.hadoop.mapred.SequenceFileInputFormat</span><br><span class="line">                <span class="keyword">output</span> <span class="keyword">format</span>: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat</span><br><span class="line">                serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe</span><br><span class="line"></span><br><span class="line">  Stage: Stage<span class="number">-4</span></span><br><span class="line">    <span class="keyword">Map</span> Reduce</span><br><span class="line">      <span class="keyword">Map</span> <span class="keyword">Operator</span> Tree:</span><br><span class="line">          TableScan</span><br><span class="line">            Reduce <span class="keyword">Output</span> <span class="keyword">Operator</span></span><br><span class="line">              <span class="keyword">key</span> expressions: _col0 (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">              <span class="keyword">sort</span> <span class="keyword">order</span>: +</span><br><span class="line">              <span class="keyword">Map</span>-reduce <span class="keyword">partition</span> <span class="keyword">columns</span>: _col0 (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">              <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">15104465</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">907705643</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">              <span class="keyword">value</span> expressions: _col1 (<span class="keyword">type</span>: <span class="built_in">bigint</span>)</span><br><span class="line">      Reduce <span class="keyword">Operator</span> Tree:</span><br><span class="line">        <span class="keyword">Group</span> <span class="keyword">By</span> <span class="keyword">Operator</span></span><br><span class="line">          aggregations: <span class="keyword">count</span>(VALUE._col0)</span><br><span class="line">          <span class="keyword">keys</span>: KEY._col0 (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">          <span class="keyword">mode</span>: <span class="keyword">final</span></span><br><span class="line">          outputColumnNames: _col0, _col1</span><br><span class="line">          <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">7552232</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">453852791</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">          <span class="keyword">File</span> <span class="keyword">Output</span> <span class="keyword">Operator</span></span><br><span class="line">            compressed: <span class="literal">false</span></span><br><span class="line">            <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">7552232</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">453852791</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">            <span class="keyword">table</span>:</span><br><span class="line">                <span class="keyword">input</span> <span class="keyword">format</span>: org.apache.hadoop.mapred.TextInputFormat</span><br><span class="line">                <span class="keyword">output</span> <span class="keyword">format</span>: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat</span><br><span class="line">                serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe</span><br><span class="line"></span><br><span class="line">  Stage: Stage<span class="number">-12</span></span><br><span class="line">    <span class="keyword">Map</span> Reduce <span class="keyword">Local</span> <span class="keyword">Work</span></span><br><span class="line">      <span class="keyword">Alias</span> -&gt; <span class="keyword">Map</span> <span class="keyword">Local</span> <span class="keyword">Tables</span>:</span><br><span class="line">        ubl </span><br><span class="line">          <span class="keyword">Fetch</span> <span class="keyword">Operator</span></span><br><span class="line">            <span class="keyword">limit</span>: <span class="number">-1</span></span><br><span class="line">      <span class="keyword">Alias</span> -&gt; <span class="keyword">Map</span> <span class="keyword">Local</span> <span class="keyword">Operator</span> Tree:</span><br><span class="line">        ubl </span><br><span class="line">          TableScan</span><br><span class="line">            <span class="keyword">alias</span>: ubl</span><br><span class="line">            filterExpr: (province <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">and</span> (<span class="keyword">action</span> = <span class="string">'buy'</span>)) (<span class="keyword">type</span>: <span class="built_in">boolean</span>)</span><br><span class="line">            <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">54925330</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">3300747847</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">            Filter <span class="keyword">Operator</span></span><br><span class="line">              predicate: (province <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">and</span> (<span class="keyword">action</span> = <span class="string">'buy'</span>)) (<span class="keyword">type</span>: <span class="built_in">boolean</span>)</span><br><span class="line">              <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">13731332</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">825186931</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">              HashTable Sink <span class="keyword">Operator</span></span><br><span class="line">                <span class="keyword">keys</span>:</span><br><span class="line">                  <span class="number">0</span> province (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">                  <span class="number">1</span> _col1 (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line">  Stage: Stage<span class="number">-8</span></span><br><span class="line">    <span class="keyword">Map</span> Reduce</span><br><span class="line">      <span class="keyword">Map</span> <span class="keyword">Operator</span> Tree:</span><br><span class="line">          TableScan</span><br><span class="line">            <span class="keyword">Map</span> <span class="keyword">Join</span> <span class="keyword">Operator</span></span><br><span class="line">              condition <span class="keyword">map</span>:</span><br><span class="line">                   <span class="keyword">Inner</span> <span class="keyword">Join</span> <span class="number">0</span> <span class="keyword">to</span> <span class="number">1</span></span><br><span class="line">              <span class="keyword">keys</span>:</span><br><span class="line">                <span class="number">0</span> province (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">                <span class="number">1</span> _col1 (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">              outputColumnNames: _col18</span><br><span class="line">              <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">15104465</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">907705643</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">              <span class="keyword">File</span> <span class="keyword">Output</span> <span class="keyword">Operator</span></span><br><span class="line">                compressed: <span class="literal">false</span></span><br><span class="line">                <span class="keyword">table</span>:</span><br><span class="line">                    <span class="keyword">input</span> <span class="keyword">format</span>: org.apache.hadoop.mapred.SequenceFileInputFormat</span><br><span class="line">                    <span class="keyword">output</span> <span class="keyword">format</span>: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat</span><br><span class="line">                    serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe</span><br><span class="line">      <span class="keyword">Local</span> <span class="keyword">Work</span>:</span><br><span class="line">        <span class="keyword">Map</span> Reduce <span class="keyword">Local</span> <span class="keyword">Work</span></span><br><span class="line"></span><br><span class="line">  Stage: Stage<span class="number">-2</span></span><br><span class="line">    <span class="keyword">Map</span> Reduce</span><br><span class="line">      <span class="keyword">Map</span> <span class="keyword">Operator</span> Tree:</span><br><span class="line">          TableScan</span><br><span class="line">            Reduce <span class="keyword">Output</span> <span class="keyword">Operator</span></span><br><span class="line">              <span class="keyword">key</span> expressions: _col1 (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">              <span class="keyword">sort</span> <span class="keyword">order</span>: +</span><br><span class="line">              <span class="keyword">Map</span>-reduce <span class="keyword">partition</span> <span class="keyword">columns</span>: _col1 (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">              <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">9</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">111</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">              <span class="keyword">value</span> expressions: _col3 (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">          TableScan</span><br><span class="line">            <span class="keyword">alias</span>: ubl</span><br><span class="line">            filterExpr: (province <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">and</span> (<span class="keyword">action</span> = <span class="string">'buy'</span>)) (<span class="keyword">type</span>: <span class="built_in">boolean</span>)</span><br><span class="line">            <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">54925330</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">3300747847</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">            Filter <span class="keyword">Operator</span></span><br><span class="line">              predicate: (province <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">and</span> (<span class="keyword">action</span> = <span class="string">'buy'</span>)) (<span class="keyword">type</span>: <span class="built_in">boolean</span>)</span><br><span class="line">              <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">13731332</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">825186931</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">              Reduce <span class="keyword">Output</span> <span class="keyword">Operator</span></span><br><span class="line">                <span class="keyword">key</span> expressions: province (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">                <span class="keyword">sort</span> <span class="keyword">order</span>: +</span><br><span class="line">                <span class="keyword">Map</span>-reduce <span class="keyword">partition</span> <span class="keyword">columns</span>: province (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">                <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">13731332</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">825186931</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">      Reduce <span class="keyword">Operator</span> Tree:</span><br><span class="line">        <span class="keyword">Join</span> <span class="keyword">Operator</span></span><br><span class="line">          condition <span class="keyword">map</span>:</span><br><span class="line">               <span class="keyword">Inner</span> <span class="keyword">Join</span> <span class="number">0</span> <span class="keyword">to</span> <span class="number">1</span></span><br><span class="line">          <span class="keyword">keys</span>:</span><br><span class="line">            <span class="number">0</span> province (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">            <span class="number">1</span> _col1 (<span class="keyword">type</span>: <span class="keyword">string</span>)</span><br><span class="line">          outputColumnNames: _col18</span><br><span class="line">          <span class="keyword">Statistics</span>: <span class="keyword">Num</span> <span class="keyword">rows</span>: <span class="number">15104465</span> <span class="keyword">Data</span> <span class="keyword">size</span>: <span class="number">907705643</span> Basic stats: <span class="keyword">COMPLETE</span> <span class="keyword">Column</span> stats: <span class="keyword">NONE</span></span><br><span class="line">          <span class="keyword">File</span> <span class="keyword">Output</span> <span class="keyword">Operator</span></span><br><span class="line">            compressed: <span class="literal">false</span></span><br><span class="line">            <span class="keyword">table</span>:</span><br><span class="line">                <span class="keyword">input</span> <span class="keyword">format</span>: org.apache.hadoop.mapred.SequenceFileInputFormat</span><br><span class="line">                <span class="keyword">output</span> <span class="keyword">format</span>: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat</span><br><span class="line">                serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe</span><br><span class="line"></span><br><span class="line">  Stage: Stage<span class="number">-0</span></span><br><span class="line">    <span class="keyword">Fetch</span> <span class="keyword">Operator</span></span><br><span class="line">      <span class="keyword">limit</span>: <span class="number">-1</span></span><br><span class="line">      Processor Tree:</span><br><span class="line">        ListSink</span><br></pre></td></tr></table></figure>

<h3 id="执行计划解析"><a href="#执行计划解析" class="headerlink" title="执行计划解析"></a>执行计划解析</h3><h4 id="stage-dependencies"><a href="#stage-dependencies" class="headerlink" title="stage dependencies"></a>stage dependencies</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Stage-13 is a root stage</span><br><span class="line">  Stage-10 depends on stages: Stage-13</span><br><span class="line">  Stage-9 depends on stages: Stage-10 , consists of Stage-11, Stage-12, Stage-2</span><br><span class="line">  Stage-11 has a backup stage: Stage-2</span><br><span class="line">  Stage-7 depends on stages: Stage-11</span><br><span class="line">  Stage-3 depends on stages: Stage-2, Stage-7, Stage-8</span><br><span class="line">  Stage-4 depends on stages: Stage-3</span><br><span class="line">  Stage-12 has a backup stage: Stage-2</span><br><span class="line">  Stage-8 depends on stages: Stage-12</span><br><span class="line">  Stage-2</span><br><span class="line">  Stage-0 depends on stages: Stage-4</span><br></pre></td></tr></table></figure>

<h4 id="stage-plans"><a href="#stage-plans" class="headerlink" title="stage plans"></a>stage plans</h4><h2 id="执行日志分析"><a href="#执行日志分析" class="headerlink" title="执行日志分析"></a>执行日志分析</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">INFO  : Compiling command(queryId=hive_20200618145454_29fb89e3-b5e6-41ef-8e8a-e2635722656f): <span class="keyword">SELECT</span> dp.region_name,</span><br><span class="line">       <span class="keyword">count</span>(*) <span class="keyword">AS</span> cnt</span><br><span class="line"><span class="keyword">FROM</span> user_behavior_log ubl</span><br><span class="line"><span class="keyword">JOIN</span> dim_province dp <span class="keyword">ON</span> ubl.province = dp.province_name</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">action</span> = <span class="string">'buy'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dp.region_name</span><br><span class="line">INFO  : Semantic Analysis Completed</span><br><span class="line">INFO  : <span class="keyword">Returning</span> Hive <span class="keyword">schema</span>: <span class="keyword">Schema</span>(fieldSchemas:[FieldSchema(<span class="keyword">name</span>:dp.region_name, <span class="keyword">type</span>:<span class="keyword">string</span>, <span class="keyword">comment</span>:<span class="literal">null</span>), FieldSchema(<span class="keyword">name</span>:cnt, <span class="keyword">type</span>:<span class="built_in">bigint</span>, <span class="keyword">comment</span>:<span class="literal">null</span>)], properties:<span class="literal">null</span>)</span><br><span class="line">INFO  : Completed compiling command(queryId=hive_20200618145454_29fb89e3-b5e6<span class="number">-41</span>ef<span class="number">-8e8</span>a-e2635722656f); Time taken: 0.458 seconds</span><br><span class="line">INFO  : Executing command(queryId=hive_20200618145454_29fb89e3-b5e6-41ef-8e8a-e2635722656f): <span class="keyword">SELECT</span> dp.region_name,</span><br><span class="line">       <span class="keyword">count</span>(*) <span class="keyword">AS</span> cnt</span><br><span class="line"><span class="keyword">FROM</span> user_behavior_log ubl</span><br><span class="line"><span class="keyword">JOIN</span> dim_province dp <span class="keyword">ON</span> ubl.province = dp.province_name</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">action</span> = <span class="string">'buy'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> dp.region_name</span><br><span class="line">INFO  : <span class="keyword">Query</span> <span class="keyword">ID</span> = hive_20200618145454_29fb89e3-b5e6<span class="number">-41</span>ef<span class="number">-8e8</span>a-e2635722656f</span><br><span class="line">INFO  : Total jobs = <span class="number">6</span></span><br><span class="line">INFO  : <span class="keyword">Starting</span> task [Stage<span class="number">-13</span>:MAPREDLOCAL] <span class="keyword">in</span> <span class="built_in">serial</span> <span class="keyword">mode</span></span><br><span class="line"><span class="number">20</span>/<span class="number">06</span>/<span class="number">18</span> <span class="number">14</span>:<span class="number">54</span>:<span class="number">56</span> WARN conf.HiveConf: HiveConf <span class="keyword">of</span> <span class="keyword">name</span> hive.server2.idle.session.timeout_check_operation does <span class="keyword">not</span> exist</span><br><span class="line"><span class="number">20</span>/<span class="number">06</span>/<span class="number">18</span> <span class="number">14</span>:<span class="number">54</span>:<span class="number">56</span> WARN conf.HiveConf: HiveConf <span class="keyword">of</span> <span class="keyword">name</span> hive.entity.capture.input.URI does <span class="keyword">not</span> exist</span><br><span class="line"></span><br><span class="line"><span class="number">2020</span><span class="number">-06</span><span class="number">-18</span> <span class="number">02</span>:<span class="number">54</span>:<span class="number">58</span>	Dump the side-<span class="keyword">table</span> <span class="keyword">for</span> tag: <span class="number">0</span> <span class="keyword">with</span> <span class="keyword">group</span> <span class="keyword">count</span>: <span class="number">7</span> <span class="keyword">into</span> <span class="keyword">file</span>: <span class="keyword">file</span>:/tmp/hive/dd28ddf1<span class="number">-03</span>db<span class="number">-472</span>a<span class="number">-8e34</span><span class="number">-98</span>ee658d82a1/hive_2020<span class="number">-06</span><span class="number">-18</span>_14<span class="number">-54</span><span class="number">-52</span>_573_920702636242824197<span class="number">-27</span>/-<span class="keyword">local</span><span class="number">-10010</span>/HashTable-Stage<span class="number">-10</span>/MapJoin-mapfile370<span class="comment">--.hashtable</span></span><br><span class="line"><span class="number">2020</span><span class="number">-06</span><span class="number">-18</span> <span class="number">02</span>:<span class="number">54</span>:<span class="number">58</span>	<span class="keyword">End</span> <span class="keyword">of</span> <span class="keyword">local</span> task; Time Taken: 2.035 sec.</span><br><span class="line">INFO  : Execution completed successfully</span><br><span class="line">INFO  : MapredLocal task succeeded</span><br><span class="line">INFO  : Launching Job 1 out of 6</span><br><span class="line">INFO  : Starting task [Stage-10:MAPRED] in parallel</span><br><span class="line">INFO  : Number of reduce tasks is <span class="keyword">set</span> <span class="keyword">to</span> <span class="number">0</span> since there<span class="string">'s no reduce operator</span></span><br><span class="line"><span class="string">INFO  : Selecting local mode for task: Stage-10</span></span><br><span class="line"><span class="string">INFO  : number of splits:1</span></span><br><span class="line"><span class="string">INFO  : Submitting tokens for job: job_1582600603106_1942</span></span><br><span class="line"><span class="string">INFO  : The url to track the job: http://cdh03:8088/proxy/application_1582600603106_1942/</span></span><br><span class="line"><span class="string">INFO  : Starting Job = job_1582600603106_1942, Tracking URL = http://cdh03:8088/proxy/application_1582600603106_1942/</span></span><br><span class="line"><span class="string">INFO  : Kill Command = /opt/cloudera/parcels/CDH-5.16.1-1.cdh5.16.1.p0.3/lib/hadoop/bin/hadoop job  -kill job_1582600603106_1942</span></span><br><span class="line"><span class="string">INFO  : Hadoop job information for Stage-10: number of mappers: 1; number of reducers: 0</span></span><br><span class="line"><span class="string">INFO  : 2020-06-18 14:55:05,948 Stage-10 map = 0%,  reduce = 0%</span></span><br><span class="line"><span class="string">INFO  : 2020-06-18 14:55:11,196 Stage-10 map = 100%,  reduce = 0%, Cumulative CPU 3.2 sec</span></span><br><span class="line"><span class="string">INFO  : MapReduce Total cumulative CPU time: 3 seconds 200 msec</span></span><br><span class="line"><span class="string">INFO  : Ended Job = job_1582600603106_1942</span></span><br><span class="line"><span class="string">INFO  : Starting task [Stage-9:CONDITIONAL] in parallel</span></span><br><span class="line"><span class="string">INFO  : Stage-11 is selected by condition resolver.</span></span><br><span class="line"><span class="string">INFO  : Stage-12 is filtered out by condition resolver.</span></span><br><span class="line"><span class="string">INFO  : Stage-2 is filtered out by condition resolver.</span></span><br><span class="line"><span class="string">INFO  : Starting task [Stage-11:MAPREDLOCAL] in serial mode</span></span><br><span class="line"><span class="string">20/06/18 14:55:17 WARN conf.HiveConf: HiveConf of name hive.server2.idle.session.timeout_check_operation does not exist</span></span><br><span class="line"><span class="string">INFO  : Execution completed successfully</span></span><br><span class="line"><span class="string">INFO  : MapredLocal task succeeded</span></span><br><span class="line"><span class="string">INFO  : Launching Job 3 out of 6</span></span><br><span class="line"><span class="string">INFO  : Starting task [Stage-7:MAPRED] in parallel</span></span><br><span class="line"><span class="string">INFO  : Number of reduce tasks is set to 0 since there'</span>s <span class="keyword">no</span> reduce <span class="keyword">operator</span></span><br><span class="line">INFO  : Cannot run job locally: <span class="keyword">Input</span> <span class="keyword">Size</span> (= <span class="number">3355673177</span>) <span class="keyword">is</span> larger <span class="keyword">than</span> hive.exec.mode.local.auto.inputbytes.max (= <span class="number">50000000</span>)</span><br><span class="line">INFO  : <span class="built_in">number</span> <span class="keyword">of</span> splits:<span class="number">11</span></span><br><span class="line">INFO  : Submitting tokens <span class="keyword">for</span> job: job_1582600603106_1943</span><br><span class="line">INFO  : The <span class="keyword">url</span> <span class="keyword">to</span> track the job: <span class="keyword">http</span>://cdh03:<span class="number">8088</span>/proxy/application_1582600603106_1943/</span><br><span class="line">INFO  : <span class="keyword">Starting</span> Job = job_1582600603106_1943, <span class="keyword">Tracking</span> <span class="keyword">URL</span> = <span class="keyword">http</span>://cdh03:<span class="number">8088</span>/proxy/application_1582600603106_1943/</span><br><span class="line">INFO  : <span class="keyword">Kill</span> Command = /opt/cloudera/parcels/CDH<span class="number">-5.16</span><span class="number">.1</span><span class="number">-1.</span>cdh5<span class="number">.16</span><span class="number">.1</span>.p0<span class="number">.3</span>/lib/hadoop/<span class="keyword">bin</span>/hadoop job  -<span class="keyword">kill</span> job_1582600603106_1943</span><br><span class="line">INFO  : Hadoop job information <span class="keyword">for</span> Stage<span class="number">-7</span>: <span class="built_in">number</span> <span class="keyword">of</span> mappers: <span class="number">11</span>; number of reducers: 0</span><br><span class="line">INFO  : 2020-06-18 14:55:27,886 Stage-7 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2020-06-18 14:55:37,354 Stage-7 map = 9%,  reduce = 0%, Cumulative CPU 8.64 sec</span><br><span class="line">INFO  : 2020-06-18 14:55:38,419 Stage-7 map = 36%,  reduce = 0%, Cumulative CPU 38.01 sec</span><br><span class="line">INFO  : 2020-06-18 14:55:40,511 Stage-7 map = 55%,  reduce = 0%, Cumulative CPU 60.16 sec</span><br><span class="line">INFO  : 2020-06-18 14:55:41,569 Stage-7 map = 64%,  reduce = 0%, Cumulative CPU 71.54 sec</span><br><span class="line">INFO  : 2020-06-18 14:55:45,756 Stage-7 map = 73%,  reduce = 0%, Cumulative CPU 79.75 sec</span><br><span class="line">INFO  : 2020-06-18 14:55:46,813 Stage-7 map = 91%,  reduce = 0%, Cumulative CPU 96.4 sec</span><br><span class="line">INFO  : 2020-06-18 14:55:47,866 Stage-7 map = 100%,  reduce = 0%, Cumulative CPU 105.15 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 1 minutes 45 seconds 150 msec</span><br><span class="line">INFO  : Ended Job = job_1582600603106_1943</span><br><span class="line">INFO  : Launching Job 4 out of 6</span><br><span class="line">INFO  : Starting task [Stage-3:MAPRED] in parallel</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 2</span><br><span class="line">INFO  : In order to <span class="keyword">change</span> the average <span class="keyword">load</span> <span class="keyword">for</span> a reducer (<span class="keyword">in</span> <span class="keyword">bytes</span>):</span><br><span class="line">INFO  :   <span class="keyword">set</span> hive.exec.reducers.bytes.per.reducer=&lt;<span class="built_in">number</span>&gt;</span><br><span class="line">INFO  : <span class="keyword">In</span> <span class="keyword">order</span> <span class="keyword">to</span> <span class="keyword">limit</span> the maximum <span class="built_in">number</span> <span class="keyword">of</span> reducers:</span><br><span class="line">INFO  :   <span class="keyword">set</span> hive.exec.reducers.max=&lt;<span class="built_in">number</span>&gt;</span><br><span class="line">INFO  : <span class="keyword">In</span> <span class="keyword">order</span> <span class="keyword">to</span> <span class="keyword">set</span> a <span class="keyword">constant</span> <span class="built_in">number</span> <span class="keyword">of</span> reducers:</span><br><span class="line">INFO  :   <span class="keyword">set</span> mapreduce.job.reduces=&lt;<span class="built_in">number</span>&gt;</span><br><span class="line">INFO  : Cannot run job locally: <span class="keyword">Input</span> <span class="keyword">Size</span> (= <span class="number">82139608</span>) <span class="keyword">is</span> larger <span class="keyword">than</span> hive.exec.mode.local.auto.inputbytes.max (= <span class="number">50000000</span>)</span><br><span class="line">INFO  : <span class="built_in">number</span> <span class="keyword">of</span> splits:<span class="number">2</span></span><br><span class="line">INFO  : Submitting tokens <span class="keyword">for</span> job: job_1582600603106_1944</span><br><span class="line">INFO  : The <span class="keyword">url</span> <span class="keyword">to</span> track the job: <span class="keyword">http</span>://cdh03:<span class="number">8088</span>/proxy/application_1582600603106_1944/</span><br><span class="line">INFO  : <span class="keyword">Starting</span> Job = job_1582600603106_1944, <span class="keyword">Tracking</span> <span class="keyword">URL</span> = <span class="keyword">http</span>://cdh03:<span class="number">8088</span>/proxy/application_1582600603106_1944/</span><br><span class="line">INFO  : <span class="keyword">Kill</span> Command = /opt/cloudera/parcels/CDH<span class="number">-5.16</span><span class="number">.1</span><span class="number">-1.</span>cdh5<span class="number">.16</span><span class="number">.1</span>.p0<span class="number">.3</span>/lib/hadoop/<span class="keyword">bin</span>/hadoop job  -<span class="keyword">kill</span> job_1582600603106_1944</span><br><span class="line">INFO  : Hadoop job information <span class="keyword">for</span> Stage<span class="number">-3</span>: <span class="built_in">number</span> <span class="keyword">of</span> mappers: <span class="number">2</span>; number of reducers: 2</span><br><span class="line">INFO  : 2020-06-18 14:55:58,247 Stage-3 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2020-06-18 14:56:07,695 Stage-3 map = 50%,  reduce = 0%, Cumulative CPU 8.96 sec</span><br><span class="line">INFO  : 2020-06-18 14:56:12,969 Stage-3 map = 100%,  reduce = 0%, Cumulative CPU 23.17 sec</span><br><span class="line">INFO  : 2020-06-18 14:56:19,310 Stage-3 map = 100%,  reduce = 50%, Cumulative CPU 28.33 sec</span><br><span class="line">INFO  : 2020-06-18 14:56:20,348 Stage-3 map = 100%,  reduce = 100%, Cumulative CPU 33.89 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 33 seconds 890 msec</span><br><span class="line">INFO  : Ended Job = job_1582600603106_1944</span><br><span class="line">INFO  : Launching Job 5 out of 6</span><br><span class="line">INFO  : Starting task [Stage-4:MAPRED] in parallel</span><br><span class="line">INFO  : Number of reduce tasks not specified. Estimated from input data size: 1</span><br><span class="line">INFO  : In order to <span class="keyword">change</span> the average <span class="keyword">load</span> <span class="keyword">for</span> a reducer (<span class="keyword">in</span> <span class="keyword">bytes</span>):</span><br><span class="line">INFO  :   <span class="keyword">set</span> hive.exec.reducers.bytes.per.reducer=&lt;<span class="built_in">number</span>&gt;</span><br><span class="line">INFO  : <span class="keyword">In</span> <span class="keyword">order</span> <span class="keyword">to</span> <span class="keyword">limit</span> the maximum <span class="built_in">number</span> <span class="keyword">of</span> reducers:</span><br><span class="line">INFO  :   <span class="keyword">set</span> hive.exec.reducers.max=&lt;<span class="built_in">number</span>&gt;</span><br><span class="line">INFO  : <span class="keyword">In</span> <span class="keyword">order</span> <span class="keyword">to</span> <span class="keyword">set</span> a <span class="keyword">constant</span> <span class="built_in">number</span> <span class="keyword">of</span> reducers:</span><br><span class="line">INFO  :   <span class="keyword">set</span> mapreduce.job.reduces=&lt;<span class="built_in">number</span>&gt;</span><br><span class="line">INFO  : Selecting <span class="keyword">local</span> <span class="keyword">mode</span> <span class="keyword">for</span> task: Stage<span class="number">-4</span></span><br><span class="line">INFO  : <span class="built_in">number</span> <span class="keyword">of</span> splits:<span class="number">1</span></span><br><span class="line">INFO  : Submitting tokens <span class="keyword">for</span> job: job_1582600603106_1945</span><br><span class="line">INFO  : The <span class="keyword">url</span> <span class="keyword">to</span> track the job: <span class="keyword">http</span>://cdh03:<span class="number">8088</span>/proxy/application_1582600603106_1945/</span><br><span class="line">INFO  : <span class="keyword">Starting</span> Job = job_1582600603106_1945, <span class="keyword">Tracking</span> <span class="keyword">URL</span> = <span class="keyword">http</span>://cdh03:<span class="number">8088</span>/proxy/application_1582600603106_1945/</span><br><span class="line">INFO  : <span class="keyword">Kill</span> Command = /opt/cloudera/parcels/CDH<span class="number">-5.16</span><span class="number">.1</span><span class="number">-1.</span>cdh5<span class="number">.16</span><span class="number">.1</span>.p0<span class="number">.3</span>/lib/hadoop/<span class="keyword">bin</span>/hadoop job  -<span class="keyword">kill</span> job_1582600603106_1945</span><br><span class="line">INFO  : Hadoop job information <span class="keyword">for</span> Stage<span class="number">-4</span>: <span class="built_in">number</span> <span class="keyword">of</span> mappers: <span class="number">1</span>; number of reducers: 1</span><br><span class="line">INFO  : 2020-06-18 14:56:28,550 Stage-4 map = 0%,  reduce = 0%</span><br><span class="line">INFO  : 2020-06-18 14:56:33,832 Stage-4 map = 100%,  reduce = 0%, Cumulative CPU 1.51 sec</span><br><span class="line">INFO  : 2020-06-18 14:56:40,167 Stage-4 map = 100%,  reduce = 100%, Cumulative CPU 4.94 sec</span><br><span class="line">INFO  : MapReduce Total cumulative CPU time: 4 seconds 940 msec</span><br><span class="line">INFO  : Ended Job = job_1582600603106_1945</span><br><span class="line">INFO  : MapReduce Jobs Launched: </span><br><span class="line">INFO  : Stage-Stage-10: Map: 1   Cumulative CPU: 3.2 sec   HDFS Read: 6389 HDFS Write: 1199 SUCCESS</span><br><span class="line">INFO  : Stage-Stage-7: Map: 11   Cumulative CPU: 105.15 sec   HDFS Read: 3356995378 HDFS Write: 82139608 SUCCESS</span><br><span class="line">INFO  : Stage-Stage-3: Map: 2  Reduce: 2   Cumulative CPU: 33.89 sec   HDFS Read: 82150071 HDFS Write: 584 SUCCESS</span><br><span class="line">INFO  : Stage-Stage-4: Map: 1  Reduce: 1   Cumulative CPU: 4.94 sec   HDFS Read: 5695 HDFS Write: 140 SUCCESS</span><br><span class="line">INFO  : Total MapReduce CPU Time Spent: 2 minutes 27 seconds 180 msec</span><br><span class="line">INFO  : Completed executing command(queryId=hive_20200618145454_29fb89e3-b5e6-41ef-8e8a-e2635722656f); Time taken: 108.915 seconds</span><br><span class="line">INFO  : OK</span><br></pre></td></tr></table></figure>

<p>三个参数：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 每个reduce处理的数据量字节数，默认64M</span></span><br><span class="line"><span class="comment">-- 例如：如果输入大小为 10GiB并且该项设置为1GiB，Hive 将使用10个reducer</span></span><br><span class="line"><span class="keyword">set</span> hive.exec.reducers.bytes.per.reducer = <span class="number">67108864</span> </span><br><span class="line"><span class="comment">-- 每个job的最大reduce数量，默认1099</span></span><br><span class="line"><span class="comment">-- 如果配置参数mapreduce.job.reduces为负，则Hive会将reducer数量限制为此参数的值。</span></span><br><span class="line"><span class="keyword">set</span> hive.exec.reducers.max=<span class="number">1099</span></span><br><span class="line"><span class="comment">-- 设定每个job的reduce数量，默认-1，表示不限制</span></span><br><span class="line"><span class="comment">-- 每项作业中reduce任务的默认数量。通常设置为接近可用主机数量的素数。Hadoop 默认将该项设置为 1，而 Hive -- 默认使用 -1。当设置为 -1 时，Hive 将自动决定用于每项作业的 reducer 的适用数量</span></span><br><span class="line"><span class="keyword">set</span> mapreduce.job.reduces = <span class="number">-1</span></span><br></pre></td></tr></table></figure>

<p>mapreduce.input.fileinputformat.split.minsize = 1默认</p>
<p>reduce数量计算：3357127507/67108864≈51</p>
<p>数据总行数：54925330  </p>
<p>数据总大小：3300747847</p>
<blockquote>
<p>公众号『大数据技术与数仓』，回复『资料』领取大数据资料包</p>
</blockquote>
</div><div class="recommended_posts"><h3>相关推荐 ☟</h3><li><a href="https://jiamaoxiang.top/2020/06/27/Hive的架构剖析/" target="_blank">Hive的架构剖析</a></li><li><a href="https://jiamaoxiang.top/2020/06/26/数据分析-使用多元线性回归构建销售额预测模型/" target="_blank">数据分析|使用多元线性回归构建销售额预测模型</a></li><li><a href="https://jiamaoxiang.top/2020/06/06/数仓-Hive性能调优指北/" target="_blank">数仓|Hive性能调优指北</a></li><li><a href="https://jiamaoxiang.top/2020/06/05/实时数仓-Flink-SQL之维表join/" target="_blank">实时数仓|Flink SQL之维表join</a></li></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Jia MaoXiang</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2020/06/10/‘Hive-on-MR执行计划解析/">https://jiamaoxiang.top/2020/06/10/‘Hive-on-MR执行计划解析/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本文为博主原创文章，遵循CC BY-SA 4.0版权协议，转载请附上原文出处链接和本声明</li></ul></div><br><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="https://jiamaoxiang.top/2020/06/10/‘Hive-on-MR执行计划解析/" data-id="ckk9ckqvi00646g7qnwko9gi5" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACtklEQVR42u3a0W4iMQwFUP7/p7tSn1ZaSu+1E1qtzjwhBEnOII2N7ccjvj4+r79f/3sl301WeL3X48aFh4eHNzp6suUM+dXRW0Cy+5MV8PDw8K7x2uXabdqjf3UL8jPj4eHh/QbeJkV+DU7SZTw8PLz/g3fqWJvz4OHh4f0Ub1ZabY+VJ82nUnk8PDy8G7xZA+xnX1/v7+Hh4eGNuuptc2u24yx4RKfFw8PDu8Brt2zb/0mi3Ial5MYN7ygeHh5ewJsVYTeP9RzZttmefBcPDw/vAq9tPs2S2rygsCnORp/Hw8PDW/OSx+tmoCr//NlUGw8PD+82b/blNtXOBxHykDCMcnh4eHhr3j4w5I/1zSjAa/bFlBoPDw9v1CdKAsOetB+3wsPDw3snbzZ6lSTEebNq32yLJiPw8PDw1ry8GDEr7CafzNecjYXh4eHhneW1Tal2oCoPJ+1qeHh4eO/n7RPlWeG1HUFoyyJ4eHh493h5OXUfNtoCbptwF/8Y8PDw8A7x8rGATYqcFGHb1DkKWnh4eHiHeHnCOmv/z0YH8iD0TbqPh4eHd4GXP8Rnj/7ZSEFb5C1myvDw8PDWvFkRocjT49GEtqkWlU7w8PDwLvBmZdb2iJv3N403PDw8vPfw8qVnDa18MKsNCVFgwMPDw1vzkrJpNGuwCAb736eeKcPDw8M7xMsLuMnh8pGp/Fa+3qVOpvHw8PBGvPyBWy+3KLy25eDoZ8DDw8M7xPsor3xQ4NRj/XWw+aZogoeHh3eBN2vzt4vmCXqeah8OLXh4eHglLw8GbVnhXiOtKAfj4eHhXePlDbCE1LbEZmn6MKbh4eHhvZGXv9Omzu0AQbEjHh4e3q/kzULLMEVuz4OHh4d3jZcXI/bF3GSFvFB7uIyLh4eHd7kBlpdcbxeIDxcs8PDw8J7z/gBNk5xxCNOmeQAAAABJRU5ErkJggg==">分享</a><div class="tags"><a href="/tags/Hive/">Hive</a></div><div class="post-nav"><a class="pre" href="/2020/06/26/数据分析-使用多元线性回归构建销售额预测模型/">数据分析|使用多元线性回归构建销售额预测模型</a><a class="next" href="/2020/06/06/数仓-Hive性能调优指北/">数仓|Hive性能调优指北</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar-toc"><div class="stoc-article" id="sidebar-stoc"><strong class="stoc-title"><i class="fa fa-list-ul"> 目录</i></strong><div class="toc-nav" id="stoc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#查询SQL"><span class="toc-number">1.</span> <span class="toc-text">查询SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL介绍"><span class="toc-number">1.1.</span> <span class="toc-text">SQL介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查询结果"><span class="toc-number">1.2.</span> <span class="toc-text">查询结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用程序信息"><span class="toc-number">2.</span> <span class="toc-text">应用程序信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#执行计划分析"><span class="toc-number">3.</span> <span class="toc-text">执行计划分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#完整的执行计划"><span class="toc-number">3.1.</span> <span class="toc-text">完整的执行计划</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#执行计划解析"><span class="toc-number">3.2.</span> <span class="toc-text">执行计划解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#stage-dependencies"><span class="toc-number">3.2.1.</span> <span class="toc-text">stage dependencies</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#stage-plans"><span class="toc-number">3.2.2.</span> <span class="toc-text">stage plans</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#执行日志分析"><span class="toc-number">4.</span> <span class="toc-text">执行日志分析</span></a></li></ol></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 - 2021 <a href="/." rel="nofollow">Jmx's Blog.</a>All rights reserved.<br>Thoughts on technology, life and everything else.</div></div></div><script type="text/javascript" src="/js/toc.js?v=0.0.0"></script><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="100,99,98" opacity="0.5" zindex="0.7" count="150" src="//lib.baomitu.com/canvas-nest.js/2.0.4/canvas-nest.umd.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>