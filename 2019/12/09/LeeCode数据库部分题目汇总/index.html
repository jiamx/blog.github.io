<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="记录朴实无华且枯燥的生活"><title>LeeCode数据库部分题目汇总 | Jmx's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '912b6cfc43243cd27aeb428f7dbf7823';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="/js/toc.js?v=0.0.0"></script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">LeeCode数据库部分题目汇总</h1><a id="logo" href="/.">Jmx's Blog</a><p class="description">Keep it Simple and Stupid!</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-pied-piper-alt"> 关于</i></a><a href="/tags"><i class="fa fa-tags"> 标签</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">LeeCode数据库部分题目汇总</h1><div class="post-meta">Dec 9, 2019<span> | </span><span class="category"><a href="/categories/LeeCode/">LeeCode</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 4.1k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 21</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="post-content"><p>LeeCode数据库部分SQL题目总结</p>
<a id="more"></a>

<h2 id="176-第二高的薪水"><a href="#176-第二高的薪水" class="headerlink" title="176. 第二高的薪水"></a>176. 第二高的薪水</h2><h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>编写一个 SQL 查询，获取 Employee 表中第二高的薪水（Salary）</p>
<table>
<thead>
<tr>
<th align="center">Id</th>
<th align="center">Salary</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">100</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">200</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">300</td>
</tr>
</tbody></table>
<p>例如上述 Employee 表，SQL查询应该返回 200 作为第二高的薪水。如果不存在第二高的薪水，那么查询应返回 null</p>
<table>
<thead>
<tr>
<th align="center">SecondHighestSalary</th>
</tr>
</thead>
<tbody><tr>
<td align="center">200</td>
</tr>
</tbody></table>
<h3 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> <span class="keyword">If</span> <span class="keyword">Not</span> <span class="keyword">Exists</span> Employee (<span class="keyword">Id</span> <span class="built_in">int</span>, Salary <span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> Employee;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, Salary) <span class="keyword">values</span> (<span class="string">'1'</span>, <span class="string">'100'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, Salary) <span class="keyword">values</span> (<span class="string">'2'</span>, <span class="string">'200'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, Salary) <span class="keyword">values</span> (<span class="string">'3'</span>, <span class="string">'300'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="SQL语句"><a href="#SQL语句" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(Salary) SecondHighestSalary</span><br><span class="line"><span class="keyword">FROM</span> Employee</span><br><span class="line"><span class="keyword">WHERE</span> Salary &lt;</span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(Salary) <span class="keyword">FROM</span> Employee)</span><br></pre></td></tr></table></figure>

<h2 id="178-分数排名"><a href="#178-分数排名" class="headerlink" title="178.分数排名"></a>178.分数排名</h2><h3 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h3><p>编写一个 SQL 查询来实现分数排名。如果两个分数相同，则两个分数排名（Rank）相同。请注意，平分后的下一个名次应该是下一个连续的整数值。换句话说，名次之间不应该有“间隔”。</p>
<table>
<thead>
<tr>
<th align="center">Id</th>
<th align="center">Score</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">3.50</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">3.65</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">4.00</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">3.85</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">4.00</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">3.65</td>
</tr>
</tbody></table>
<p>例如，根据上述给定的 Scores 表，你的查询应该返回（按分数从高到低排列）：</p>
<table>
<thead>
<tr>
<th align="center">Score</th>
<th align="center">Rank</th>
</tr>
</thead>
<tbody><tr>
<td align="center">4.00</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">4.00</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">3.85</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">3.65</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">3.65</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">3.50</td>
<td align="center">4</td>
</tr>
</tbody></table>
<h3 id="数据准备-1"><a href="#数据准备-1" class="headerlink" title="数据准备"></a>数据准备</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> <span class="keyword">If</span> <span class="keyword">Not</span> <span class="keyword">Exists</span> Scores (<span class="keyword">Id</span> <span class="built_in">int</span>, Score <span class="built_in">DECIMAL</span>(<span class="number">3</span>,<span class="number">2</span>));</span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> Scores;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Scores (<span class="keyword">Id</span>, Score) <span class="keyword">values</span> (<span class="string">'1'</span>, <span class="string">'3.5'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Scores (<span class="keyword">Id</span>, Score) <span class="keyword">values</span> (<span class="string">'2'</span>, <span class="string">'3.65'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Scores (<span class="keyword">Id</span>, Score) <span class="keyword">values</span> (<span class="string">'3'</span>, <span class="string">'4.0'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Scores (<span class="keyword">Id</span>, Score) <span class="keyword">values</span> (<span class="string">'4'</span>, <span class="string">'3.85'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Scores (<span class="keyword">Id</span>, Score) <span class="keyword">values</span> (<span class="string">'5'</span>, <span class="string">'4.0'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Scores (<span class="keyword">Id</span>, Score) <span class="keyword">values</span> (<span class="string">'6'</span>, <span class="string">'3.65'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="SQL语句-1"><a href="#SQL语句-1" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">Score,</span><br><span class="line">@<span class="keyword">rank</span> := @<span class="keyword">rank</span> + (@prev &lt;&gt; (@prev := Score)) <span class="keyword">Rank</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">Scores,</span><br><span class="line">(<span class="keyword">SELECT</span> @<span class="keyword">rank</span> := <span class="number">0</span>, @prev := <span class="number">-1</span>) init</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> Score <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>

<h2 id="180-连续出现的数字"><a href="#180-连续出现的数字" class="headerlink" title="180. 连续出现的数字"></a>180. 连续出现的数字</h2><h3 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h3><p>编写一个 SQL 查询，查找所有至少连续出现三次的数字。</p>
<table>
<thead>
<tr>
<th align="center">Id</th>
<th align="center">Num</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">2</td>
</tr>
</tbody></table>
<p>例如，给定上面的 Logs 表， 1 是唯一连续出现至少三次的数字。</p>
<table>
<thead>
<tr>
<th align="center">ConsecutiveNums</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
</tr>
</tbody></table>
<h3 id="数据准备-2"><a href="#数据准备-2" class="headerlink" title="数据准备"></a>数据准备</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> <span class="keyword">If</span> <span class="keyword">Not</span> <span class="keyword">Exists</span> <span class="keyword">Logs</span> (<span class="keyword">Id</span> <span class="built_in">int</span>, <span class="keyword">Num</span> <span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> <span class="keyword">Logs</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Logs</span> (<span class="keyword">Id</span>, <span class="keyword">Num</span>) <span class="keyword">values</span> (<span class="string">'1'</span>, <span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Logs</span> (<span class="keyword">Id</span>, <span class="keyword">Num</span>) <span class="keyword">values</span> (<span class="string">'2'</span>, <span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Logs</span> (<span class="keyword">Id</span>, <span class="keyword">Num</span>) <span class="keyword">values</span> (<span class="string">'3'</span>, <span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Logs</span> (<span class="keyword">Id</span>, <span class="keyword">Num</span>) <span class="keyword">values</span> (<span class="string">'4'</span>, <span class="string">'2'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Logs</span> (<span class="keyword">Id</span>, <span class="keyword">Num</span>) <span class="keyword">values</span> (<span class="string">'5'</span>, <span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Logs</span> (<span class="keyword">Id</span>, <span class="keyword">Num</span>) <span class="keyword">values</span> (<span class="string">'6'</span>, <span class="string">'2'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Logs</span> (<span class="keyword">Id</span>, <span class="keyword">Num</span>) <span class="keyword">values</span> (<span class="string">'7'</span>, <span class="string">'2'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="SQL语句-2"><a href="#SQL语句-2" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> l1.Num ConsecutiveNums</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Logs</span> l1,</span><br><span class="line"><span class="keyword">Logs</span> l2,</span><br><span class="line"><span class="keyword">Logs</span> l3</span><br><span class="line"><span class="keyword">WHERE</span> l1.Id=l2.Id<span class="number">-1</span></span><br><span class="line"><span class="keyword">AND</span> l2.Id =l3.Id<span class="number">-1</span></span><br><span class="line"><span class="keyword">AND</span> l1.Num =l2.Num</span><br><span class="line"><span class="keyword">AND</span> l2.Num =l3.Num</span><br></pre></td></tr></table></figure>

<h2 id="181-超过经理收入的员工"><a href="#181-超过经理收入的员工" class="headerlink" title="181. 超过经理收入的员工"></a>181. 超过经理收入的员工</h2><h3 id="描述-3"><a href="#描述-3" class="headerlink" title="描述"></a>描述</h3><p>Employee 表包含所有员工，他们的经理也属于员工。每个员工都有一个 Id，此外还有一列对应员工的经理的 Id。</p>
<table>
<thead>
<tr>
<th align="center">Id</th>
<th align="center">Name</th>
<th align="center">Salary</th>
<th align="center">ManagerId</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">Joe</td>
<td align="center">70000</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">Henry</td>
<td align="center">80000</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">Sam</td>
<td align="center">60000</td>
<td align="center">null</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">Max</td>
<td align="center">90000</td>
<td align="center">null</td>
</tr>
</tbody></table>
<p>给定 Employee 表，编写一个 SQL 查询，该查询可以获取收入超过他们经理的员工的姓名。在上面的表格中，Joe 是唯一一个收入超过他的经理的员工</p>
<table>
<thead>
<tr>
<th align="center">Employee</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Joe</td>
</tr>
</tbody></table>
<h3 id="数据准备-3"><a href="#数据准备-3" class="headerlink" title="数据准备"></a>数据准备</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> <span class="keyword">If</span> <span class="keyword">Not</span> <span class="keyword">Exists</span> Employee (<span class="keyword">Id</span> <span class="built_in">int</span>, <span class="keyword">Name</span> <span class="built_in">varchar</span>(<span class="number">255</span>), Salary <span class="built_in">int</span>, ManagerId <span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> Employee;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, <span class="keyword">Name</span>, Salary, ManagerId) <span class="keyword">values</span> (<span class="string">'1'</span>, <span class="string">'Joe'</span>, <span class="string">'70000'</span>, <span class="string">'3'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, <span class="keyword">Name</span>, Salary, ManagerId) <span class="keyword">values</span> (<span class="string">'2'</span>, <span class="string">'Henry'</span>, <span class="string">'80000'</span>, <span class="string">'4'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, <span class="keyword">Name</span>, Salary, ManagerId) <span class="keyword">values</span> (<span class="string">'3'</span>, <span class="string">'Sam'</span>, <span class="string">'60000'</span>, <span class="string">'None'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, <span class="keyword">Name</span>, Salary, ManagerId) <span class="keyword">values</span> (<span class="string">'4'</span>, <span class="string">'Max'</span>, <span class="string">'90000'</span>, <span class="string">'None'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="SQL语句-3"><a href="#SQL语句-3" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">     a.NAME <span class="keyword">AS</span> Employee</span><br><span class="line"><span class="keyword">FROM</span> Employee <span class="keyword">AS</span> a <span class="keyword">JOIN</span> Employee <span class="keyword">AS</span> b</span><br><span class="line">     <span class="keyword">ON</span> a.ManagerId = b.Id</span><br><span class="line">     <span class="keyword">AND</span> a.Salary &gt; b.Salary</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<h2 id="182-查找重复的电子邮箱"><a href="#182-查找重复的电子邮箱" class="headerlink" title="182. 查找重复的电子邮箱"></a>182. 查找重复的电子邮箱</h2><h3 id="描述-4"><a href="#描述-4" class="headerlink" title="描述"></a>描述</h3><p>编写一个 SQL 查询，查找 Person 表中所有重复的电子邮箱。示例：</p>
<table>
<thead>
<tr>
<th align="center">Id</th>
<th align="center">Email</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center"><a href="mailto:a@b.com" target="_blank" rel="noopener">a@b.com</a></td>
</tr>
<tr>
<td align="center">2</td>
<td align="center"><a href="mailto:c@d.com" target="_blank" rel="noopener">c@d.com</a></td>
</tr>
<tr>
<td align="center">3</td>
<td align="center"><a href="mailto:a@b.com" target="_blank" rel="noopener">a@b.com</a></td>
</tr>
</tbody></table>
<p>根据以上输入，你的查询应返回以下结果：</p>
<table>
<thead>
<tr>
<th align="center">Email</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><a href="mailto:a@b.com" target="_blank" rel="noopener">a@b.com</a></td>
</tr>
</tbody></table>
<p>说明：所有电子邮箱都是小写字母。</p>
<h3 id="数据准备-4"><a href="#数据准备-4" class="headerlink" title="数据准备"></a>数据准备</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> <span class="keyword">If</span> <span class="keyword">Not</span> <span class="keyword">Exists</span> Person (<span class="keyword">Id</span> <span class="built_in">int</span>, Email <span class="built_in">varchar</span>(<span class="number">255</span>));</span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> Person;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Person (<span class="keyword">Id</span>, Email) <span class="keyword">values</span> (<span class="string">'1'</span>, <span class="string">'a@b.com'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Person (<span class="keyword">Id</span>, Email) <span class="keyword">values</span> (<span class="string">'2'</span>, <span class="string">'c@d.com'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Person (<span class="keyword">Id</span>, Email) <span class="keyword">values</span> (<span class="string">'3'</span>, <span class="string">'a@b.com'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="SQL语句-4"><a href="#SQL语句-4" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 方法1：</span></span><br><span class="line"><span class="keyword">select</span> Email <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">  <span class="keyword">select</span> Email, <span class="keyword">count</span>(Email) <span class="keyword">as</span> <span class="keyword">num</span></span><br><span class="line">  <span class="keyword">from</span> Person</span><br><span class="line">  <span class="keyword">group</span> <span class="keyword">by</span> Email</span><br><span class="line">) <span class="keyword">as</span> statistic</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">num</span> &gt; <span class="number">1</span></span><br><span class="line">;</span><br><span class="line"><span class="comment">-- 方法2</span></span><br><span class="line"><span class="keyword">select</span> Email</span><br><span class="line"><span class="keyword">from</span> Person</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> Email</span><br><span class="line"><span class="keyword">having</span> <span class="keyword">count</span>(Email) &gt; <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 方法3</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">     <span class="keyword">distinct</span>(P1.Email) <span class="string">'Email'</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">      Person P1,</span><br><span class="line">      Person P2</span><br><span class="line"><span class="keyword">where</span> P1.Id &lt;&gt; P2.Id <span class="keyword">and</span> P1.Email = P2.Email</span><br></pre></td></tr></table></figure>

<h2 id="183-从不订购的客户"><a href="#183-从不订购的客户" class="headerlink" title="183. 从不订购的客户"></a>183. 从不订购的客户</h2><h3 id="描述-5"><a href="#描述-5" class="headerlink" title="描述"></a>描述</h3><p>某网站包含两个表，Customers 表和 Orders 表。编写一个 SQL 查询，找出所有从不订购任何东西的客户。</p>
<p>Customers 表：</p>
<table>
<thead>
<tr>
<th align="center">Id</th>
<th align="center">Name</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">Joe</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">Henry</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">Sam</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">Max</td>
</tr>
</tbody></table>
<p>Orders 表：</p>
<table>
<thead>
<tr>
<th align="center">Id</th>
<th align="center">CustomerId</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">1</td>
</tr>
</tbody></table>
<p>例如给定上述表格，你的查询应返回：</p>
<table>
<thead>
<tr>
<th align="center">Customers</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Henry</td>
</tr>
<tr>
<td align="center">Max</td>
</tr>
</tbody></table>
<h3 id="数据准备-5"><a href="#数据准备-5" class="headerlink" title="数据准备"></a>数据准备</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> <span class="keyword">If</span> <span class="keyword">Not</span> <span class="keyword">Exists</span> Customers (<span class="keyword">Id</span> <span class="built_in">int</span>, <span class="keyword">Name</span> <span class="built_in">varchar</span>(<span class="number">255</span>));</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> <span class="keyword">If</span> <span class="keyword">Not</span> <span class="keyword">Exists</span> Orders (<span class="keyword">Id</span> <span class="built_in">int</span>, CustomerId <span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> Customers;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Customers (<span class="keyword">Id</span>, <span class="keyword">Name</span>) <span class="keyword">values</span> (<span class="string">'1'</span>, <span class="string">'Joe'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Customers (<span class="keyword">Id</span>, <span class="keyword">Name</span>) <span class="keyword">values</span> (<span class="string">'2'</span>, <span class="string">'Henry'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Customers (<span class="keyword">Id</span>, <span class="keyword">Name</span>) <span class="keyword">values</span> (<span class="string">'3'</span>, <span class="string">'Sam'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Customers (<span class="keyword">Id</span>, <span class="keyword">Name</span>) <span class="keyword">values</span> (<span class="string">'4'</span>, <span class="string">'Max'</span>);</span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> Orders;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Orders (<span class="keyword">Id</span>, CustomerId) <span class="keyword">values</span> (<span class="string">'1'</span>, <span class="string">'3'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Orders (<span class="keyword">Id</span>, CustomerId) <span class="keyword">values</span> (<span class="string">'2'</span>, <span class="string">'1'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="SQL语句-5"><a href="#SQL语句-5" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 方法1：</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	a.NAME <span class="string">'Customers'</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	Customers a</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Orders b <span class="keyword">ON</span> a.Id = b.CustomerId </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	b.Id <span class="keyword">IS</span> <span class="literal">NULL</span></span><br><span class="line"><span class="comment">-- 方法2：</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NAME</span></span><br><span class="line">	<span class="string">'Customers'</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	Customers </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	<span class="keyword">Id</span> <span class="keyword">NOT</span> <span class="keyword">IN</span> ( <span class="keyword">SELECT</span> CustomerId <span class="keyword">FROM</span> Orders )</span><br></pre></td></tr></table></figure>

<h2 id="184-部门工资最高的员工"><a href="#184-部门工资最高的员工" class="headerlink" title="184. 部门工资最高的员工"></a>184. 部门工资最高的员工</h2><h3 id="描述-6"><a href="#描述-6" class="headerlink" title="描述"></a>描述</h3><p>Employee 表包含所有员工信息，每个员工有其对应的 Id, salary 和 department Id。</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Name</th>
<th>Salary</th>
<th>DepartmentId</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Joe</td>
<td>70000</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>Henry</td>
<td>80000</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>Sam</td>
<td>60000</td>
<td>2</td>
</tr>
<tr>
<td>4</td>
<td>Max</td>
<td>90000</td>
<td>1</td>
</tr>
</tbody></table>
<p>Department 表包含公司所有部门的信息。</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Name</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>IT</td>
</tr>
<tr>
<td>2</td>
<td>Sales</td>
</tr>
</tbody></table>
<p>编写一个 SQL 查询，找出每个部门工资最高的员工。例如，根据上述给定的表格，Max 在 IT 部门有最高工资，Henry 在 Sales 部门有最高工资。</p>
<table>
<thead>
<tr>
<th>Department</th>
<th>Employee</th>
<th>Salary</th>
</tr>
</thead>
<tbody><tr>
<td>IT</td>
<td>Max</td>
<td>90000</td>
</tr>
<tr>
<td>Sales</td>
<td>Henry</td>
<td>80000</td>
</tr>
</tbody></table>
<h3 id="数据准备-6"><a href="#数据准备-6" class="headerlink" title="数据准备"></a>数据准备</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> <span class="keyword">If</span> <span class="keyword">Not</span> <span class="keyword">Exists</span> Employee (<span class="keyword">Id</span> <span class="built_in">int</span>, <span class="keyword">Name</span> <span class="built_in">varchar</span>(<span class="number">255</span>), Salary <span class="built_in">int</span>, DepartmentId <span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> <span class="keyword">If</span> <span class="keyword">Not</span> <span class="keyword">Exists</span> Department (<span class="keyword">Id</span> <span class="built_in">int</span>, <span class="keyword">Name</span> <span class="built_in">varchar</span>(<span class="number">255</span>));</span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> Employee;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, <span class="keyword">Name</span>, Salary, DepartmentId) <span class="keyword">values</span> (<span class="string">'1'</span>, <span class="string">'Joe'</span>, <span class="string">'70000'</span>, <span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, <span class="keyword">Name</span>, Salary, DepartmentId) <span class="keyword">values</span> (<span class="string">'2'</span>, <span class="string">'Henry'</span>, <span class="string">'80000'</span>, <span class="string">'2'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, <span class="keyword">Name</span>, Salary, DepartmentId) <span class="keyword">values</span> (<span class="string">'3'</span>, <span class="string">'Sam'</span>, <span class="string">'60000'</span>, <span class="string">'2'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, <span class="keyword">Name</span>, Salary, DepartmentId) <span class="keyword">values</span> (<span class="string">'4'</span>, <span class="string">'Max'</span>, <span class="string">'90000'</span>, <span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> Department;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Department (<span class="keyword">Id</span>, <span class="keyword">Name</span>) <span class="keyword">values</span> (<span class="string">'1'</span>, <span class="string">'IT'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Department (<span class="keyword">Id</span>, <span class="keyword">Name</span>) <span class="keyword">values</span> (<span class="string">'2'</span>, <span class="string">'Sales'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="SQL语句-6"><a href="#SQL语句-6" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    Department.name <span class="keyword">AS</span> <span class="string">'Department'</span>,</span><br><span class="line">    Employee.name <span class="keyword">AS</span> <span class="string">'Employee'</span>,</span><br><span class="line">    Salary</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    Employee</span><br><span class="line">        <span class="keyword">JOIN</span></span><br><span class="line">    Department <span class="keyword">ON</span> Employee.DepartmentId = Department.Id</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    (Employee.DepartmentId , Salary) <span class="keyword">IN</span></span><br><span class="line">    (   <span class="keyword">SELECT</span></span><br><span class="line">            DepartmentId, <span class="keyword">MAX</span>(Salary)</span><br><span class="line">        <span class="keyword">FROM</span></span><br><span class="line">            Employee</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> DepartmentId</span><br><span class="line">	)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<h2 id="185-部门工资前三高的所有员工"><a href="#185-部门工资前三高的所有员工" class="headerlink" title="185.部门工资前三高的所有员工"></a>185.部门工资前三高的所有员工</h2><h3 id="描述-7"><a href="#描述-7" class="headerlink" title="描述"></a>描述</h3><p>Employee 表包含所有员工信息，每个员工有其对应的工号 Id，姓名 Name，工资 Salary 和部门编号 DepartmentId 。</p>
<table>
<thead>
<tr>
<th align="center">Id</th>
<th align="center">Name</th>
<th align="center">Salary</th>
<th align="center">DepartmentId</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">Joe</td>
<td align="center">85000</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">Henry</td>
<td align="center">80000</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">Sam</td>
<td align="center">60000</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">Max</td>
<td align="center">90000</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">Janet</td>
<td align="center">69000</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">Randy</td>
<td align="center">85000</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">Will</td>
<td align="center">70000</td>
<td align="center">1</td>
</tr>
</tbody></table>
<p>Department 表包含公司所有部门的信息。</p>
<table>
<thead>
<tr>
<th align="center">Id</th>
<th align="center">Name</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">IT</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">Sales</td>
</tr>
</tbody></table>
<p>编写一个 SQL 查询，找出每个部门获得前三高工资的所有员工。例如，根据上述给定的表，查询结果应返回：</p>
<table>
<thead>
<tr>
<th align="center">Department</th>
<th align="center">Employee</th>
<th align="center">Salary</th>
</tr>
</thead>
<tbody><tr>
<td align="center">IT</td>
<td align="center">Max</td>
<td align="center">90000</td>
</tr>
<tr>
<td align="center">IT</td>
<td align="center">Randy</td>
<td align="center">85000</td>
</tr>
<tr>
<td align="center">IT</td>
<td align="center">Joe</td>
<td align="center">85000</td>
</tr>
<tr>
<td align="center">IT</td>
<td align="center">Will</td>
<td align="center">70000</td>
</tr>
<tr>
<td align="center">Sales</td>
<td align="center">Henry</td>
<td align="center">80000</td>
</tr>
<tr>
<td align="center">Sales</td>
<td align="center">Sam</td>
<td align="center">60000</td>
</tr>
</tbody></table>
<p>解释：</p>
<p>IT 部门中，Max 获得了最高的工资，Randy 和 Joe 都拿到了第二高的工资，Will 的工资排第三。销售部门（Sales）只有两名员工，Henry 的工资最高，Sam 的工资排第二。</p>
<h3 id="数据准备-7"><a href="#数据准备-7" class="headerlink" title="数据准备"></a>数据准备</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> <span class="keyword">If</span> <span class="keyword">Not</span> <span class="keyword">Exists</span> Employee (<span class="keyword">Id</span> <span class="built_in">int</span>, <span class="keyword">Name</span> <span class="built_in">varchar</span>(<span class="number">255</span>), Salary <span class="built_in">int</span>, DepartmentId <span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> <span class="keyword">If</span> <span class="keyword">Not</span> <span class="keyword">Exists</span> Department (<span class="keyword">Id</span> <span class="built_in">int</span>, <span class="keyword">Name</span> <span class="built_in">varchar</span>(<span class="number">255</span>));</span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> Employee;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, <span class="keyword">Name</span>, Salary, DepartmentId) <span class="keyword">values</span> (<span class="string">'1'</span>, <span class="string">'Joe'</span>, <span class="string">'85000'</span>, <span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, <span class="keyword">Name</span>, Salary, DepartmentId) <span class="keyword">values</span> (<span class="string">'2'</span>, <span class="string">'Henry'</span>, <span class="string">'80000'</span>, <span class="string">'2'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, <span class="keyword">Name</span>, Salary, DepartmentId) <span class="keyword">values</span> (<span class="string">'3'</span>, <span class="string">'Sam'</span>, <span class="string">'60000'</span>, <span class="string">'2'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, <span class="keyword">Name</span>, Salary, DepartmentId) <span class="keyword">values</span> (<span class="string">'4'</span>, <span class="string">'Max'</span>, <span class="string">'90000'</span>, <span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, <span class="keyword">Name</span>, Salary, DepartmentId) <span class="keyword">values</span> (<span class="string">'5'</span>, <span class="string">'Janet'</span>, <span class="string">'69000'</span>, <span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, <span class="keyword">Name</span>, Salary, DepartmentId) <span class="keyword">values</span> (<span class="string">'6'</span>, <span class="string">'Randy'</span>, <span class="string">'85000'</span>, <span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Employee (<span class="keyword">Id</span>, <span class="keyword">Name</span>, Salary, DepartmentId) <span class="keyword">values</span> (<span class="string">'7'</span>, <span class="string">'Will'</span>, <span class="string">'70000'</span>, <span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> Department;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Department (<span class="keyword">Id</span>, <span class="keyword">Name</span>) <span class="keyword">values</span> (<span class="string">'1'</span>, <span class="string">'IT'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Department (<span class="keyword">Id</span>, <span class="keyword">Name</span>) <span class="keyword">values</span> (<span class="string">'2'</span>, <span class="string">'Sales'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="SQL语句-7"><a href="#SQL语句-7" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">d.Name <span class="keyword">AS</span> <span class="string">'Department'</span>, e1.Name <span class="keyword">AS</span> <span class="string">'Employee'</span>, e1.Salary</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">Employee e1</span><br><span class="line"><span class="keyword">JOIN</span></span><br><span class="line">Department d <span class="keyword">ON</span> e1.DepartmentId = d.Id</span><br><span class="line"><span class="keyword">WHERE</span> <span class="comment">-- 相关子查询，父查询传递一个元祖到子查询，遍历子查询的的数据，如果满足不超过3个人的工资大于传过来的工资，则保留该元祖的数据，否则就过滤掉</span></span><br><span class="line"><span class="number">3</span> &gt; (<span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> e2.Salary) <span class="comment">-- 对于重复的工资，计数一次，从而保证相同的工资的排名相同</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">Employee e2</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">e2.Salary &gt; e1.Salary</span><br><span class="line"><span class="keyword">AND</span> e1.DepartmentId = e2.DepartmentId</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="196-删除重复的邮箱"><a href="#196-删除重复的邮箱" class="headerlink" title="196.删除重复的邮箱"></a>196.删除重复的邮箱</h2><h3 id="描述-8"><a href="#描述-8" class="headerlink" title="描述"></a>描述</h3><p>编写一个 SQL 查询，来删除 Person 表中所有重复的电子邮箱，重复的邮箱里只保留 Id 最小 的那个。</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Email</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><a href="mailto:john@example.com" target="_blank" rel="noopener">john@example.com</a></td>
</tr>
<tr>
<td>2</td>
<td><a href="mailto:bob@example.com" target="_blank" rel="noopener">bob@example.com</a></td>
</tr>
<tr>
<td>3</td>
<td><a href="mailto:john@example.com" target="_blank" rel="noopener">john@example.com</a></td>
</tr>
</tbody></table>
<p>Id 是这个表的主键。<br>例如，在运行你的查询语句之后，上面的 Person 表应返回以下几行:</p>
<table>
<thead>
<tr>
<th align="center">Id</th>
<th align="center">Email</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center"><a href="mailto:john@example.com" target="_blank" rel="noopener">john@example.com</a></td>
</tr>
<tr>
<td align="center">2</td>
<td align="center"><a href="mailto:bob@example.com" target="_blank" rel="noopener">bob@example.com</a></td>
</tr>
</tbody></table>
<h3 id="数据准备-8"><a href="#数据准备-8" class="headerlink" title="数据准备"></a>数据准备</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> <span class="keyword">If</span> <span class="keyword">Not</span> <span class="keyword">Exists</span> Person (<span class="keyword">Id</span> <span class="built_in">int</span>,Email <span class="built_in">varchar</span>(<span class="number">20</span>));</span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> Person;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Person <span class="keyword">values</span> (<span class="string">'1'</span>,  <span class="string">'john@example.com'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Person <span class="keyword">values</span> (<span class="string">'2'</span>,  <span class="string">'bob@example.com'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Person <span class="keyword">values</span> (<span class="string">'3'</span>,  <span class="string">'john@example.com'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="SQL语句-8"><a href="#SQL语句-8" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> p1.* </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	Person p1,</span><br><span class="line">	Person p2 </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	p1.Email = p2.Email </span><br><span class="line">	<span class="keyword">AND</span> p1.Id &gt; p2.Id</span><br></pre></td></tr></table></figure>

<h2 id="197-上升的温度"><a href="#197-上升的温度" class="headerlink" title="197.上升的温度"></a>197.上升的温度</h2><h3 id="描述-9"><a href="#描述-9" class="headerlink" title="描述"></a>描述</h3><p>给定一个 Weather 表，编写一个 SQL 查询，来查找与之前（昨天的）日期相比温度更高的所有日期的 Id。</p>
<table>
<thead>
<tr>
<th align="center">Id(INT)</th>
<th align="center">RecordDate(DATE)</th>
<th align="center">Temperature(INT)</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">2015-01-01</td>
<td align="center">10</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">2015-01-02</td>
<td align="center">25</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">2015-01-03</td>
<td align="center">20</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">2015-01-04</td>
<td align="center">30</td>
</tr>
</tbody></table>
<p>例如，根据上述给定的 Weather 表格，返回如下 Id:</p>
<table>
<thead>
<tr>
<th align="center">id</th>
</tr>
</thead>
<tbody><tr>
<td align="center">2</td>
</tr>
<tr>
<td align="center">4</td>
</tr>
</tbody></table>
<h3 id="数据准备-9"><a href="#数据准备-9" class="headerlink" title="数据准备"></a>数据准备</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> <span class="keyword">If</span> <span class="keyword">Not</span> <span class="keyword">Exists</span> Weather (<span class="keyword">Id</span> <span class="built_in">int</span>, <span class="built_in">Date</span> <span class="built_in">date</span>, Temperature <span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> Weather;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Weather (<span class="keyword">Id</span>, <span class="built_in">Date</span>, Temperature) <span class="keyword">values</span> (<span class="string">'1'</span>, <span class="string">'2015-01-01'</span>, <span class="string">'10'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Weather (<span class="keyword">Id</span>, <span class="built_in">Date</span>, Temperature) <span class="keyword">values</span> (<span class="string">'2'</span>, <span class="string">'2015-01-02'</span>, <span class="string">'25'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Weather (<span class="keyword">Id</span>, <span class="built_in">Date</span>, Temperature) <span class="keyword">values</span> (<span class="string">'3'</span>, <span class="string">'2015-01-03'</span>, <span class="string">'20'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Weather (<span class="keyword">Id</span>, <span class="built_in">Date</span>, Temperature) <span class="keyword">values</span> (<span class="string">'4'</span>, <span class="string">'2015-01-04'</span>, <span class="string">'30'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="SQL语句-9"><a href="#SQL语句-9" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	a.Id </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	Weather a</span><br><span class="line">	<span class="keyword">JOIN</span> Weather b <span class="keyword">ON</span> <span class="keyword">DATEDIFF</span>(a.RecordDate,b.RecordDate) = <span class="number">1</span></span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	a.Temperature &gt; b.Temperature</span><br></pre></td></tr></table></figure>

<h2 id="262-行程与用户"><a href="#262-行程与用户" class="headerlink" title="262.行程与用户"></a>262.行程与用户</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>Trips 表中存所有出租车的行程信息。每段行程有唯一键 Id，Client_Id 和 Driver_Id 是 Users 表中 Users_Id 的外键。Status 是枚举类型，枚举成员为 (‘completed’, ‘cancelled_by_driver’, ‘cancelled_by_client’)。</p>
<table>
<thead>
<tr>
<th align="center">Id</th>
<th align="center">Client_Id</th>
<th align="center">Driver_Id</th>
<th align="center">City_Id</th>
<th align="center">Status</th>
<th align="center">Request_at</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">10</td>
<td align="center">1</td>
<td align="center">completed</td>
<td align="center">2013-10-01</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">11</td>
<td align="center">1</td>
<td align="center">cancelled_by_driver</td>
<td align="center">2013-10-01</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">3</td>
<td align="center">12</td>
<td align="center">6</td>
<td align="center">cancelled</td>
<td align="center">2013-10-01</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">4</td>
<td align="center">13</td>
<td align="center">6</td>
<td align="center">cancelled_by_client</td>
<td align="center">2013-10-01</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">1</td>
<td align="center">10</td>
<td align="center">1</td>
<td align="center">completed</td>
<td align="center">2013-10-02</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">2</td>
<td align="center">11</td>
<td align="center">6</td>
<td align="center">completed</td>
<td align="center">2013-10-02</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">3</td>
<td align="center">12</td>
<td align="center">6</td>
<td align="center">completed</td>
<td align="center">2013-10-02</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">2</td>
<td align="center">12</td>
<td align="center">12</td>
<td align="center">completed</td>
<td align="center">2013-10-03</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">3</td>
<td align="center">10</td>
<td align="center">12</td>
<td align="center">completed</td>
<td align="center">2013-10-03</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">4</td>
<td align="center">13</td>
<td align="center">12</td>
<td align="center">cancelled_by_driver</td>
<td align="center">2013-10-03</td>
</tr>
</tbody></table>
<p>Users 表存所有用户。每个用户有唯一键 Users_Id。Banned 表示这个用户是否被禁止，Role 则是一个表示（‘client’, ‘driver’, ‘partner’）的枚举类型。</p>
<table>
<thead>
<tr>
<th align="center">Users_Id</th>
<th align="center">Banned</th>
<th align="center">Role</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">No</td>
<td align="center">client</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">Yes</td>
<td align="center">client</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">No</td>
<td align="center">client</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">No</td>
<td align="center">client</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">No</td>
<td align="center">driver</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">No</td>
<td align="center">driver</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">No</td>
<td align="center">driver</td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">No</td>
<td align="center">driver</td>
</tr>
</tbody></table>
<p>写一段 SQL 语句查出 2013年10月1日 至 2013年10月3日 期间非禁止用户的取消率。基于上表，你的 SQL 语句应返回如下结果，取消率（Cancellation Rate）保留两位小数。</p>
<p>取消率的计算方式如下：(被司机或乘客取消的非禁止用户生成的订单数量) / (非禁止用户生成的订单总数)</p>
<table>
<thead>
<tr>
<th align="center">Day</th>
<th align="center">Cancellation Rate</th>
</tr>
</thead>
<tbody><tr>
<td align="center">2013-10-01</td>
<td align="center">0.33</td>
</tr>
<tr>
<td align="center">2013-10-02</td>
<td align="center">0.00</td>
</tr>
<tr>
<td align="center">2013-10-03</td>
<td align="center">0.50</td>
</tr>
</tbody></table>
<h3 id="数据准备-10"><a href="#数据准备-10" class="headerlink" title="数据准备"></a>数据准备</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> <span class="keyword">If</span> <span class="keyword">Not</span> <span class="keyword">Exists</span> Trips (<span class="keyword">Id</span> <span class="built_in">int</span>, Client_Id <span class="built_in">int</span>, Driver_Id <span class="built_in">int</span>,</span><br><span class="line">City_Id <span class="built_in">int</span>, <span class="keyword">Status</span> ENUM(<span class="string">'completed'</span>, <span class="string">'cancelled_by_driver'</span>, <span class="string">'cancelled_by_client'</span>),</span><br><span class="line">Request_at <span class="built_in">varchar</span>(<span class="number">50</span>));</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> <span class="keyword">If</span> <span class="keyword">Not</span> <span class="keyword">Exists</span> <span class="keyword">Users</span> (Users_Id <span class="built_in">int</span>,</span><br><span class="line">Banned <span class="built_in">varchar</span>(<span class="number">50</span>), <span class="keyword">Role</span> ENUM(<span class="string">'client'</span>, <span class="string">'driver'</span>, <span class="string">'partner'</span>));</span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> Trips;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Trips (<span class="keyword">Id</span>, Client_Id, Driver_Id, City_Id, <span class="keyword">Status</span>,</span><br><span class="line">Request_at) <span class="keyword">values</span> (<span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'10'</span>, <span class="string">'1'</span>, <span class="string">'completed'</span>, <span class="string">'2013-10-01'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Trips (<span class="keyword">Id</span>, Client_Id, Driver_Id, City_Id, <span class="keyword">Status</span>,</span><br><span class="line">Request_at) <span class="keyword">values</span> (<span class="string">'2'</span>, <span class="string">'2'</span>, <span class="string">'11'</span>, <span class="string">'1'</span>, <span class="string">'cancelled_by_driver'</span>, <span class="string">'2013-10-01'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Trips (<span class="keyword">Id</span>, Client_Id, Driver_Id, City_Id, <span class="keyword">Status</span>,</span><br><span class="line">Request_at) <span class="keyword">values</span> (<span class="string">'3'</span>, <span class="string">'3'</span>, <span class="string">'12'</span>, <span class="string">'6'</span>, <span class="string">'completed'</span>, <span class="string">'2013-10-01'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Trips (<span class="keyword">Id</span>, Client_Id, Driver_Id, City_Id, <span class="keyword">Status</span>,</span><br><span class="line">Request_at) <span class="keyword">values</span> (<span class="string">'4'</span>, <span class="string">'4'</span>, <span class="string">'13'</span>, <span class="string">'6'</span>, <span class="string">'cancelled_by_client'</span>, <span class="string">'2013-10-01'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Trips (<span class="keyword">Id</span>, Client_Id, Driver_Id, City_Id, <span class="keyword">Status</span>,</span><br><span class="line">Request_at) <span class="keyword">values</span> (<span class="string">'5'</span>, <span class="string">'1'</span>, <span class="string">'10'</span>, <span class="string">'1'</span>, <span class="string">'completed'</span>, <span class="string">'2013-10-02'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Trips (<span class="keyword">Id</span>, Client_Id, Driver_Id, City_Id, <span class="keyword">Status</span>,</span><br><span class="line">Request_at) <span class="keyword">values</span> (<span class="string">'6'</span>, <span class="string">'2'</span>, <span class="string">'11'</span>, <span class="string">'6'</span>, <span class="string">'completed'</span>, <span class="string">'2013-10-02'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Trips (<span class="keyword">Id</span>, Client_Id, Driver_Id, City_Id, <span class="keyword">Status</span>,</span><br><span class="line">Request_at) <span class="keyword">values</span> (<span class="string">'7'</span>, <span class="string">'3'</span>, <span class="string">'12'</span>, <span class="string">'6'</span>, <span class="string">'completed'</span>, <span class="string">'2013-10-02'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Trips (<span class="keyword">Id</span>, Client_Id, Driver_Id, City_Id, <span class="keyword">Status</span>,</span><br><span class="line">Request_at) <span class="keyword">values</span> (<span class="string">'8'</span>, <span class="string">'2'</span>, <span class="string">'12'</span>, <span class="string">'12'</span>, <span class="string">'completed'</span>, <span class="string">'2013-10-03'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Trips (<span class="keyword">Id</span>, Client_Id, Driver_Id, City_Id, <span class="keyword">Status</span>,</span><br><span class="line">Request_at) <span class="keyword">values</span> (<span class="string">'9'</span>, <span class="string">'3'</span>, <span class="string">'10'</span>, <span class="string">'12'</span>, <span class="string">'completed'</span>, <span class="string">'2013-10-03'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> Trips (<span class="keyword">Id</span>, Client_Id, Driver_Id, City_Id, <span class="keyword">Status</span>,</span><br><span class="line">Request_at) <span class="keyword">values</span> (<span class="string">'10'</span>, <span class="string">'4'</span>, <span class="string">'13'</span>, <span class="string">'12'</span>, <span class="string">'cancelled_by_driver'</span>, <span class="string">'2013-10-03'</span>);</span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> <span class="keyword">Users</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Users</span> (Users_Id, Banned, <span class="keyword">Role</span>) <span class="keyword">values</span> (<span class="string">'1'</span>, <span class="string">'No'</span>, <span class="string">'client'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Users</span> (Users_Id, Banned, <span class="keyword">Role</span>) <span class="keyword">values</span> (<span class="string">'2'</span>, <span class="string">'Yes'</span>, <span class="string">'client'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Users</span> (Users_Id, Banned, <span class="keyword">Role</span>) <span class="keyword">values</span> (<span class="string">'3'</span>, <span class="string">'No'</span>, <span class="string">'client'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Users</span> (Users_Id, Banned, <span class="keyword">Role</span>) <span class="keyword">values</span> (<span class="string">'4'</span>, <span class="string">'No'</span>, <span class="string">'client'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Users</span> (Users_Id, Banned, <span class="keyword">Role</span>) <span class="keyword">values</span> (<span class="string">'10'</span>, <span class="string">'No'</span>, <span class="string">'driver'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Users</span> (Users_Id, Banned, <span class="keyword">Role</span>) <span class="keyword">values</span> (<span class="string">'11'</span>, <span class="string">'No'</span>, <span class="string">'driver'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Users</span> (Users_Id, Banned, <span class="keyword">Role</span>) <span class="keyword">values</span> (<span class="string">'12'</span>, <span class="string">'No'</span>, <span class="string">'driver'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Users</span> (Users_Id, Banned, <span class="keyword">Role</span>) <span class="keyword">values</span> (<span class="string">'13'</span>, <span class="string">'No'</span>, <span class="string">'driver'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="SQL语句-10"><a href="#SQL语句-10" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 方法1：</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	temp1.Request_at <span class="keyword">AS</span> <span class="keyword">DAY</span>,</span><br><span class="line"><span class="keyword">IF</span></span><br><span class="line">	(</span><br><span class="line">	<span class="keyword">cast</span>( ( temp2.cancelled_order / temp1.total_order ) <span class="keyword">AS</span> <span class="built_in">DECIMAL</span> ( <span class="number">3</span>, <span class="number">2</span> ) ) <span class="keyword">IS</span> <span class="literal">NULL</span>,</span><br><span class="line">	<span class="number">0.00</span>,</span><br><span class="line">	<span class="keyword">cast</span>( ( temp2.cancelled_order / temp1.total_order ) <span class="keyword">AS</span> <span class="built_in">DECIMAL</span> ( <span class="number">3</span>, <span class="number">2</span> ) ) </span><br><span class="line">	) <span class="keyword">AS</span> <span class="string">'Cancellation Rate'</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	(</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	t1.Request_at,</span><br><span class="line">	<span class="keyword">count</span>( * ) <span class="keyword">AS</span> total_order </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	( <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Trips <span class="keyword">WHERE</span> Request_at &gt;= <span class="string">'2013-10-01'</span> <span class="keyword">AND</span> Request_at &lt;= <span class="string">'2013-10-03'</span> ) t1</span><br><span class="line">	<span class="keyword">JOIN</span> ( <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">Users</span> <span class="keyword">WHERE</span> Banned = <span class="string">'NO'</span> ) t2 <span class="keyword">ON</span> t1.Client_Id = t2.Users_Id </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	t1.Request_at </span><br><span class="line">	) temp1</span><br><span class="line">	<span class="keyword">LEFT</span> <span class="keyword">JOIN</span> (</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	t1.Request_at,</span><br><span class="line">	<span class="keyword">count</span>( * ) <span class="keyword">AS</span> cancelled_order </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	( <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Trips <span class="keyword">WHERE</span> Request_at &gt;= <span class="string">'2013-10-01'</span> <span class="keyword">AND</span> Request_at &lt;= <span class="string">'2013-10-03'</span> <span class="keyword">AND</span> ( <span class="keyword">STATUS</span> = <span class="string">'cancelled_by_driver'</span> <span class="keyword">OR</span> <span class="keyword">STATUS</span> = <span class="string">'cancelled_by_client'</span> ) ) t1</span><br><span class="line">	<span class="keyword">JOIN</span> ( <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">Users</span> <span class="keyword">WHERE</span> Banned = <span class="string">'NO'</span> ) t2 <span class="keyword">ON</span> t1.Client_Id = t2.Users_Id </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	t1.Request_at </span><br><span class="line">	) temp2 <span class="keyword">ON</span> temp1.Request_at = temp2.Request_at</span><br><span class="line">	<span class="comment">-- ---------------------------------------------------------</span></span><br><span class="line">	<span class="comment"># 方法2：</span></span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">	temp.request_at <span class="keyword">DAY</span>,</span><br><span class="line">	<span class="keyword">round</span>( <span class="keyword">sum</span>( <span class="keyword">CASE</span> temp.STATUS <span class="keyword">WHEN</span> <span class="string">'completed'</span> <span class="keyword">THEN</span> <span class="number">0</span> <span class="keyword">ELSE</span> <span class="number">1</span> <span class="keyword">END</span> ) / <span class="keyword">count</span>( temp.STATUS ), <span class="number">2</span> ) <span class="string">'Cancellation Rate'</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	( <span class="keyword">SELECT</span> <span class="keyword">STATUS</span>, request_at <span class="keyword">FROM</span> trips t <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="keyword">users</span> u <span class="keyword">ON</span> t.client_id = u.users_id <span class="keyword">WHERE</span> u.banned = <span class="string">'no'</span> ) temp </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	request_at <span class="keyword">BETWEEN</span> <span class="string">'2013-10-01'</span> </span><br><span class="line">	<span class="keyword">AND</span> <span class="string">'2013-10-03'</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	temp.request_at</span><br></pre></td></tr></table></figure>

<h2 id="511-游戏玩家分析I"><a href="#511-游戏玩家分析I" class="headerlink" title="511.游戏玩家分析I"></a>511.游戏玩家分析I</h2><h3 id="描述-10"><a href="#描述-10" class="headerlink" title="描述"></a>描述</h3><p>找出每个玩家第一次登录的日期。Activity表如下：</p>
<table>
<thead>
<tr>
<th align="center">player_id</th>
<th align="center">device_id</th>
<th align="center">event_date</th>
<th align="center">games_played</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">2016<strong>-</strong>03<strong>-</strong>01</td>
<td align="center">5</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">2016-03-02</td>
<td align="center">6</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">3</td>
<td align="center"><strong>2017</strong>-<strong>06</strong>-25</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">1</td>
<td align="center">2016-03-02</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">4</td>
<td align="center">2018<strong>-</strong>07<strong>-</strong>03</td>
<td align="center">5</td>
</tr>
</tbody></table>
<p>结果Result表如下：</p>
<table>
<thead>
<tr>
<th align="center">player_id</th>
<th align="center">first_login</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">2016-03-01</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">2017<strong>-</strong>06<strong>-</strong>25</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">2016-03-02</td>
</tr>
</tbody></table>
<h3 id="数据准备-11"><a href="#数据准备-11" class="headerlink" title="数据准备"></a>数据准备</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> <span class="keyword">If</span> <span class="keyword">Not</span> <span class="keyword">Exists</span> activity(player_id <span class="built_in">int</span>,device_id <span class="built_in">int</span>,event_date <span class="built_in">date</span>,games_played <span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">Truncate</span> <span class="keyword">table</span> activity;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> activity <span class="keyword">values</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="string">'2016-03-01'</span>,<span class="number">5</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> activity <span class="keyword">values</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="string">'2016-03-02'</span>,<span class="number">6</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> activity <span class="keyword">values</span> (<span class="number">2</span>,<span class="number">3</span>,<span class="string">'2017-06-25'</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> activity <span class="keyword">values</span> (<span class="number">3</span>,<span class="number">1</span>,<span class="string">'2016-03-02'</span>,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> activity <span class="keyword">values</span> (<span class="number">3</span>,<span class="number">4</span>,<span class="string">'2018-07-03'</span>,<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<h3 id="SQL语句-11"><a href="#SQL语句-11" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> player_id,<span class="keyword">min</span>(event_date) first_login <span class="keyword">from</span> activity <span class="keyword">group</span> <span class="keyword">by</span> player_id ;</span><br></pre></td></tr></table></figure>

<h2 id="512-游戏玩家分析II"><a href="#512-游戏玩家分析II" class="headerlink" title="512.  游戏玩家分析II"></a>512.  游戏玩家分析II</h2><h3 id="描述-11"><a href="#描述-11" class="headerlink" title="描述"></a>描述</h3><p>显示每个玩家首次登录的设备号(同时显示玩家ID)。</p>
<h3 id="数据准备-12"><a href="#数据准备-12" class="headerlink" title="数据准备"></a>数据准备</h3><p>见511题</p>
<h3 id="SQL语句-12"><a href="#SQL语句-12" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	player_id,</span><br><span class="line">	device_id </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	activity </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	( player_id, event_date ) <span class="keyword">IN</span> ( <span class="keyword">SELECT</span> player_id, <span class="keyword">min</span>( event_date ) first_login <span class="keyword">FROM</span> activity <span class="keyword">GROUP</span> <span class="keyword">BY</span> player_id )</span><br></pre></td></tr></table></figure>

<h2 id="534-游戏玩家分析III"><a href="#534-游戏玩家分析III" class="headerlink" title="534 游戏玩家分析III"></a>534 游戏玩家分析III</h2><h3 id="描述-12"><a href="#描述-12" class="headerlink" title="描述"></a>描述</h3><p>编写一个 SQL 查询，同时显示每组玩家、日期以及玩家到目前为止玩了多少游戏。也就是说，在此日期之前玩家所玩的游戏总数。详细情况请查看示例。</p>
<p>结果为：</p>
<table>
<thead>
<tr>
<th align="center">player_id</th>
<th align="center">event_date</th>
<th align="center">games_played_so_far</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">2016-03-01</td>
<td align="center">5</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">2016-03-02</td>
<td align="center">11</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">2017-06-25</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">2016-03-02</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">2018-07-03</td>
<td align="center">5</td>
</tr>
</tbody></table>
<h3 id="数据准备-13"><a href="#数据准备-13" class="headerlink" title="数据准备"></a>数据准备</h3><p>见511题</p>
<h3 id="SQL语句-13"><a href="#SQL语句-13" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 方法一</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	B.player_id,</span><br><span class="line">	B.event_date,</span><br><span class="line">	<span class="keyword">SUM</span>( A.games_played ) <span class="keyword">AS</span> <span class="string">`games_played_so_far`</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	Activity <span class="keyword">AS</span> A</span><br><span class="line">	<span class="keyword">JOIN</span> Activity <span class="keyword">AS</span> B <span class="keyword">ON</span> ( A.player_id = B.player_id <span class="keyword">AND</span> A.event_date &lt;= B.event_date ) </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	B.player_id,</span><br><span class="line">	B.event_date</span><br><span class="line"><span class="comment">-- 方法二</span></span><br><span class="line"><span class="keyword">SELECT</span> C.player_id,C.event_date,C.games_played_so_far</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	A.player_id,</span><br><span class="line">	A.event_date,</span><br><span class="line">@sum_cnt:=</span><br><span class="line">		<span class="keyword">if</span>(A.player_id = @pre_id <span class="keyword">AND</span> A.event_date != @pre_date,</span><br><span class="line">			@sum_cnt + A.games_played,</span><br><span class="line">			A.games_played </span><br><span class="line">		)</span><br><span class="line">		<span class="keyword">AS</span> <span class="string">`games_played_so_far`</span>,</span><br><span class="line">@pre_id:=A.player_id <span class="keyword">AS</span> <span class="string">`player_ids`</span>,</span><br><span class="line">@pre_date:=A.event_date <span class="keyword">AS</span> <span class="string">`event_dates`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">activity <span class="keyword">AS</span> A,(<span class="keyword">SELECT</span> @pre_id:=<span class="literal">NULL</span>,@pre_date:=<span class="literal">NULL</span>,@sum_cnt:=<span class="number">0</span>) <span class="keyword">AS</span> B</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">BY</span> A.player_id,A.event_date</span><br><span class="line">) <span class="keyword">AS</span> C</span><br></pre></td></tr></table></figure>

<h2 id="550-游戏玩家分析IV"><a href="#550-游戏玩家分析IV" class="headerlink" title="550 游戏玩家分析IV"></a>550 游戏玩家分析IV</h2><h3 id="描述-13"><a href="#描述-13" class="headerlink" title="描述"></a>描述</h3><p>列出首次登录后，紧接着第二天又登录的人数占总人数的比例。比如511题中的数据，只有玩家1连续两天登录了，而总玩家有3个，所以连着两天登录的用户比例为：1/3 ~0.33</p>
<h3 id="数据准备-14"><a href="#数据准备-14" class="headerlink" title="数据准备"></a>数据准备</h3><p>见511题</p>
<h3 id="SQL语句-14"><a href="#SQL语句-14" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="keyword">ROUND</span>(</span><br><span class="line">	(</span><br><span class="line">	<span class="comment">-- 求第二天连续登陆的用户数</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="keyword">count</span>( <span class="keyword">DISTINCT</span> player_id ) <span class="keyword">AS</span> con_cnt </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	(</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	a.player_id,</span><br><span class="line">	<span class="keyword">DATEDIFF</span>( b.event_date, a.event_date ) <span class="keyword">AS</span> diff </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	activity a</span><br><span class="line">	<span class="keyword">JOIN</span> activity b <span class="keyword">ON</span> ( a.player_id = b.player_id <span class="keyword">AND</span> a.event_date &lt; b.event_date ) </span><br><span class="line">	) t1 </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	diff = <span class="number">1</span> </span><br><span class="line">	) / ( <span class="keyword">SELECT</span> <span class="keyword">count</span>( <span class="keyword">DISTINCT</span> player_id ) total_cnt <span class="keyword">FROM</span> activity ),<span class="comment">-- 总用户数</span></span><br><span class="line">	<span class="number">2</span> </span><br><span class="line">	) fraction</span><br></pre></td></tr></table></figure>

<h2 id="569-员工薪水中位数"><a href="#569-员工薪水中位数" class="headerlink" title="569 员工薪水中位数"></a>569 员工薪水中位数</h2><h3 id="描述-14"><a href="#描述-14" class="headerlink" title="描述"></a>描述</h3><p>有一张员工表Employees，字段为Id，Name，Salary，其中Id为员工Id，Name为公司名称，Salary为员工工资。如下面数据所示：</p>
<table>
<thead>
<tr>
<th align="center">Id</th>
<th align="center">Company</th>
<th align="center">Salary</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">A</td>
<td align="center">2341</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">A</td>
<td align="center">341</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">A</td>
<td align="center">15</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">A</td>
<td align="center">15314</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">A</td>
<td align="center">451</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">A</td>
<td align="center">513</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">B</td>
<td align="center">15</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">B</td>
<td align="center">13</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">B</td>
<td align="center">1154</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">B</td>
<td align="center">1345</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">B</td>
<td align="center">1221</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">B</td>
<td align="center">234</td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">C</td>
<td align="center">2345</td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">C</td>
<td align="center">2645</td>
</tr>
<tr>
<td align="center">15</td>
<td align="center">C</td>
<td align="center">2645</td>
</tr>
<tr>
<td align="center">16</td>
<td align="center">C</td>
<td align="center">2652</td>
</tr>
<tr>
<td align="center">17</td>
<td align="center">C</td>
<td align="center">65</td>
</tr>
</tbody></table>
<p>请编写SQL查询来查找每个公司的薪水中位数。结果如下：</p>
<table>
<thead>
<tr>
<th align="center">Id</th>
<th align="center">Company</th>
<th align="center">Salary</th>
</tr>
</thead>
<tbody><tr>
<td align="center">5</td>
<td align="center">A</td>
<td align="center">451</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">A</td>
<td align="center">513</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">B</td>
<td align="center">234</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">B</td>
<td align="center">1154</td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">C</td>
<td align="center">2645</td>
</tr>
</tbody></table>
<h3 id="数据准备-15"><a href="#数据准备-15" class="headerlink" title="数据准备"></a>数据准备</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span>  <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> employees;</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">table</span> employees(<span class="keyword">Id</span> <span class="built_in">int</span>,Company <span class="built_in">varchar</span>(<span class="number">2</span>),salary <span class="built_in">int</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">'A'</span>,<span class="number">2341</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">'A'</span>,<span class="number">341</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">'A'</span>,<span class="number">15</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">'A'</span>,<span class="number">15314</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">5</span>,<span class="string">'A'</span>,<span class="number">451</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">6</span>,<span class="string">'A'</span>,<span class="number">513</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">7</span>,<span class="string">'B'</span>,<span class="number">15</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">8</span>,<span class="string">'B'</span>,<span class="number">13</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">9</span>,<span class="string">'B'</span>,<span class="number">1154</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">10</span>,<span class="string">'B'</span>,<span class="number">1345</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">11</span>,<span class="string">'B'</span>,<span class="number">1221</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">12</span>,<span class="string">'B'</span>,<span class="number">234</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">13</span>,<span class="string">'C'</span>,<span class="number">2345</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">14</span>,<span class="string">'C'</span>,<span class="number">2645</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">15</span>,<span class="string">'C'</span>,<span class="number">2645</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">16</span>,<span class="string">'C'</span>,<span class="number">2652</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees <span class="keyword">values</span>(<span class="number">17</span>,<span class="string">'C'</span>,<span class="number">65</span>);</span><br></pre></td></tr></table></figure>

<h3 id="SQL语句-15"><a href="#SQL语句-15" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">     t1.id,</span><br><span class="line">     t1.company,</span><br><span class="line">     t1.salary</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line"></span><br><span class="line">(</span><br><span class="line"><span class="comment">-- 查询每个公司员工薪水排名</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">     <span class="keyword">id</span>,</span><br><span class="line">     company,</span><br><span class="line">     salary,</span><br><span class="line">     @<span class="keyword">num</span> := <span class="keyword">if</span>( @company =company  ,@<span class="keyword">num</span> + <span class="number">1</span>,<span class="number">1</span>) <span class="keyword">as</span> <span class="keyword">rank</span>,</span><br><span class="line">     @company := company</span><br><span class="line"><span class="keyword">from</span> employees a ,(<span class="keyword">select</span> @<span class="keyword">num</span> := <span class="number">0</span>,@company:=<span class="string">""</span>) b</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> company,salary) t1 </span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">(</span><br><span class="line"><span class="comment">-- 查询每个公司有多少个员工</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">     company,</span><br><span class="line">     <span class="keyword">count</span>(*) <span class="keyword">as</span> cnt</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">    employees</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> company</span><br><span class="line"></span><br><span class="line">) t2 <span class="keyword">on</span> t1.company= t2.company <span class="keyword">and</span> t1.rank = (t2.cnt + <span class="number">1</span>) <span class="keyword">div</span> <span class="number">2</span> <span class="comment">-- （员工总数+1）/2 为中位数</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>公众号『大数据技术与数仓』，回复『资料』领取大数据资料包</p>
</blockquote>
</div><div class="recommended_posts"><h3>相关推荐 ☟</h3><li><a href="https://jiamaoxiang.top/2020/03/05/基于Canal与Flink实现数据实时增量同步-一/" target="_blank">基于Canal与Flink实现数据实时增量同步(一)</a></li><li><a href="https://jiamaoxiang.top/2019/12/10/SQL中的相关子查询解析/" target="_blank">SQL中的相关子查询解析</a></li><li><a href="https://jiamaoxiang.top/2019/12/05/电商业务常用指标分析之SQL实现/" target="_blank">电商业务常用指标分析之SQL实现</a></li><li><a href="https://jiamaoxiang.top/2019/12/03/CDH集群之YARN性能调优/" target="_blank">CDH集群之YARN性能调优</a></li></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Jia MaoXiang</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2019/12/09/LeeCode数据库部分题目汇总/">https://jiamaoxiang.top/2019/12/09/LeeCode数据库部分题目汇总/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本文为博主原创文章，遵循CC BY-SA 4.0版权协议，转载请附上原文出处链接和本声明</li></ul></div><br><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="https://jiamaoxiang.top/2019/12/09/LeeCode数据库部分题目汇总/" data-id="ckjjuyrmq006vms7q4oe4rsvh" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACw0lEQVR42u3aQXLCMAwFUO5/aTrTVTs05kuyUxYvKwaoyfMiVr/0eMTX8/v6+Xr9zuv7r5/mv/X6evOFh4eH17r1q2t9o2vAes31xlW/ebmJeHh4eMd4vQd0chPJY/1q45KV31jw8PDw/pW3Lo57nyYFd4LHw8PD+2Resui6BO9tCh4eHt6n8ZIwohox5PFENcg4krXg4eHhxbxdTak7Xx/v7+Hh4eG1uurV9tWuIntyb7/Wx8PDwzvA6zXve5HuvKG1LqyjrAUPDw9vzKve6CRiGEWx8RESZcB4eHh4A16+RLUlNj9IqqV5FFjg4eHhjXnzACJvTU1I+eY2sxY8PDy8mJfHB9Vyee8h0dtoPDw8vBO8SYurF2dUH/1Jef0mn8bDw8PbyusFtdXH9yh4LbboCpEEHh4eXos3HxToPeLzUKPXHsPDw8O7h7e+rSSMOFGCV4+oyxMPDw8PbxNvErbmMUGyft5Ia85E4OHh4W3i9W4rP0KqEW1vcOFNAwwPDw/vAG8yGpW3qXYdA/mIAx4eHt4J3qQxn4cC843oHWN4eHh453i9gYA8up1EvfkAweX6eHh4eFt5k+ghL3bnray8oMfDw8O7h1f95z/fiHzEqnpIRN/Ew8PDO8yrFsF5CDspoyfDB3h4eHj38JLmfX489EYBekX2ZcqCh4eHt5WXRK7Vx3q5qV+MaJPRKzw8PLxzvPnQVRVcbfz3DhI8PDy8c7z8moSzeXk9ucX8HwA8PDy8Ce9ZvHrVer7CZLAADw8P7x7e5GDIh66qBXd1K3vRMx4eHt6EVx292tXQmg8NNBMXPDw8vE28XtDQixLyoLYaQ/zxt3h4eHgfxstL7V7Z3RtB2HYw4OHh4Y15+fM2L7Xz8r33u3h4eHjnePlPTors6pjXvG2Gh4eHd4JXbYDljahevNsbz9o2OoCHh4e3WvML+i/aT+oIFRgAAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/LeeCode/">LeeCode</a></div><div class="post-nav"><a class="pre" href="/2019/12/10/SQL中的相关子查询解析/">SQL中的相关子查询解析</a><a class="next" href="/2019/12/05/电商业务常用指标分析之SQL实现/">电商业务常用指标分析之SQL实现</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar-toc"><div class="stoc-article" id="sidebar-stoc"><strong class="stoc-title"><i class="fa fa-list-ul"> 目录</i></strong><div class="toc-nav" id="stoc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#176-第二高的薪水"><span class="toc-number">1.</span> <span class="toc-text">176. 第二高的薪水</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#描述"><span class="toc-number">1.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据准备"><span class="toc-number">1.2.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句"><span class="toc-number">1.3.</span> <span class="toc-text">SQL语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#178-分数排名"><span class="toc-number">2.</span> <span class="toc-text">178.分数排名</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#描述-1"><span class="toc-number">2.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据准备-1"><span class="toc-number">2.2.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句-1"><span class="toc-number">2.3.</span> <span class="toc-text">SQL语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#180-连续出现的数字"><span class="toc-number">3.</span> <span class="toc-text">180. 连续出现的数字</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#描述-2"><span class="toc-number">3.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据准备-2"><span class="toc-number">3.2.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句-2"><span class="toc-number">3.3.</span> <span class="toc-text">SQL语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#181-超过经理收入的员工"><span class="toc-number">4.</span> <span class="toc-text">181. 超过经理收入的员工</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#描述-3"><span class="toc-number">4.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据准备-3"><span class="toc-number">4.2.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句-3"><span class="toc-number">4.3.</span> <span class="toc-text">SQL语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#182-查找重复的电子邮箱"><span class="toc-number">5.</span> <span class="toc-text">182. 查找重复的电子邮箱</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#描述-4"><span class="toc-number">5.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据准备-4"><span class="toc-number">5.2.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句-4"><span class="toc-number">5.3.</span> <span class="toc-text">SQL语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#183-从不订购的客户"><span class="toc-number">6.</span> <span class="toc-text">183. 从不订购的客户</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#描述-5"><span class="toc-number">6.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据准备-5"><span class="toc-number">6.2.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句-5"><span class="toc-number">6.3.</span> <span class="toc-text">SQL语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#184-部门工资最高的员工"><span class="toc-number">7.</span> <span class="toc-text">184. 部门工资最高的员工</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#描述-6"><span class="toc-number">7.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据准备-6"><span class="toc-number">7.2.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句-6"><span class="toc-number">7.3.</span> <span class="toc-text">SQL语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#185-部门工资前三高的所有员工"><span class="toc-number">8.</span> <span class="toc-text">185.部门工资前三高的所有员工</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#描述-7"><span class="toc-number">8.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据准备-7"><span class="toc-number">8.2.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句-7"><span class="toc-number">8.3.</span> <span class="toc-text">SQL语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#196-删除重复的邮箱"><span class="toc-number">9.</span> <span class="toc-text">196.删除重复的邮箱</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#描述-8"><span class="toc-number">9.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据准备-8"><span class="toc-number">9.2.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句-8"><span class="toc-number">9.3.</span> <span class="toc-text">SQL语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#197-上升的温度"><span class="toc-number">10.</span> <span class="toc-text">197.上升的温度</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#描述-9"><span class="toc-number">10.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据准备-9"><span class="toc-number">10.2.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句-9"><span class="toc-number">10.3.</span> <span class="toc-text">SQL语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#262-行程与用户"><span class="toc-number">11.</span> <span class="toc-text">262.行程与用户</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目描述"><span class="toc-number">11.1.</span> <span class="toc-text">题目描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据准备-10"><span class="toc-number">11.2.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句-10"><span class="toc-number">11.3.</span> <span class="toc-text">SQL语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#511-游戏玩家分析I"><span class="toc-number">12.</span> <span class="toc-text">511.游戏玩家分析I</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#描述-10"><span class="toc-number">12.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据准备-11"><span class="toc-number">12.2.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句-11"><span class="toc-number">12.3.</span> <span class="toc-text">SQL语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#512-游戏玩家分析II"><span class="toc-number">13.</span> <span class="toc-text">512.  游戏玩家分析II</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#描述-11"><span class="toc-number">13.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据准备-12"><span class="toc-number">13.2.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句-12"><span class="toc-number">13.3.</span> <span class="toc-text">SQL语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#534-游戏玩家分析III"><span class="toc-number">14.</span> <span class="toc-text">534 游戏玩家分析III</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#描述-12"><span class="toc-number">14.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据准备-13"><span class="toc-number">14.2.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句-13"><span class="toc-number">14.3.</span> <span class="toc-text">SQL语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#550-游戏玩家分析IV"><span class="toc-number">15.</span> <span class="toc-text">550 游戏玩家分析IV</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#描述-13"><span class="toc-number">15.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据准备-14"><span class="toc-number">15.2.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句-14"><span class="toc-number">15.3.</span> <span class="toc-text">SQL语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#569-员工薪水中位数"><span class="toc-number">16.</span> <span class="toc-text">569 员工薪水中位数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#描述-14"><span class="toc-number">16.1.</span> <span class="toc-text">描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据准备-15"><span class="toc-number">16.2.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL语句-15"><span class="toc-number">16.3.</span> <span class="toc-text">SQL语句</span></a></li></ol></li></ol></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 - 2021 <a href="/." rel="nofollow">Jmx's Blog.</a>All rights reserved.<br>Thoughts on technology, life and everything else.</div></div></div><script type="text/javascript" src="/js/toc.js?v=0.0.0"></script><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="100,99,98" opacity="0.5" zindex="0.7" count="150" src="//lib.baomitu.com/canvas-nest.js/2.0.4/canvas-nest.umd.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>