<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="记录朴实无华且枯燥的生活"><title>经典Hive-SQL面试题 | Jmx's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '912b6cfc43243cd27aeb428f7dbf7823';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script><script type="text/javascript" src="/js/toc.js?v=0.0.0"></script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">经典Hive-SQL面试题</h1><a id="logo" href="/.">Jmx's Blog</a><p class="description">Keep it Simple and Stupid!</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-pied-piper-alt"> 关于</i></a><a href="/tags"><i class="fa fa-tags"> 标签</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">经典Hive-SQL面试题</h1><div class="post-meta">Oct 15, 2019<span> | </span><span class="category"><a href="/categories/Hive/">Hive</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 4.1k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 21</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="post-content"><p>HQL练习</p>
<a id="more"></a>

<h2 id="第一题"><a href="#第一题" class="headerlink" title="第一题"></a>第一题</h2><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">我们有如下的用户访问数据</span><br><span class="line">	userId  visitDate   visitCount</span><br><span class="line">	u01 2017/1/21   5</span><br><span class="line">	u02 2017/1/23   6</span><br><span class="line">	u03 2017/1/22   8</span><br><span class="line">	u04 2017/1/20   3</span><br><span class="line">	u01 2017/1/23   6</span><br><span class="line">	u01 2017/2/21   8</span><br><span class="line">	U02 2017/1/23   6</span><br><span class="line">	U01 2017/2/22   4</span><br><span class="line">要求使用SQL统计出每个用户的累积访问次数，如下表所示：</span><br><span class="line">	用户id    月份  小计  累积</span><br><span class="line">	u01 2017-01 11  11</span><br><span class="line">	u01 2017-02 12  23</span><br><span class="line">	u02 2017-01 12  12</span><br><span class="line">	u03 2017-01 8   8</span><br><span class="line">	u04 2017-01 3   3</span><br></pre></td></tr></table></figure>

<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><h4 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CREATE TABLE test_sql.test1 ( </span><br><span class="line">		userId string, </span><br><span class="line">		visitDate string,</span><br><span class="line">		visitCount INT )</span><br><span class="line">	ROW format delimited FIELDS TERMINATED BY <span class="string">"\t"</span>;</span><br><span class="line">	INSERT INTO TABLE test_sql.test1</span><br><span class="line">	VALUES</span><br><span class="line">		( <span class="string">'u01'</span>, <span class="string">'2017/1/21'</span>, 5 ),</span><br><span class="line">		( <span class="string">'u02'</span>, <span class="string">'2017/1/23'</span>, 6 ),</span><br><span class="line">		( <span class="string">'u03'</span>, <span class="string">'2017/1/22'</span>, 8 ),</span><br><span class="line">		( <span class="string">'u04'</span>, <span class="string">'2017/1/20'</span>, 3 ),</span><br><span class="line">		( <span class="string">'u01'</span>, <span class="string">'2017/1/23'</span>, 6 ),</span><br><span class="line">		( <span class="string">'u01'</span>, <span class="string">'2017/2/21'</span>, 8 ),</span><br><span class="line">		( <span class="string">'u02'</span>, <span class="string">'2017/1/23'</span>, 6 ),</span><br><span class="line">		( <span class="string">'u01'</span>, <span class="string">'2017/2/22'</span>, 4 );</span><br></pre></td></tr></table></figure>

<h4 id="查询SQL"><a href="#查询SQL" class="headerlink" title="查询SQL"></a>查询SQL</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SELECT t2.userid,</span><br><span class="line">	   t2.visitmonth,</span><br><span class="line">	   subtotal_visit_cnt,</span><br><span class="line">	   sum(subtotal_visit_cnt) over (partition BY userid</span><br><span class="line">									 ORDER BY visitmonth) AS total_visit_cnt</span><br><span class="line">FROM</span><br><span class="line">  (SELECT userid,</span><br><span class="line">		  visitmonth,</span><br><span class="line">		  sum(visitcount) AS subtotal_visit_cnt</span><br><span class="line">   FROM</span><br><span class="line">	 (SELECT userid,</span><br><span class="line">			 date_format(regexp_replace(visitdate,<span class="string">'/'</span>,<span class="string">'-'</span>),<span class="string">'yyyy-MM'</span>) AS visitmonth,</span><br><span class="line">			 visitcount</span><br><span class="line">	  FROM test_sql.test1) t1</span><br><span class="line">   GROUP BY userid,</span><br><span class="line">			visitmonth)t2</span><br><span class="line">ORDER BY t2.userid,</span><br><span class="line">		 t2.visitmonth</span><br></pre></td></tr></table></figure>

<h2 id="第二题"><a href="#第二题" class="headerlink" title="第二题"></a>第二题</h2><h3 id="需求-1"><a href="#需求-1" class="headerlink" title="需求"></a>需求</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">有50W个京东店铺，每个顾客访客访问任何一个店铺的任何一个商品时都会产生一条访问日志，</span><br><span class="line">访问日志存储的表名为Visit，访客的用户id为user_id，被访问的店铺名称为shop，数据如下：</span><br><span class="line"></span><br><span class="line">				u1	a</span><br><span class="line">				u2	b</span><br><span class="line">				u1	b</span><br><span class="line">				u1	a</span><br><span class="line">				u3	c</span><br><span class="line">				u4	b</span><br><span class="line">				u1	a</span><br><span class="line">				u2	c</span><br><span class="line">				u5	b</span><br><span class="line">				u4	b</span><br><span class="line">				u6	c</span><br><span class="line">				u2	c</span><br><span class="line">				u1	b</span><br><span class="line">				u2	a</span><br><span class="line">				u2	a</span><br><span class="line">				u3	a</span><br><span class="line">				u5	a</span><br><span class="line">				u5	a</span><br><span class="line">				u5	a</span><br><span class="line">请统计：</span><br><span class="line">(1)每个店铺的UV（访客数）</span><br><span class="line">(2)每个店铺访问次数top3的访客信息。输出店铺名称、访客id、访问次数</span><br></pre></td></tr></table></figure>

<h3 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h3><h4 id="数据准备-1"><a href="#数据准备-1" class="headerlink" title="数据准备"></a>数据准备</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CREATE TABLE test_sql.test2 ( </span><br><span class="line">						 user_id string, </span><br><span class="line">						 shop string )</span><br><span class="line">			ROW format delimited FIELDS TERMINATED BY <span class="string">'\t'</span>;	</span><br><span class="line">			INSERT INTO TABLE test_sql.test2 VALUES</span><br><span class="line">			( <span class="string">'u1'</span>, <span class="string">'a'</span> ),</span><br><span class="line">			( <span class="string">'u2'</span>, <span class="string">'b'</span> ),</span><br><span class="line">			( <span class="string">'u1'</span>, <span class="string">'b'</span> ),</span><br><span class="line">			( <span class="string">'u1'</span>, <span class="string">'a'</span> ),</span><br><span class="line">			( <span class="string">'u3'</span>, <span class="string">'c'</span> ),</span><br><span class="line">			( <span class="string">'u4'</span>, <span class="string">'b'</span> ),</span><br><span class="line">			( <span class="string">'u1'</span>, <span class="string">'a'</span> ),</span><br><span class="line">			( <span class="string">'u2'</span>, <span class="string">'c'</span> ),</span><br><span class="line">			( <span class="string">'u5'</span>, <span class="string">'b'</span> ),</span><br><span class="line">			( <span class="string">'u4'</span>, <span class="string">'b'</span> ),</span><br><span class="line">			( <span class="string">'u6'</span>, <span class="string">'c'</span> ),</span><br><span class="line">			( <span class="string">'u2'</span>, <span class="string">'c'</span> ),</span><br><span class="line">			( <span class="string">'u1'</span>, <span class="string">'b'</span> ),</span><br><span class="line">			( <span class="string">'u2'</span>, <span class="string">'a'</span> ),</span><br><span class="line">			( <span class="string">'u2'</span>, <span class="string">'a'</span> ),</span><br><span class="line">			( <span class="string">'u3'</span>, <span class="string">'a'</span> ),</span><br><span class="line">			( <span class="string">'u5'</span>, <span class="string">'a'</span> ),</span><br><span class="line">			( <span class="string">'u5'</span>, <span class="string">'a'</span> ),</span><br><span class="line">			( <span class="string">'u5'</span>, <span class="string">'a'</span> );</span><br></pre></td></tr></table></figure>

<h4 id="查询SQL实现"><a href="#查询SQL实现" class="headerlink" title="查询SQL实现"></a>查询SQL实现</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(1)方式1：</span><br><span class="line">		SELECT shop,</span><br><span class="line">			   count(DISTINCT user_id)</span><br><span class="line">		FROM test_sql.test2</span><br><span class="line">		GROUP BY shop</span><br><span class="line">方式2：</span><br><span class="line">		SELECT t.shop,</span><br><span class="line">			   count(*)</span><br><span class="line">		FROM</span><br><span class="line">		  (SELECT user_id,</span><br><span class="line">				  shop</span><br><span class="line">		   FROM test_sql.test2</span><br><span class="line">		   GROUP BY user_id,</span><br><span class="line">					shop) t</span><br><span class="line">		GROUP BY t.shop</span><br><span class="line">(2)	</span><br><span class="line">SELECT t2.shop,</span><br><span class="line">	   t2.user_id,</span><br><span class="line">	   t2.cnt</span><br><span class="line">FROM</span><br><span class="line">  (SELECT t1.*,</span><br><span class="line">		  row_number() over(partition BY t1.shop</span><br><span class="line">							ORDER BY t1.cnt DESC) rank</span><br><span class="line">   FROM</span><br><span class="line">	 (SELECT user_id,</span><br><span class="line">			 shop,</span><br><span class="line">			 count(*) AS cnt</span><br><span class="line">	  FROM test_sql.test2</span><br><span class="line">	  GROUP BY user_id,</span><br><span class="line">			   shop) t1)t2</span><br><span class="line">WHERE rank &lt;= 3</span><br></pre></td></tr></table></figure>

<h2 id="第三题"><a href="#第三题" class="headerlink" title="第三题"></a>第三题</h2><h3 id="需求-2"><a href="#需求-2" class="headerlink" title="需求"></a>需求</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">已知一个表STG.ORDER，有如下字段:Date，Order_id，User_id，amount。</span><br><span class="line">数据样例:2017-01-01,10029028,1000003251,33.57。</span><br><span class="line">请给出sql进行统计:</span><br><span class="line">(1)给出 2017年每个月的订单数、用户数、总成交金额。</span><br><span class="line">(2)给出2017年11月的新客数(指在11月才有第一笔订单)</span><br></pre></td></tr></table></figure>

<h3 id="实现-2"><a href="#实现-2" class="headerlink" title="实现"></a>实现</h3><h4 id="数据准备-2"><a href="#数据准备-2" class="headerlink" title="数据准备"></a>数据准备</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CREATE TABLE test_sql.test3 ( </span><br><span class="line">			dt string,</span><br><span class="line">			order_id string, </span><br><span class="line">			user_id string, </span><br><span class="line">			amount DECIMAL ( 10, 2 ) )</span><br><span class="line">ROW format delimited FIELDS TERMINATED BY <span class="string">'\t'</span>;</span><br><span class="line">INSERT INTO TABLE test_sql.test3 VALUES (<span class="string">'2017-01-01'</span>,<span class="string">'10029028'</span>,<span class="string">'1000003251'</span>,33.57);</span><br><span class="line">INSERT INTO TABLE test_sql.test3 VALUES (<span class="string">'2017-01-01'</span>,<span class="string">'10029029'</span>,<span class="string">'1000003251'</span>,33.57);</span><br><span class="line">INSERT INTO TABLE test_sql.test3 VALUES (<span class="string">'2017-01-01'</span>,<span class="string">'100290288'</span>,<span class="string">'1000003252'</span>,33.57);</span><br><span class="line">INSERT INTO TABLE test_sql.test3 VALUES (<span class="string">'2017-02-02'</span>,<span class="string">'10029088'</span>,<span class="string">'1000003251'</span>,33.57);</span><br><span class="line">INSERT INTO TABLE test_sql.test3 VALUES (<span class="string">'2017-02-02'</span>,<span class="string">'100290281'</span>,<span class="string">'1000003251'</span>,33.57);</span><br><span class="line">INSERT INTO TABLE test_sql.test3 VALUES (<span class="string">'2017-02-02'</span>,<span class="string">'100290282'</span>,<span class="string">'1000003253'</span>,33.57);</span><br><span class="line">INSERT INTO TABLE test_sql.test3 VALUES (<span class="string">'2017-11-02'</span>,<span class="string">'10290282'</span>,<span class="string">'100003253'</span>,234);</span><br><span class="line">INSERT INTO TABLE test_sql.test3 VALUES (<span class="string">'2018-11-02'</span>,<span class="string">'10290284'</span>,<span class="string">'100003243'</span>,234);</span><br></pre></td></tr></table></figure>

<h4 id="查询SQL-1"><a href="#查询SQL-1" class="headerlink" title="查询SQL"></a>查询SQL</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(1)</span><br><span class="line">SELECT t1.mon,</span><br><span class="line">	   count(t1.order_id) AS order_cnt,</span><br><span class="line">	   count(DISTINCT t1.user_id) AS user_cnt,</span><br><span class="line">	   sum(amount) AS total_amount</span><br><span class="line">FROM</span><br><span class="line">  (SELECT order_id,</span><br><span class="line">		  user_id,</span><br><span class="line">		  amount,</span><br><span class="line">		  date_format(dt,<span class="string">'yyyy-MM'</span>) mon</span><br><span class="line">   FROM test_sql.test3</span><br><span class="line">   WHERE date_format(dt,<span class="string">'yyyy'</span>) = <span class="string">'2017'</span>) t1</span><br><span class="line">GROUP BY t1.mon</span><br><span class="line">(2)</span><br><span class="line">SELECT count(user_id)</span><br><span class="line">FROM test_sql.test3</span><br><span class="line">GROUP BY user_id</span><br><span class="line">HAVING date_format(min(dt),<span class="string">'yyyy-MM'</span>)=<span class="string">'2017-11'</span>;</span><br></pre></td></tr></table></figure>

<h2 id="第四题"><a href="#第四题" class="headerlink" title="第四题"></a>第四题</h2><h3 id="需求-3"><a href="#需求-3" class="headerlink" title="需求"></a>需求</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">有一个5000万的用户文件(user_id，name，age)，一个2亿记录的用户看电影的记录文件(user_id，url)，根据年龄段观看电影的次数进行排序？</span><br></pre></td></tr></table></figure>

<h3 id="实现-3"><a href="#实现-3" class="headerlink" title="实现"></a>实现</h3><h4 id="数据准备-3"><a href="#数据准备-3" class="headerlink" title="数据准备"></a>数据准备</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CREATE TABLE test_sql.test4user</span><br><span class="line">		   (user_id string,</span><br><span class="line">			name string,</span><br><span class="line">			age int);</span><br><span class="line"></span><br><span class="line">CREATE TABLE test_sql.test4log</span><br><span class="line">						(user_id string,</span><br><span class="line">						url string);</span><br><span class="line">						</span><br><span class="line">INSERT INTO TABLE test_sql.test4user VALUES(<span class="string">'001'</span>,<span class="string">'u1'</span>,10);</span><br><span class="line">INSERT INTO TABLE test_sql.test4user VALUES(<span class="string">'002'</span>,<span class="string">'u2'</span>,15);   </span><br><span class="line">INSERT INTO TABLE test_sql.test4user VALUES(<span class="string">'003'</span>,<span class="string">'u3'</span>,15);   </span><br><span class="line">INSERT INTO TABLE test_sql.test4user VALUES(<span class="string">'004'</span>,<span class="string">'u4'</span>,20);   </span><br><span class="line">INSERT INTO TABLE test_sql.test4user VALUES(<span class="string">'005'</span>,<span class="string">'u5'</span>,25);   </span><br><span class="line">INSERT INTO TABLE test_sql.test4user VALUES(<span class="string">'006'</span>,<span class="string">'u6'</span>,35);   </span><br><span class="line">INSERT INTO TABLE test_sql.test4user VALUES(<span class="string">'007'</span>,<span class="string">'u7'</span>,40);</span><br><span class="line">INSERT INTO TABLE test_sql.test4user VALUES(<span class="string">'008'</span>,<span class="string">'u8'</span>,45);  </span><br><span class="line">INSERT INTO TABLE test_sql.test4user VALUES(<span class="string">'009'</span>,<span class="string">'u9'</span>,50);  </span><br><span class="line">INSERT INTO TABLE test_sql.test4user VALUES(<span class="string">'0010'</span>,<span class="string">'u10'</span>,65);  </span><br><span class="line">INSERT INTO TABLE test_sql.test4log VALUES(<span class="string">'001'</span>,<span class="string">'url1'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test4log VALUES(<span class="string">'002'</span>,<span class="string">'url1'</span>);   </span><br><span class="line">INSERT INTO TABLE test_sql.test4log VALUES(<span class="string">'003'</span>,<span class="string">'url2'</span>);   </span><br><span class="line">INSERT INTO TABLE test_sql.test4log VALUES(<span class="string">'004'</span>,<span class="string">'url3'</span>);   </span><br><span class="line">INSERT INTO TABLE test_sql.test4log VALUES(<span class="string">'005'</span>,<span class="string">'url3'</span>);   </span><br><span class="line">INSERT INTO TABLE test_sql.test4log VALUES(<span class="string">'006'</span>,<span class="string">'url1'</span>);   </span><br><span class="line">INSERT INTO TABLE test_sql.test4log VALUES(<span class="string">'007'</span>,<span class="string">'url5'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test4log VALUES(<span class="string">'008'</span>,<span class="string">'url7'</span>);  </span><br><span class="line">INSERT INTO TABLE test_sql.test4log VALUES(<span class="string">'009'</span>,<span class="string">'url5'</span>);  </span><br><span class="line">INSERT INTO TABLE test_sql.test4log VALUES(<span class="string">'0010'</span>,<span class="string">'url1'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="查询SQL-2"><a href="#查询SQL-2" class="headerlink" title="查询SQL"></a>查询SQL</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SELECT </span><br><span class="line">t2.age_phase,</span><br><span class="line">sum(t1.cnt) as view_cnt</span><br><span class="line">FROM</span><br><span class="line"></span><br><span class="line">(SELECT user_id,</span><br><span class="line">  count(*) cnt</span><br><span class="line">FROM test_sql.test4log</span><br><span class="line">GROUP BY user_id) t1</span><br><span class="line">JOIN</span><br><span class="line">(SELECT user_id,</span><br><span class="line">  CASE WHEN age &lt;= 10 AND age &gt; 0 THEN <span class="string">'0-10'</span> </span><br><span class="line">  WHEN age &lt;= 20 AND age &gt; 10 THEN <span class="string">'10-20'</span></span><br><span class="line">  WHEN age &gt;20 AND age &lt;=30 THEN <span class="string">'20-30'</span></span><br><span class="line">  WHEN age &gt;30 AND age &lt;=40 THEN <span class="string">'30-40'</span></span><br><span class="line">  WHEN age &gt;40 AND age &lt;=50 THEN <span class="string">'40-50'</span></span><br><span class="line">  WHEN age &gt;50 AND age &lt;=60 THEN <span class="string">'50-60'</span></span><br><span class="line">  WHEN age &gt;60 AND age &lt;=70 THEN <span class="string">'60-70'</span></span><br><span class="line">  ELSE <span class="string">'70以上'</span> END as age_phase</span><br><span class="line">FROM test_sql.test4user) t2 ON t1.user_id = t2.user_id </span><br><span class="line">GROUP BY t2.age_phase</span><br></pre></td></tr></table></figure>

<h2 id="第五题"><a href="#第五题" class="headerlink" title="第五题"></a>第五题</h2><h3 id="需求-4"><a href="#需求-4" class="headerlink" title="需求"></a>需求</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">有日志如下，请写出代码求得所有用户和活跃用户的总数及平均年龄。（活跃用户指连续两天都有访问记录的用户）</span><br><span class="line">日期 用户 年龄</span><br><span class="line">2019-02-11,test_1,23</span><br><span class="line">2019-02-11,test_2,19</span><br><span class="line">2019-02-11,test_3,39</span><br><span class="line">2019-02-11,test_1,23</span><br><span class="line">2019-02-11,test_3,39</span><br><span class="line">2019-02-11,test_1,23</span><br><span class="line">2019-02-12,test_2,19</span><br><span class="line">2019-02-13,test_1,23</span><br><span class="line">2019-02-15,test_2,19</span><br><span class="line">2019-02-16,test_2,19</span><br></pre></td></tr></table></figure>

<h3 id="实现-4"><a href="#实现-4" class="headerlink" title="实现"></a>实现</h3><h4 id="数据准备-4"><a href="#数据准备-4" class="headerlink" title="数据准备"></a>数据准备</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CREATE TABLE test5(</span><br><span class="line">dt string,</span><br><span class="line">user_id string,</span><br><span class="line">age int)</span><br><span class="line">ROW format delimited fields terminated BY <span class="string">','</span>;</span><br><span class="line">INSERT INTO TABLE test_sql.test5 VALUES (<span class="string">'2019-02-11'</span>,<span class="string">'test_1'</span>,23);</span><br><span class="line">INSERT INTO TABLE test_sql.test5 VALUES (<span class="string">'2019-02-11'</span>,<span class="string">'test_2'</span>,19);</span><br><span class="line">INSERT INTO TABLE test_sql.test5 VALUES (<span class="string">'2019-02-11'</span>,<span class="string">'test_3'</span>,39);</span><br><span class="line">INSERT INTO TABLE test_sql.test5 VALUES (<span class="string">'2019-02-11'</span>,<span class="string">'test_1'</span>,23);</span><br><span class="line">INSERT INTO TABLE test_sql.test5 VALUES (<span class="string">'2019-02-11'</span>,<span class="string">'test_3'</span>,39);</span><br><span class="line">INSERT INTO TABLE test_sql.test5 VALUES (<span class="string">'2019-02-11'</span>,<span class="string">'test_1'</span>,23);</span><br><span class="line">INSERT INTO TABLE test_sql.test5 VALUES (<span class="string">'2019-02-12'</span>,<span class="string">'test_2'</span>,19);</span><br><span class="line">INSERT INTO TABLE test_sql.test5 VALUES (<span class="string">'2019-02-13'</span>,<span class="string">'test_1'</span>,23);</span><br><span class="line">INSERT INTO TABLE test_sql.test5 VALUES (<span class="string">'2019-02-15'</span>,<span class="string">'test_2'</span>,19);                                        </span><br><span class="line">INSERT INTO TABLE test_sql.test5 VALUES (<span class="string">'2019-02-16'</span>,<span class="string">'test_2'</span>,19);</span><br></pre></td></tr></table></figure>

<h4 id="查询SQL-3"><a href="#查询SQL-3" class="headerlink" title="查询SQL"></a>查询SQL</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SELECT sum(total_user_cnt) total_user_cnt,</span><br><span class="line">	   sum(total_user_avg_age) total_user_avg_age,</span><br><span class="line">	   sum(two_days_cnt) two_days_cnt,</span><br><span class="line">	   sum(avg_age) avg_age</span><br><span class="line">FROM</span><br><span class="line">  (SELECT 0 total_user_cnt,</span><br><span class="line">		  0 total_user_avg_age,</span><br><span class="line">		  count(*) AS two_days_cnt,</span><br><span class="line">		  cast(sum(age) / count(*) AS decimal(5,2)) AS avg_age</span><br><span class="line">   FROM</span><br><span class="line">	 (SELECT user_id,</span><br><span class="line">			 max(age) age</span><br><span class="line">	  FROM</span><br><span class="line">		(SELECT user_id,</span><br><span class="line">				max(age) age</span><br><span class="line">		 FROM</span><br><span class="line">		   (SELECT user_id,</span><br><span class="line">				   age,</span><br><span class="line">				   date_sub(dt,rank) flag</span><br><span class="line">			FROM</span><br><span class="line">			  (SELECT dt,</span><br><span class="line">					  user_id,</span><br><span class="line">					  max(age) age,</span><br><span class="line">					  row_number() over(PARTITION BY user_id</span><br><span class="line">										ORDER BY dt) rank</span><br><span class="line">			   FROM test_sql.test5</span><br><span class="line">			   GROUP BY dt,</span><br><span class="line">						user_id) t1) t2</span><br><span class="line">		 GROUP BY user_id,</span><br><span class="line">				  flag</span><br><span class="line">		 HAVING count(*) &gt;=2) t3</span><br><span class="line">	  GROUP BY user_id) t4</span><br><span class="line">   UNION ALL SELECT count(*) total_user_cnt,</span><br><span class="line">					cast(sum(age) /count(*) AS decimal(5,2)) total_user_avg_age,</span><br><span class="line">					0 two_days_cnt,</span><br><span class="line">					0 avg_age</span><br><span class="line">   FROM</span><br><span class="line">	 (SELECT user_id,</span><br><span class="line">			 max(age) age</span><br><span class="line">	  FROM test_sql.test5</span><br><span class="line">	  GROUP BY user_id) t5) t6</span><br></pre></td></tr></table></figure>

<h2 id="第六题"><a href="#第六题" class="headerlink" title="第六题"></a>第六题</h2><h3 id="需求-5"><a href="#需求-5" class="headerlink" title="需求"></a>需求</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">请用sql写出所有用户中在今年10月份第一次购买商品的金额，</span><br><span class="line">表ordertable字段:</span><br><span class="line">(购买用户：userid，金额：money，购买时间：paymenttime(格式：2017-10-01)，订单id：orderid</span><br></pre></td></tr></table></figure>

<h3 id="实现-5"><a href="#实现-5" class="headerlink" title="实现"></a>实现</h3><h4 id="数据准备-5"><a href="#数据准备-5" class="headerlink" title="数据准备"></a>数据准备</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CREATE TABLE test_sql.test6 (</span><br><span class="line">		userid string,</span><br><span class="line">		money decimal(10,2),</span><br><span class="line">		paymenttime string,</span><br><span class="line">		orderid string);</span><br><span class="line"></span><br><span class="line">INSERT INTO TABLE test_sql.test6 VALUES(<span class="string">'001'</span>,100,<span class="string">'2017-10-01'</span>,<span class="string">'123'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test6 VALUES(<span class="string">'001'</span>,200,<span class="string">'2017-10-02'</span>,<span class="string">'124'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test6 VALUES(<span class="string">'002'</span>,500,<span class="string">'2017-10-01'</span>,<span class="string">'125'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test6 VALUES(<span class="string">'001'</span>,100,<span class="string">'2017-11-01'</span>,<span class="string">'126'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="查询SQL-4"><a href="#查询SQL-4" class="headerlink" title="查询SQL"></a>查询SQL</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SELECT</span><br><span class="line">userid,</span><br><span class="line">paymenttime,</span><br><span class="line">money,</span><br><span class="line">orderid</span><br><span class="line">from</span><br><span class="line">(SELECT userid,</span><br><span class="line">	   money,</span><br><span class="line">	   paymenttime,</span><br><span class="line">	   orderid,</span><br><span class="line">	   row_number() over (PARTITION BY userid</span><br><span class="line">						  ORDER BY paymenttime) rank</span><br><span class="line">FROM test_sql.test6</span><br><span class="line">WHERE date_format(paymenttime,<span class="string">'yyyy-MM'</span>) = <span class="string">'2017-10'</span>) t</span><br><span class="line">WHERE rank = 1</span><br></pre></td></tr></table></figure>

<h2 id="第七题"><a href="#第七题" class="headerlink" title="第七题"></a>第七题</h2><h3 id="需求-6"><a href="#需求-6" class="headerlink" title="需求"></a>需求</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">现有图书管理数据库的三个数据模型如下：</span><br><span class="line">图书（数据表名：BOOK）</span><br><span class="line">	序号  	字段名称    字段描述    字段类型</span><br><span class="line">	1   	BOOK_ID 	总编号 		文本</span><br><span class="line">	2   	SORT    	分类号 		文本</span><br><span class="line">	3  	 	BOOK_NAME   书名  		文本</span><br><span class="line">	4   	WRITER  	作者  		文本</span><br><span class="line">	5   	OUTPUT  	出版单位    文本</span><br><span class="line">	6   	PRICE   	单价  		数值（保留小数点后2位）</span><br><span class="line">读者（数据表名：READER）</span><br><span class="line">	序号  	字段名称    字段描述    字段类型</span><br><span class="line">	1   	READER_ID   借书证号    文本</span><br><span class="line">	2   	COMPANY 	单位  		文本</span><br><span class="line">	3   	NAME    	姓名  		文本</span><br><span class="line">	4   	SEX 		性别  		文本</span><br><span class="line">	5   	GRADE   	职称  		文本</span><br><span class="line">	6   	ADDR    	地址  		文本</span><br><span class="line">借阅记录（数据表名：BORROW LOG）</span><br><span class="line">	序号  	字段名称    	字段描述    字段类型</span><br><span class="line">	1   	READER_ID   	借书证号    文本</span><br><span class="line">	2   	BOOK_ID  		总编号 		文本</span><br><span class="line">	3   	BORROW_DATE  	借书日期    日期</span><br><span class="line">（1）创建图书管理库的图书、读者和借阅三个基本表的表结构。请写出建表语句。</span><br><span class="line">（2）找出姓李的读者姓名（NAME）和所在单位（COMPANY）。</span><br><span class="line">（3）查找“高等教育出版社”的所有图书名称（BOOK_NAME）及单价（PRICE），结果按单价降序排序。</span><br><span class="line">（4）查找价格介于10元和20元之间的图书种类(SORT）出版单位（OUTPUT）和单价（PRICE），结果按出版单位（OUTPUT）和单价（PRICE）升序排序。</span><br><span class="line">（5）查找所有借了书的读者的姓名（NAME）及所在单位（COMPANY）。</span><br><span class="line">（6）求”科学出版社”图书的最高单价、最低单价、平均单价。</span><br><span class="line">（7）找出当前至少借阅了2本图书（大于等于2本）的读者姓名及其所在单位。</span><br><span class="line">（8）考虑到数据安全的需要，需定时将“借阅记录”中数据进行备份，请使用一条SQL语句，在备份用户bak下创建与“借阅记录”表结构完全一致的数据表BORROW_LOG_BAK.井且将“借阅记录”中现有数据全部复制到BORROW_L0G_ BAK中。</span><br><span class="line">（9）现在需要将原Oracle数据库中数据迁移至Hive仓库，请写出“图书”在Hive中的建表语句（Hive实现，提示：列分隔符|；数据表数据需要外部导入：分区分别以month＿part、day＿part 命名）</span><br><span class="line">（10）Hive中有表A，现在需要将表A的月分区　201505　中　user＿id为20000的user＿dinner字段更新为bonc8920，其他用户user＿dinner字段数据不变，请列出更新的方法步骤。（Hive实现，提示：Hlive中无update语法，请通过其他办法进行数据更新）</span><br></pre></td></tr></table></figure>

<h3 id="实现-6"><a href="#实现-6" class="headerlink" title="实现"></a>实现</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(1)</span><br><span class="line"></span><br><span class="line">-- 创建图书表book</span><br><span class="line"></span><br><span class="line">CREATE TABLE test_sql.book(book_id string,</span><br><span class="line">						   `SORT` string,</span><br><span class="line">						   book_name string,</span><br><span class="line">						   writer string,</span><br><span class="line">						   OUTPUT string,</span><br><span class="line">						   price decimal(10,2));</span><br><span class="line">INSERT INTO TABLE test_sql.book VALUES (<span class="string">'001'</span>,<span class="string">'TP391'</span>,<span class="string">'信息处理'</span>,<span class="string">'author1'</span>,<span class="string">'机械工业出版社'</span>,<span class="string">'20'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.book VALUES (<span class="string">'002'</span>,<span class="string">'TP392'</span>,<span class="string">'数据库'</span>,<span class="string">'author12'</span>,<span class="string">'科学出版社'</span>,<span class="string">'15'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.book VALUES (<span class="string">'003'</span>,<span class="string">'TP393'</span>,<span class="string">'计算机网络'</span>,<span class="string">'author3'</span>,<span class="string">'机械工业出版社'</span>,<span class="string">'29'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.book VALUES (<span class="string">'004'</span>,<span class="string">'TP399'</span>,<span class="string">'微机原理'</span>,<span class="string">'author4'</span>,<span class="string">'科学出版社'</span>,<span class="string">'39'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.book VALUES (<span class="string">'005'</span>,<span class="string">'C931'</span>,<span class="string">'管理信息系统'</span>,<span class="string">'author5'</span>,<span class="string">'机械工业出版社'</span>,<span class="string">'40'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.book VALUES (<span class="string">'006'</span>,<span class="string">'C932'</span>,<span class="string">'运筹学'</span>,<span class="string">'author6'</span>,<span class="string">'科学出版社'</span>,<span class="string">'55'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 创建读者表reader</span><br><span class="line"></span><br><span class="line">CREATE TABLE test_sql.reader (reader_id string,</span><br><span class="line">							  company string,</span><br><span class="line">							  name string,</span><br><span class="line">							  sex string,</span><br><span class="line">							  grade string,</span><br><span class="line">							  addr string);</span><br><span class="line">INSERT INTO TABLE test_sql.reader VALUES (<span class="string">'0001'</span>,<span class="string">'阿里巴巴'</span>,<span class="string">'jack'</span>,<span class="string">'男'</span>,<span class="string">'vp'</span>,<span class="string">'addr1'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.reader VALUES (<span class="string">'0002'</span>,<span class="string">'百度'</span>,<span class="string">'robin'</span>,<span class="string">'男'</span>,<span class="string">'vp'</span>,<span class="string">'addr2'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.reader VALUES (<span class="string">'0003'</span>,<span class="string">'腾讯'</span>,<span class="string">'tony'</span>,<span class="string">'男'</span>,<span class="string">'vp'</span>,<span class="string">'addr3'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.reader VALUES (<span class="string">'0004'</span>,<span class="string">'京东'</span>,<span class="string">'jasper'</span>,<span class="string">'男'</span>,<span class="string">'cfo'</span>,<span class="string">'addr4'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.reader VALUES (<span class="string">'0005'</span>,<span class="string">'网易'</span>,<span class="string">'zhangsan'</span>,<span class="string">'女'</span>,<span class="string">'ceo'</span>,<span class="string">'addr5'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.reader VALUES (<span class="string">'0006'</span>,<span class="string">'搜狐'</span>,<span class="string">'lisi'</span>,<span class="string">'女'</span>,<span class="string">'ceo'</span>,<span class="string">'addr6'</span>);</span><br><span class="line"></span><br><span class="line">-- 创建借阅记录表borrow_log</span><br><span class="line"></span><br><span class="line">CREATE TABLE test_sql.borrow_log(reader_id string,</span><br><span class="line">								 book_id string,</span><br><span class="line">								 borrow_date string);</span><br><span class="line">								 </span><br><span class="line">INSERT INTO TABLE test_sql.borrow_log VALUES (<span class="string">'0001'</span>,<span class="string">'002'</span>,<span class="string">'2019-10-14'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.borrow_log VALUES (<span class="string">'0002'</span>,<span class="string">'001'</span>,<span class="string">'2019-10-13'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.borrow_log VALUES (<span class="string">'0003'</span>,<span class="string">'005'</span>,<span class="string">'2019-09-14'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.borrow_log VALUES (<span class="string">'0004'</span>,<span class="string">'006'</span>,<span class="string">'2019-08-15'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.borrow_log VALUES (<span class="string">'0005'</span>,<span class="string">'003'</span>,<span class="string">'2019-10-10'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.borrow_log VALUES (<span class="string">'0006'</span>,<span class="string">'004'</span>,<span class="string">'2019-17-13'</span>);</span><br><span class="line"></span><br><span class="line">(2)</span><br><span class="line">	SELECT name,</span><br><span class="line">		   company</span><br><span class="line">	FROM test_sql.reader</span><br><span class="line">	WHERE name LIKE <span class="string">'李%'</span>;</span><br><span class="line">(3)</span><br><span class="line">	SELECT book_name,</span><br><span class="line">		   price</span><br><span class="line">	FROM test_sql.book</span><br><span class="line">	WHERE OUTPUT = <span class="string">"高等教育出版社"</span></span><br><span class="line">	ORDER BY price DESC;</span><br><span class="line">(4)</span><br><span class="line">	SELECT sort,</span><br><span class="line">		   output,</span><br><span class="line">		   price</span><br><span class="line">	FROM test_sql.book</span><br><span class="line">	WHERE price &gt;= 10 and price &lt;= 20</span><br><span class="line">	ORDER BY output,price ;</span><br><span class="line">(5)</span><br><span class="line">	SELECT b.name,</span><br><span class="line">		   b.company</span><br><span class="line">	FROM test_sql.borrow_log a</span><br><span class="line">	JOIN test_sql.reader b ON a.reader_id = b.reader_id;</span><br><span class="line">(6)</span><br><span class="line">	SELECT max(price),</span><br><span class="line">		   min(price),</span><br><span class="line">		   avg(price)</span><br><span class="line">	FROM test_sql.book</span><br><span class="line">	WHERE OUTPUT = <span class="string">'科学出版社'</span>;</span><br><span class="line">(7)</span><br><span class="line">	SELECT b.name,</span><br><span class="line">		   b.company</span><br><span class="line">	FROM</span><br><span class="line">	  (SELECT reader_id</span><br><span class="line">	   FROM test_sql.borrow_log</span><br><span class="line">	   GROUP BY reader_id</span><br><span class="line">	   HAVING count(*) &gt;= 2) a</span><br><span class="line">	JOIN test_sql.reader b ON a.reader_id = b.reader_id;</span><br><span class="line">	</span><br><span class="line">(8)</span><br><span class="line">	CREATE TABLE test_sql.borrow_log_bak AS</span><br><span class="line">	SELECT *</span><br><span class="line">	FROM test_sql.borrow_log;</span><br><span class="line">(9)</span><br><span class="line">	CREATE TABLE book_hive ( </span><br><span class="line">	book_id string,</span><br><span class="line">	SORT string, </span><br><span class="line">	book_name string,</span><br><span class="line">	writer string, </span><br><span class="line">	OUTPUT string, </span><br><span class="line">	price DECIMAL ( 10, 2 ) )</span><br><span class="line">	partitioned BY ( month_part string, day_part string )</span><br><span class="line">	ROW format delimited FIELDS TERMINATED BY <span class="string">'\\|'</span> stored AS textfile;</span><br><span class="line">(10)</span><br><span class="line">	方式1：配置hive支持事务操作，分桶表，orc存储格式</span><br><span class="line">	方式2：第一步找到要更新的数据，将要更改的字段替换为新的值，第二步找到不需要更新的数据，第三步将上两步的数据插入一张新表中。</span><br></pre></td></tr></table></figure>

<h2 id="第八题"><a href="#第八题" class="headerlink" title="第八题"></a>第八题</h2><h3 id="需求-7"><a href="#需求-7" class="headerlink" title="需求"></a>需求</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">有一个线上服务器访问日志格式如下（用sql答题）</span><br><span class="line">时间                    接口                         ip地址</span><br><span class="line">2016-11-09 14:22:05		/api/user/login				110.23.5.33</span><br><span class="line">2016-11-09 14:23:10		/api/user/detail			57.3.2.16</span><br><span class="line">2016-11-09 15:59:40		/api/user/login				200.6.5.166</span><br><span class="line">… …</span><br><span class="line">求11月9号下午14点（14-15点），访问/api/user/login接口的top10的ip地址</span><br></pre></td></tr></table></figure>

<h3 id="实现-7"><a href="#实现-7" class="headerlink" title="实现"></a>实现</h3><h4 id="数据准备-6"><a href="#数据准备-6" class="headerlink" title="数据准备"></a>数据准备</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CREATE TABLE test_sql.test8(`date` string,</span><br><span class="line">				interface string,</span><br><span class="line">				ip string);</span><br><span class="line"></span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES (<span class="string">'2016-11-09 11:22:05'</span>,<span class="string">'/api/user/login'</span>,<span class="string">'110.23.5.23'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES (<span class="string">'2016-11-09 11:23:10'</span>,<span class="string">'/api/user/detail'</span>,<span class="string">'57.3.2.16'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES (<span class="string">'2016-11-09 23:59:40'</span>,<span class="string">'/api/user/login'</span>,<span class="string">'200.6.5.166'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES(<span class="string">'2016-11-09 11:14:23'</span>,<span class="string">'/api/user/login'</span>,<span class="string">'136.79.47.70'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES(<span class="string">'2016-11-09 11:15:23'</span>,<span class="string">'/api/user/detail'</span>,<span class="string">'94.144.143.141'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES(<span class="string">'2016-11-09 11:16:23'</span>,<span class="string">'/api/user/login'</span>,<span class="string">'197.161.8.206'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES(<span class="string">'2016-11-09 12:14:23'</span>,<span class="string">'/api/user/detail'</span>,<span class="string">'240.227.107.145'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES(<span class="string">'2016-11-09 13:14:23'</span>,<span class="string">'/api/user/login'</span>,<span class="string">'79.130.122.205'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES(<span class="string">'2016-11-09 14:14:23'</span>,<span class="string">'/api/user/detail'</span>,<span class="string">'65.228.251.189'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES(<span class="string">'2016-11-09 14:15:23'</span>,<span class="string">'/api/user/detail'</span>,<span class="string">'245.23.122.44'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES(<span class="string">'2016-11-09 14:17:23'</span>,<span class="string">'/api/user/detail'</span>,<span class="string">'22.74.142.137'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES(<span class="string">'2016-11-09 14:19:23'</span>,<span class="string">'/api/user/detail'</span>,<span class="string">'54.93.212.87'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES(<span class="string">'2016-11-09 14:20:23'</span>,<span class="string">'/api/user/detail'</span>,<span class="string">'218.15.167.248'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES(<span class="string">'2016-11-09 14:24:23'</span>,<span class="string">'/api/user/detail'</span>,<span class="string">'20.117.19.75'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES(<span class="string">'2016-11-09 15:14:23'</span>,<span class="string">'/api/user/login'</span>,<span class="string">'183.162.66.97'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES(<span class="string">'2016-11-09 16:14:23'</span>,<span class="string">'/api/user/login'</span>,<span class="string">'108.181.245.147'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES(<span class="string">'2016-11-09 14:17:23'</span>,<span class="string">'/api/user/login'</span>,<span class="string">'22.74.142.137'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test8 VALUES(<span class="string">'2016-11-09 14:19:23'</span>,<span class="string">'/api/user/login'</span>,<span class="string">'22.74.142.137'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="查询SQL-5"><a href="#查询SQL-5" class="headerlink" title="查询SQL"></a>查询SQL</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SELECT ip,</span><br><span class="line">	   count(*) AS cnt</span><br><span class="line">FROM test_sql.test8</span><br><span class="line">WHERE date_format(date,<span class="string">'yyyy-MM-dd HH'</span>) &gt;= <span class="string">'2016-11-09 14'</span></span><br><span class="line">  AND date_format(date,<span class="string">'yyyy-MM-dd HH'</span>) &lt; <span class="string">'2016-11-09 15'</span></span><br><span class="line">  AND interface=<span class="string">'/api/user/login'</span></span><br><span class="line">GROUP BY ip</span><br><span class="line">ORDER BY cnt desc</span><br><span class="line">LIMIT 10;</span><br></pre></td></tr></table></figure>

<h2 id="第九题"><a href="#第九题" class="headerlink" title="第九题"></a>第九题</h2><h3 id="需求-8"><a href="#需求-8" class="headerlink" title="需求"></a>需求</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">有一个充值日志表credit_log，字段如下：</span><br><span class="line"></span><br><span class="line">`dist_id` int  <span class="string">'区组id'</span>,</span><br><span class="line">`account` string  <span class="string">'账号'</span>,</span><br><span class="line">`money` int   <span class="string">'充值金额'</span>,</span><br><span class="line">`create_time` string  <span class="string">'订单时间'</span></span><br><span class="line"></span><br><span class="line">请写出SQL语句，查询充值日志表2019年01月02号每个区组下充值额最大的账号，要求结果：</span><br><span class="line">区组id，账号，金额，充值时间</span><br></pre></td></tr></table></figure>

<h3 id="实现-8"><a href="#实现-8" class="headerlink" title="实现"></a>实现</h3><h4 id="数据准备-7"><a href="#数据准备-7" class="headerlink" title="数据准备"></a>数据准备</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CREATE TABLE test_sql.test9(</span><br><span class="line">			dist_id string COMMENT <span class="string">'区组id'</span>,</span><br><span class="line">			account string COMMENT <span class="string">'账号'</span>,</span><br><span class="line">		   `money` decimal(10,2) COMMENT <span class="string">'充值金额'</span>,</span><br><span class="line">			create_time string COMMENT <span class="string">'订单时间'</span>);</span><br><span class="line"></span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'1'</span>,<span class="string">'11'</span>,100006,<span class="string">'2019-01-02 13:00:01'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'1'</span>,<span class="string">'22'</span>,110000,<span class="string">'2019-01-02 13:00:02'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'1'</span>,<span class="string">'33'</span>,102000,<span class="string">'2019-01-02 13:00:03'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'1'</span>,<span class="string">'44'</span>,100300,<span class="string">'2019-01-02 13:00:04'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'1'</span>,<span class="string">'55'</span>,100040,<span class="string">'2019-01-02 13:00:05'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'1'</span>,<span class="string">'66'</span>,100005,<span class="string">'2019-01-02 13:00:06'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'1'</span>,<span class="string">'77'</span>,180000,<span class="string">'2019-01-03 13:00:07'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'1'</span>,<span class="string">'88'</span>,106000,<span class="string">'2019-01-02 13:00:08'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'1'</span>,<span class="string">'99'</span>,100400,<span class="string">'2019-01-02 13:00:09'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'1'</span>,<span class="string">'12'</span>,100030,<span class="string">'2019-01-02 13:00:10'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'1'</span>,<span class="string">'13'</span>,100003,<span class="string">'2019-01-02 13:00:20'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'1'</span>,<span class="string">'14'</span>,100020,<span class="string">'2019-01-02 13:00:30'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'1'</span>,<span class="string">'15'</span>,100500,<span class="string">'2019-01-02 13:00:40'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'1'</span>,<span class="string">'16'</span>,106000,<span class="string">'2019-01-02 13:00:50'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'1'</span>,<span class="string">'17'</span>,100800,<span class="string">'2019-01-02 13:00:59'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'2'</span>,<span class="string">'18'</span>,100800,<span class="string">'2019-01-02 13:00:11'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'2'</span>,<span class="string">'19'</span>,100030,<span class="string">'2019-01-02 13:00:12'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'2'</span>,<span class="string">'10'</span>,100000,<span class="string">'2019-01-02 13:00:13'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'2'</span>,<span class="string">'45'</span>,100010,<span class="string">'2019-01-02 13:00:14'</span>);</span><br><span class="line">INSERT INTO TABLE test_sql.test9 VALUES (<span class="string">'2'</span>,<span class="string">'78'</span>,100070,<span class="string">'2019-01-02 13:00:15'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="查询SQL-6"><a href="#查询SQL-6" class="headerlink" title="查询SQL"></a>查询SQL</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">WITH TEMP AS</span><br><span class="line">  (SELECT dist_id,</span><br><span class="line">		  account,</span><br><span class="line">		  sum(`money`) sum_money</span><br><span class="line">   FROM test_sql.test9</span><br><span class="line">   WHERE date_format(create_time,<span class="string">'yyyy-MM-dd'</span>) = <span class="string">'2019-01-02'</span></span><br><span class="line">   GROUP BY dist_id,</span><br><span class="line">			account)</span><br><span class="line">SELECT t1.dist_id,</span><br><span class="line">	   t1.account,</span><br><span class="line">	   t1.sum_money</span><br><span class="line">FROM</span><br><span class="line">  (SELECT temp.dist_id,</span><br><span class="line">		  temp.account,</span><br><span class="line">		  temp.sum_money,</span><br><span class="line">		  rank() over(partition BY temp.dist_id</span><br><span class="line">					  ORDER BY temp.sum_money DESC) ranks</span><br><span class="line">   FROM TEMP) t1</span><br><span class="line">WHERE ranks = 1</span><br></pre></td></tr></table></figure>

<h2 id="第十题"><a href="#第十题" class="headerlink" title="第十题"></a>第十题</h2><h3 id="需求-9"><a href="#需求-9" class="headerlink" title="需求"></a>需求</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">有一个账号表如下，请写出SQL语句，查询各自区组的money排名前十的账号（分组取前10）</span><br><span class="line">dist_id string  <span class="string">'区组id'</span>,</span><br><span class="line">account string  <span class="string">'账号'</span>,</span><br><span class="line">gold     int    <span class="string">'金币'</span></span><br></pre></td></tr></table></figure>

<h3 id="实现-9"><a href="#实现-9" class="headerlink" title="实现"></a>实现</h3><h4 id="数据准备-8"><a href="#数据准备-8" class="headerlink" title="数据准备"></a>数据准备</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CREATE TABLE test_sql.test10(</span><br><span class="line">	`dist_id` string COMMENT <span class="string">'区组id'</span>,</span><br><span class="line">	`account` string COMMENT <span class="string">'账号'</span>,</span><br><span class="line">	`gold` int COMMENT <span class="string">'金币'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO TABLE test_sql.test10 VALUES (<span class="string">'1'</span>,<span class="string">'77'</span>,18);</span><br><span class="line">INSERT INTO TABLE test_sql.test10 VALUES (<span class="string">'1'</span>,<span class="string">'88'</span>,106);</span><br><span class="line">INSERT INTO TABLE test_sql.test10 VALUES (<span class="string">'1'</span>,<span class="string">'99'</span>,10);</span><br><span class="line">INSERT INTO TABLE test_sql.test10 VALUES (<span class="string">'1'</span>,<span class="string">'12'</span>,13);</span><br><span class="line">INSERT INTO TABLE test_sql.test10 VALUES (<span class="string">'1'</span>,<span class="string">'13'</span>,14);</span><br><span class="line">INSERT INTO TABLE test_sql.test10 VALUES (<span class="string">'1'</span>,<span class="string">'14'</span>,25);</span><br><span class="line">INSERT INTO TABLE test_sql.test10 VALUES (<span class="string">'1'</span>,<span class="string">'15'</span>,36);</span><br><span class="line">INSERT INTO TABLE test_sql.test10 VALUES (<span class="string">'1'</span>,<span class="string">'16'</span>,12);</span><br><span class="line">INSERT INTO TABLE test_sql.test10 VALUES (<span class="string">'1'</span>,<span class="string">'17'</span>,158);</span><br><span class="line">INSERT INTO TABLE test_sql.test10 VALUES (<span class="string">'2'</span>,<span class="string">'18'</span>,12);</span><br><span class="line">INSERT INTO TABLE test_sql.test10 VALUES (<span class="string">'2'</span>,<span class="string">'19'</span>,44);</span><br><span class="line">INSERT INTO TABLE test_sql.test10 VALUES (<span class="string">'2'</span>,<span class="string">'10'</span>,66);</span><br><span class="line">INSERT INTO TABLE test_sql.test10 VALUES (<span class="string">'2'</span>,<span class="string">'45'</span>,80);</span><br><span class="line">INSERT INTO TABLE test_sql.test10 VALUES (<span class="string">'2'</span>,<span class="string">'78'</span>,98);</span><br></pre></td></tr></table></figure>

<h4 id="查询SQL-7"><a href="#查询SQL-7" class="headerlink" title="查询SQL"></a>查询SQL</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SELECT dist_id,</span><br><span class="line">   account,</span><br><span class="line">   gold</span><br><span class="line">FROM</span><br><span class="line">(SELECT dist_id,</span><br><span class="line">	  account,</span><br><span class="line">	  gold,</span><br><span class="line">	  row_number () over (PARTITION BY dist_id</span><br><span class="line">						  ORDER BY gold DESC) rank</span><br><span class="line">FROM test_sql.test10) t</span><br><span class="line">WHERE rank &lt;= 10</span><br></pre></td></tr></table></figure>

<pre><code>&gt;  公众号『大数据技术与数仓』，回复『资料』领取大数据资料包            </code></pre></div><div class="recommended_posts"><h3>相关推荐 ☟</h3><li><a href="https://jiamaoxiang.top/2019/11/08/历史拉链表实战/" target="_blank">历史拉链表实战</a></li><li><a href="https://jiamaoxiang.top/2019/10/23/Flink运行架构剖析/" target="_blank">Flink运行架构剖析</a></li><li><a href="https://jiamaoxiang.top/2019/08/29/Impala使用的端口/" target="_blank">Impala使用的端口</a></li><li><a href="https://jiamaoxiang.top/2019/08/28/Azkaban安装部署/" target="_blank">Azkaban安装部署</a></li></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Jia MaoXiang</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2019/10/15/经典Hive-SQL面试题/">https://jiamaoxiang.top/2019/10/15/经典Hive-SQL面试题/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本文为博主原创文章，遵循CC BY-SA 4.0版权协议，转载请附上原文出处链接和本声明</li></ul></div><br><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="https://jiamaoxiang.top/2019/10/15/经典Hive-SQL面试题/" data-id="ckhyakhrd005s4s7qgshc0io4" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACK0lEQVR42u3aWW7DMAwFwN7/0ukBGjmPpFPA0vgrqDdNCjBc9PMTH6/F8ffs6i/XT67e1TwwMDAey3hdHqtrrp9QXWj+3iUVAwPjAEYSCq/vur6+967CczAwMDDiRLAamldPw8DAwLg3CPaKz7wYxsDAwOgFwWrAzZf79VocAwPjgYw8OP7/56/MNzAwMB7FeBWP6lCzl/CVV4WBgbE1Iw9w1wlZMuyspoPl9WBgYGzNqBa0k1ZaMgRNrrxhixgGBsajGNWl95B5opkH6De/GxgYGNsxJs39SWOuN85cvgsDA2NrRn46eUFSyubttl7gxsDA2I8x2VRRBedfRLl4xsDAOICRt8PKyVkxKayuYZnhYmBgbMSobn3Iy9S8lK0OR8uTWAwMjIcz8rIzAfcK0Woh/eH/gIGBsR2jutGhN9pMnnnbnhEMDIztGPmoMm+95YGyOi79kBpiYGBsykgWlBz5mKE3NG3+YmBgYGzEmG+wyBtt1bZa9evAwMDYlZEE3OoLqmlidSD65koMDIwDGNUwOgm+k7uWZzEwMI5hzJd776ggH6NiYGCcw5g06e7dbJFPKjEwMPZm9AYASUuuF5TzEhoDA+Mcxjy8ToajvRbeZD0YGBjPZeQbKeZ9+BsyWQwMjIMZkzZcNRxPNoF9KGUxMDAwgmK113q7IRnFwMDAaG35mjfpkusxMDDOYSRFbLLEvLk/abFhYGCcxpjnXfOBQa9th4GBcQDjF0W/LLp3IgGbAAAAAElFTkSuQmCC">分享</a><div class="tags"><a href="/tags/Hive/">Hive</a></div><div class="post-nav"><a class="pre" href="/2019/10/23/Flink运行架构剖析/">Flink运行架构剖析</a><a class="next" href="/2019/08/29/Impala使用的端口/">Impala使用的端口</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar-toc"><div class="stoc-article" id="sidebar-stoc"><strong class="stoc-title"><i class="fa fa-list-ul"> 目录</i></strong><div class="toc-nav" id="stoc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#第一题"><span class="toc-number">1.</span> <span class="toc-text">第一题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#需求"><span class="toc-number">1.1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现"><span class="toc-number">1.2.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#数据准备"><span class="toc-number">1.2.1.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询SQL"><span class="toc-number">1.2.2.</span> <span class="toc-text">查询SQL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第二题"><span class="toc-number">2.</span> <span class="toc-text">第二题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#需求-1"><span class="toc-number">2.1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现-1"><span class="toc-number">2.2.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#数据准备-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询SQL实现"><span class="toc-number">2.2.2.</span> <span class="toc-text">查询SQL实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第三题"><span class="toc-number">3.</span> <span class="toc-text">第三题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#需求-2"><span class="toc-number">3.1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现-2"><span class="toc-number">3.2.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#数据准备-2"><span class="toc-number">3.2.1.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询SQL-1"><span class="toc-number">3.2.2.</span> <span class="toc-text">查询SQL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第四题"><span class="toc-number">4.</span> <span class="toc-text">第四题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#需求-3"><span class="toc-number">4.1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现-3"><span class="toc-number">4.2.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#数据准备-3"><span class="toc-number">4.2.1.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询SQL-2"><span class="toc-number">4.2.2.</span> <span class="toc-text">查询SQL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第五题"><span class="toc-number">5.</span> <span class="toc-text">第五题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#需求-4"><span class="toc-number">5.1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现-4"><span class="toc-number">5.2.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#数据准备-4"><span class="toc-number">5.2.1.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询SQL-3"><span class="toc-number">5.2.2.</span> <span class="toc-text">查询SQL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第六题"><span class="toc-number">6.</span> <span class="toc-text">第六题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#需求-5"><span class="toc-number">6.1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现-5"><span class="toc-number">6.2.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#数据准备-5"><span class="toc-number">6.2.1.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询SQL-4"><span class="toc-number">6.2.2.</span> <span class="toc-text">查询SQL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第七题"><span class="toc-number">7.</span> <span class="toc-text">第七题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#需求-6"><span class="toc-number">7.1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现-6"><span class="toc-number">7.2.</span> <span class="toc-text">实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第八题"><span class="toc-number">8.</span> <span class="toc-text">第八题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#需求-7"><span class="toc-number">8.1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现-7"><span class="toc-number">8.2.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#数据准备-6"><span class="toc-number">8.2.1.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询SQL-5"><span class="toc-number">8.2.2.</span> <span class="toc-text">查询SQL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第九题"><span class="toc-number">9.</span> <span class="toc-text">第九题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#需求-8"><span class="toc-number">9.1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现-8"><span class="toc-number">9.2.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#数据准备-7"><span class="toc-number">9.2.1.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询SQL-6"><span class="toc-number">9.2.2.</span> <span class="toc-text">查询SQL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第十题"><span class="toc-number">10.</span> <span class="toc-text">第十题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#需求-9"><span class="toc-number">10.1.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现-9"><span class="toc-number">10.2.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#数据准备-8"><span class="toc-number">10.2.1.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询SQL-7"><span class="toc-number">10.2.2.</span> <span class="toc-text">查询SQL</span></a></li></ol></li></ol></li></ol></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 - 2020 <a href="/." rel="nofollow">Jmx's Blog.</a>All rights reserved.<br>Thoughts on technology, life and everything else.</div></div></div><script type="text/javascript" src="/js/toc.js?v=0.0.0"></script><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="100,99,98" opacity="0.5" zindex="0.7" count="150" src="//lib.baomitu.com/canvas-nest.js/2.0.4/canvas-nest.umd.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>